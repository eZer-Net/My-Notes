
# **AppArmor: Основные понятия**
#### Что это?

- **AppArmor** (Application Armor) — это система принудительного контроля доступа (MAC, Mandatory Access Control), разработанная для повышения безопасности системы путем ограничения возможностей приложений. **В отличие от SELinux, который использует метки (контексты) для всех объектов, AppArmor работает на основе профилей, которые определяют, какие ресурсы может использовать конкретное приложение.**

- ==AppArmor ограничивает доступ приложений к файлам, сетевым ресурсам, каталогам и другим системным ресурсам==, даже если они запущены с правами root.

#### Как работает AppArmor?

- AppArmor использует **профили безопасности**, которые описывают, какие действия может выполнять конкретное приложение. Эти профили могут быть в двух режимах:
    
    1. **Enforce** (Принудительный режим): Профиль активно применяется, и любые попытки нарушить правила блокируются.
    2. **Complain** (Жалующий режим): Профиль не блокирует действия, но записывает все нарушения в лог-файлы. Это полезно для отладки и создания новых профилей.

- AppArmor не использует метки (контексты) для файлов и процессов, как это делает SELinux. Вместо этого он работает на основе путей к файлам и каталогам, что делает его более простым в настройке и использовании.

#### Режимы AppArmor

1. **Enforce**:
    - Режим по умолчанию.
    - Все правила профиля активно применяются.
    - Любые попытки нарушить правила блокируются.

2. **Complain**:
    - Политики не применяются, но все попытки доступа записываются в лог-файлы.
    - Полезен для отладки и создания новых профилей.

3. **Disable**:
    - AppArmor полностью отключен для конкретного профиля или всей системы.
    - Не рекомендуется использовать, так как система становится уязвимой.

#### **Команды для управления режимами:**

- ==Проверка текущего статуса AppArmor:==
```
sudo aa-status
```

- Переключение режима для конкретного профиля:
```
sudo aa-complain /path/to/binary  # Переключение в режим Complain
sudo aa-enforce /path/to/binary   # Переключение в режим Enforce
```

- Отключение профиля:
```
sudo aa-disable /path/to/binary
```

# **Объяснение работы**

AppArmor работает на основе **профилей**, которые определяют, какие действия может выполнять конкретное приложение. Профиль может быть создан для любого приложения, и он описывает, какие файлы, каталоги, сетевые ресурсы и другие системные объекты может использовать это приложение.

#### **Что такое профиль?**

- **Профиль** — это набор правил, которые определяют, какие ресурсы может использовать приложение. Профиль может быть как строгим (запрещающим все, кроме явно разрешенного), так и более гибким (разрешающим большинство действий, но с некоторыми ограничениями).

- Профили хранятся в директории `/etc/apparmor.d/` и имеют расширение `.profile`.

#### Пример профиля AppArmor:
```
# Профиль для /usr/bin/example

/usr/bin/example {
  # Разрешить чтение и запись в конкретный файл
  /var/log/example.log rw,

  # Разрешить доступ к сети
  network inet tcp,

  # Запретить доступ к другим файлам
  deny /etc/passwd r,
}
```

#### **Как работает профиль?**

1. **Для процессов**:
    - Каждый процесс, который запускается с профилем AppArmor, ограничен правилами этого профиля.
    - Например, если процесс пытается получить доступ к файлу, который не указан в профиле, доступ будет запрещен.

2. **Для файлов**:
    - Профиль определяет, какие файлы и каталоги может читать, записывать или выполнять процесс.
    - Например, если профиль разрешает доступ только к `/var/log/example.log`, то попытка доступа к `/etc/passwd` будет заблокирована.

3. **Для сетевых ресурсов**:
    - Профиль может ограничивать доступ к сетевым ресурсам, например, разрешать или запрещать использование определенных портов или протоколов.

#### **Команды для управления профилями:**

- Просмотр всех активных профилей:
```
sudo aa-status
```

- Загрузка нового профиля:
```
sudo apparmor_parser -r /etc/apparmor.d/example.profile
```

- Удаление профиля:
```
sudo apparmor_parser -R /etc/apparmor.d/example.profile
```