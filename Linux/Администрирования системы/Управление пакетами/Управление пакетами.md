
### Что такое `.deb` пакет?

`.deb` пакет — это формат пакетов, используемый в операционных системах на базе Debian и Ubuntu для распространения и установки программного обеспечения. Он содержит скомпилированные двоичные файлы, конфигурационные файлы, скрипты и метаданные, необходимые для установки и управления программным обеспечением.

### Структура `.deb` пакета

`.deb` пакет — это архив, который обычно состоит из трёх основных частей:

1. **`debian-binary`**:
	Это текстовый файл, содержащий версию формата пакета (обычно `2.0`).

2. **`control.tar.gz`**:
	Содержит метаданные пакета, такие как:
	- `control` — информация о пакете (имя, версия, зависимости, описание и т.д.).
	- `preinst`, `postinst`, `prerm`, `postrm` — скрипты, выполняемые до/после установки или удаления пакета.
	- `conffiles` — список конфигурационных файлов, которые не должны перезаписываться при обновлении.
	- `md5sums` — контрольные суммы файлов пакета.

3. **`data.tar.gz`**:
	Содержит файлы, которые будут установлены в систему (бинарники, библиотеки, конфигурационные файлы и т.д.).

### Что может быть `.deb` пакетом?

- Программное обеспечение (например, текстовый редактор, браузер, серверное ПО).
- Библиотеки, необходимые для работы других программ.
- Утилиты или инструменты для разработки.
- Драйверы устройств.
- Конфигурационные файлы или скрипты.

### Как исследовать `.deb` пакет?

1. **Распаковка пакета**:
    
    - Использовать утилиту `dpkg` или `ar` для извлечения содержимого:
        `ar x package.deb`
    - После этого мы получим файлы `debian-binary`, `control.tar.gz` и `data.tar.gz`.

2. **Просмотр содержимого**:
    
    - Распаковать `control.tar.gz` и `data.tar.gz`:
        `tar -xzf control.tar.gz`
        `tar -xzf data.tar.gz`
    - Изучите файлы, особенно скрипты (`preinst`, `postinst`, `prerm`, `postrm`) и конфигурационные файлы.

3. **Анализ зависимостей**:
    - Посмотреть файл `control` для изучения зависимостей пакета.

4. **Проверка на наличие уязвимостей**:
    - Используйте инструменты статического анализа, такие как `grep`, для поиска подозрительных строк в скриптах (например, вызовы `sudo`, `chmod 777`, использование `curl` или `wget` для загрузки файлов).


### Возможные уязвимости

1. **Небезопасные скрипты**:
    - Скрипты установки (`postinst`, `preinst`) могут содержать команды, которые выполняются с привилегиями root. Если в них есть уязвимости (например, использование непроверенных данных), это может привести к повышению привилегий.

2. **Подмена пакетов**:
    - Если злоумышленник может подменить `.deb` пакет (например, через MITM-атаку), он может внедрить вредоносный код.

3. **Небезопасные зависимости**:
    - Пакет может зависеть от устаревших или уязвимых библиотек, что может быть использовано для эксплуатации.

4. **Конфигурационные файлы с избыточными правами**:
    - Если конфигурационные файлы имеют слишком широкие права доступа (например, `chmod 777`), это может позволить злоумышленнику изменить их.

5. **Загрузка внешних ресурсов**:
    - Если скрипты пакета загружают файлы из интернета (например, через `curl` или `wget`), это может быть использовано для внедрения вредоносного кода.

6. **Небезопасные переменные окружения**:
    - Если скрипты используют переменные окружения без должной проверки, это может привести к уязвимостям, таким как инъекция команд.


### Инструменты для анализа `.deb` пакетов

- **`dpkg`**: Основной инструмент для работы с `.deb` пакетами.
- **`ar`**: Для извлечения содержимого `.deb` пакета.
- **`tar`**: Для распаковки `control.tar.gz` и `data.tar.gz`.
- **`lintian`**: Инструмент для проверки `.deb` пакетов на соответствие стандартам Debian и поиска потенциальных проблем.
- **`grep`**: Для поиска подозрительных строк в скриптах и конфигурационных файлах.

----
### Debian (.deb) - Debian, Ubuntu

dpkg - Низкоуровневый инструмент
- Установка пакета из файла:
	`dpkg -i файл_пакета`
- Удаление пакета:
	`dpkg -r имя_пакета`
- Обновление пакета:
	`dpkg -i файл_пакета (не поддерживает автоматическое разрешение зависимостей)`
- Вывод списка установленных пакетов:
	`dpkg -l`
- Определение, установлен ли пакет:
	`dpkg -s имя_пакета`
- Вывод информации об установленном пакете:
	`apt-cache show имя_пакета`
- Поиск пакета по установленному файлу:
	`dpkg -S имя_файла`
- Просмотр файлов, установленных пакетом:
	`dpkg -L имя_пакета`
- Проверка целостности файлов пакета:
	`dpkg --verify имя_пакета`

apt-get, apt, aptitude - Высокоуровневые инструменты
- Обновление списка пакетов:
	`apt-get update`
- Обновление всех пакетов:
	`apt-get upgrade`
- Поиск пакета в репозитории:
	`apt-cache search искомая_строка`
- Установка пакета из репозитория:
	`apt-get install имя_пакета`
- Удаление пакета:
	`apt-get remove имя_пакета`
- Вывод информации об установленном пакете:
	`apt-cache show имя_пакета`
- Установка или обновление пакета и разрешение зависимостей:
	`apt install ./файл_пакета.deb`

### Red Hat (.rpm)        - Fedora, CentOS
rpm - Низкоуровневый инструмент
- Установка пакета из файла:
	rpm -i файл_пакета
- Удаление пакета:
	rpm -e имя_пакета
- Обновление пакета:
	rpm -U файл_пакета (при наличии зависимостей не разрешает их автоматически)
- Вывод списка установленных пакетов:
	rpm -qa
- Определение, установлен ли пакет:
	rpm -q имя_пакета
- Вывод информации об установленном пакете:
	yum info имя_пакета
- Поиск пакета по установленному файлу:
	rpm -qf имя_файла
- Просмотр файлов, установленных пакетом:
	rpm -ql имя_пакета
- Проверка целостности файлов пакета:
	rpm --verify имя_пакета
yum, dnf - Высокоуровневые инструменты
- Поиск пакета в репозитории:
	yum search искомая строка
- Установка пакета из репозитория:
	yum install имя_пакета
- Установка пакета из файла:
	rpm -i файл_пакета
- Удаление пакета:
	yum erase имя_пакета
- Обновление всех пакетов:
	yum update
- Вывод информации об установленном пакете:
	yum info имя_пакета

Исключения            - Arch, Gentoo