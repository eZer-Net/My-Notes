
drwxrwxr-x 2 bob students  4096 сен 24 16:36 pesochnica

drwxrwxr-x 
	Первый символ указывает на тип иcледуемого элемента
		"d" - директория "-" - файл
		"l" - символическая ссылка
		"c" - специальный файл симв. устройства (такие как терминал или модем, обрабатывают данные потоками байтов)
		"b" - спец. файл блочного устройства (такие как привод жёсткого диска или CD-ROM, которые обрабатывают данные блоками).
		"s" - для сокета
		"p" - для именованного конвейера
    Последующие группы по 3 символа отвечают за возможности владельца, группы, остальных пользователей ("rwx" - владелец "rwx" - группа "r-x" - остальных пользователей).
            r 
		        Для файла
                    открывать и читать содержимое
                Для директории
                    читать содержимое каталога если установлен атрибут прав на выполнение
            w 
	            Для файла
                    записывать в файл и усекать его, но не даёт его переименовывать и удалять, эту возможность определяет атрибут вмещающего каталога
                Для директории
                    Создавать, удалять, переименовывать файлы внутри каталога, если указан вместе с этим атрибут прав на выполнение
            x 
		        Для файла
                    Разрешает интерпретировать файл как программу и выполнять её. Файлы содержащие программы на языках сценариев, доп. должны иметь атрибут на чтение
                Для директории
                    Разрешается входить в каталог cd
            s (setuid/setgid)
                Для файла
                    если установлен бит setuid, программа будет выполняться с правами владельца файла.
                    Если установлен бит setgid, программа будет выполняться с правами группы, к которой принадлежит файл
                Для директории
                    если установлен бит setgid, новые файлы и подкаталоги, созданные в этой директории, будут наследовать группу родительской директории
            t (sticky bit)
                Для директории
                    ограничивает удаление файлов в каталоге. Если установлен sticky bit, только владелец файла или суперпользователь может удалить или переименовать файл в этом каталоге.
        + - Если в конце строки прав доступа указан знак плюс (
	        например, -rw-rw-r--+), это значит, что к файлу применены расширенные атрибуты (+), такие как списки управления доступом (ACL). Точка в конце (.) указывает на примененный к файлу атрибут SELinux.

Кол. ссылок на этот файл или директорию
        bob - Имя владельца файла или директории
        students - Имя группы, к которой принадлежит файл или директория
        4096 - Размер файла или директории в байтах. Для директорий это может быть размер метаданных
        сен 24 16:36 - Дата и время последнего изменения файла или директории
        pesochnica - Имя файла или директории

chmod - изменение доступа к файлу
	chmod 7 file.txt - для владельца
	chmod 777 file.txt - для владельца, группы, остальных
		0  000  ---
		1  001  --x
		2  010  -w-
		3  011  -wx
		4  100  r--
		5  101  r-x
		6  110  rw-
		7  111  rwx
		`r=4, w=2 и x=1`
	кому изменять доступ ("+" - добавляет права "-" - отнимает права, "=" - указывает что только те доступы которые укажем должны быть)
        chmod u+rwx,g+r,o=x file.txt
            u+атрибут(ы) - владельцу файла или каталога
            g+атрибут(ы) - группе
            o+атрибут(ы) - всем остальным
            a+атрибут(ы) - всем из перечисленным выше
        chmod -R 777 pesochnica
            --recursive - выполнять как для файла так и для каталога где он находиться

chown новый_владелец:новая_группа имя_файла_или_каталога 
	меняет владельца и группу каталога\файла
        chown alice pesochnica - поменять только владельца
        chown :staff pesochnica - поменяет только группу

umask - определение разрешения доступа к файлам по умолчанию (пока сессия работает)

su - запуск командной оболочки с подставной идентификатор пользователя и группы
    su root 
	    запуск от суперпользователя с паролем суперпользователя
    su -l username 
	    запуститься командная оболочка и станет оболочкой входа для указаного пользователя (так же как если бы мы перезагрузили пк и зашли под другим пользователем).
    su -c 'команда' username 
	    для того чтоб не переключаться между пользователями а запустить 1 команду от этого пользователя.

sudo - выполнение команды от имени другого пользователя.
	sudo su - запуск суперпользователя только от пароля самого пользователя.
	Администратор может определить порядок использования sudo обычным пользователям, ограничив возможность запуска команд от имени другого пользователя(обычно суперпользователя) sudo не требует ввода пароля суперпользователя а лишь пароль пользователя.

visudo - утилита, предназначенная для безопасного редактирования файла конфигурации sudoers. Этот файл определяет, какие пользователи и группы имеют право выполнять команды с привилегиями суперпользователя (root) с помощью команды sudo.

useradd - добавление пользователей только при полномочиях суперпользователя
    Параметры:
        -c "комментарий" 
	        комментарий к новой учетной записи пользователя. Обычно это полное имя пользователя
        -d домашний_каталог  
	        устанавливает домашний каталог, который будет применяться для учетной записи. По умолчанию его название должно совпадать
            с именем учетной записи и располагаться в каталоге /home. Замените домашний_каталог именем нужного каталога, например -d /mnt/homes/jake.
        -D 
	        используется для вывода значений по умолчанию, которые будут применяться при создании новых пользователей. Это может быть полезно чтобы понять, какие настройки будут использоваться по умолчанию, если они не укажут их явно при создании пользователя. Обычно это включает в себя:
                    HOME: Путь к домашнему каталогу (обычно /home).
                    INACTIVE: Количество дней после устаревания пароля, когда учетная запись будет заблокирована (по умолчанию может быть -1, что означает, что блокировка не произойдет).
                    EXPIRE: Дата истечения срока действия учетной записи.
                    SHELL: Командная оболочка по умолчанию (например, /bin/bash).
                    GROUP: Основная группа для новых пользователей.
                    SKEL: Каталог, из которого копируются файлы в новый домашний каталог (обычно /etc/skel).
        -e дата_устаревания 
	        назначает дату, когда учетная запись пользователя будет заблокирована, в формате ГГГГ-ММ-ДД
        -f -1
	        устанавливает количество дней, которые должны пройти с момента устаревания пароля до блокирования учетной записи. По умолчанию значение -1 отключает этот параметр. Значение 0 блокирует учетную запись сразу же после истечения срока действия пароля
        -g группа 
	        устанавливает основную группу (она уже должна существовать в файле /etc/group ), в которой будет находиться новый пользователь. Замените группа именем группы, например -g wheel . Без этого параметра создается новая группа, которая совпадает с именем пользователя и становится основной.
        -G список_групп 
	        добавляет нового пользователя в предоставленный список дополнительных групп, разделенных запятыми (например, -G wheel,sa­les,tech,lunch). **Если хотите использовать параметр -G позже с usermod, обязательно укажите -aG. Если ввести просто -G, существующие дополнительные группы будут удалены и представленные группы окажутся единственными назначенными.**
        -k skel_dir
	         устанавливает каталог с шаблонами, который содержит файлы и каталоги для копирования в домашний каталог пользователя при его создании. Этот параметр можно использовать только в сочетании с параметром -m. Замените skel_dir именем нужного каталога. (Без этого параметра применяется каталог /etc/skel.)
        -m
	         автоматически создает домашний каталог пользователя и копирует в него файлы из каталога шаблонов (/etc/skel). (Это происходит по умолчанию для Fedora и RHEL, поэтому действие не требуется. А в Ubuntu необходимо его выполнить.) Содержится следующие типы файлов и папок:
                    Конфигурационные файлы:
                        .bashrc, .bash_profile, .profile — файлы конфигурации оболочки, которые настраивают поведение командной оболочки для пользователя.
                        .vimrc, .gitconfig и другие — файлы конфигурации для различных приложений.
                    Структура каталогов:
                        Вы можете создать подкаталоги (например, Documents, Downloads, Pictures), которые будут автоматически созданы в домашнем каталоге пользователя.
                    Шаблоны:
                        Любые другие файлы, которые вы хотите, чтобы новые пользователи имели по умолчанию, например, README-файл с инструкциями или приветственным сообщением.
        -M 
	        не создает домашний каталог нового пользователя, даже если для его создания задано поведение по умолчанию.
        -p пароль 
	        добавляет пароль для новой учетной записи. Он должен быть зашифрованным. Можно добавить пароль не сразу, а применить команду пароль пользователя позже, чтобы задать его для пользователя. (Чтобы сгенерировать зашифрованный пароль MD5, введите команду openssl пароль.)
        -s оболочка 
	        указывает командную оболочку, которая будет использоваться для этой учетной записи. Замените оболочка нужной командной оболочкой,
                например -s /bin/zsh


usermod - изменяет учётную запись пользователя
        Параметры
            -с "имя_пользователя"
	             изменяет описание, связанное с учетной записью пользователя.
            -d домашний_каталог 
	            изменяет домашний каталог, который будет использоваться для учетной записи. По умолчанию он должен носить имя пользователя и размещаться в /home. Замените домашний_каталог
                именем нужного каталога, например -d /mnt/homes/jake;
            -e дата_устаревания 
	            назначает новую дату истечения срока действия для учетной записи в формате ГГГГ-ММ-ДД.
                Замените дата_устаревания нужной датой, например -e 2022-10-15 для 15 октября 2022 года
            -f -1 
	            устанавливает количество дней, которое должно пройти после истечения срока действия пароля, прежде чем учетная запись будет заблокирована. По умолчанию значение -1 отключает этот параметр.
                Значение 0 блокирует учетную запись сразу же по истечении срока действия пароля
            -g группа 
	            изменяет основную группу (как указано в файле /etc/group)
            -G список_групп 
	            добавляет дополнительные группы пользователя в предоставленный список групп, разделенных запятыми.
                Если пользователь уже находится по крайней мере в одной группе, кроме личной, нужно добавить
                параметр -a (-Ga). Если так не сделать, то пользователь будет назначен в новую
                группу, выйдя из всех предыдущих
            -l новое_имя
	             изменяет имя учетной записи
            -L 
	            блокирует учетную запись, поставив восклицательный знак в начале зашифрованного пароля в файле /etc/shadow.
                Данное действие блокирует учетную запись, при этом не трогая пароль (параметр -U разблокирует ее);
            -U 
	            снимает блокировку с учетной записи пользователя, удалив восклицательный знак в начале зашифрованного пароля.
            -m 
	            доступен только совместно с параметром –d. Копирует содержимое домашнего каталога пользователя в новый каталог

                # usermod -s /bin/csh chris
                # usermod -Ga sales,marketing, chris

                В первом примере оболочка заменяется оболочкой csh для пользователя
                с именем chris . Во втором примере пользователю chris назначают
                дополнительные группы. Параметр -a ( -Ga) гарантирует, что дополнительные группы
                будут добавлены к уже существующим группам для пользователя chris.

userdel - удаление пользователей
        Параметры
            -f 
	            позволяет игнорировать некоторые ограничения и выполнять действия, которые обычно блокируются системой. Например, вы можете удалить пользователя, даже если он в данный момент вошел в систему, или удалить файлы, которые не принадлежат текущему пользователю.
            -r 
	             удалить домашний каталог и почтовый ящик При использовании этого параметра программа удалит не только учетную запись пользователя, но и его домашний каталог
            -R, --root КАТ_CHROOT 
	            каталог, в который выполняется chroot Этот параметр позволяет указать корневой каталог, в который будет выполнено изменение корневой
                файловой системы (chroot).
            -P, --prefix PREFIX_DIR 
	            С помощью этого параметра можно указать префиксный каталог, в котором находятся файлы конфигурации, такие как /etc/passwd или /etc/shadow.
                Это может быть полезно в сценариях, где система использует нестандартные пути к конфигурационным файлам.
            -Z, --selinux-user 
	            удалить все пользовательские сопоставления SELinux для пользователя. Этот параметр удаляет все сопоставления SELinux, связанные с указанным пользователем.
                Это может быть необходимо для обеспечения безопасности или для устранения проблем с доступом после изменения прав пользователя или его удаления.

chroot (от "change root") — это команда в Unix и Unix-подобных операционных системах, которая изменяет корневую директорию (root directory) для текущего процесса и его дочерних процессов. Это означает, что процесс будет видеть только файлы и каталоги, находящиеся в новой корневой директории, что создает изолированную среду.
        Зачем нужно chroot?
			1. Изоляция: chroot позволяет создавать изолированные окружения,
				что полезно для тестирования программного обеспечения или для запуска
				приложений с ограниченными правами доступа.
			2. Безопасность: Использование chroot может помочь уменьшить риски безопасности,
				так как злоумышленник, получивший доступ к процессу в chroot,
				не сможет выйти за пределы этой изолированной среды.
			3. Системное восстановление: Часто используется для восстановления систем, позволяя
				загружаться в другую среду и выполнять операции на файловой системе,
				не загружая основную систему.

**SELinux (Security-Enhanced Linux)** — это система управления доступом, разработанная для повышения безопасности Linux-систем.    Она реализует концепцию "модель управления доступом на основе политики" (MAC), что позволяет более гибко управлять правами доступа к ресурсам системы.
    Основные аспекты SELinux:
		1. Политики безопасности: SELinux использует набор правил (политик), которые определяют,
			какие действия могут выполнять различные процессы и пользователи.
		2. Контроль доступа: SELinux может ограничивать доступ к файлам,
			сетевым ресурсам и другим объектам системы на основе контекста безопасности.
		3. Улучшенная безопасность: Благодаря строгому контролю доступа SELinux
			помогает предотвратить несанкционированный доступ и атаки на систему.

В целом, использование chroot и SELinux вместе позволяет создавать безопасные и изолированные среды для выполнения приложений и управления пользователями в Linux-системах.

groupadd - создать учетных записей групп
        Идентификаторы групп от 0 до 999 присваиваются специальным административным группам.
        Например, у root-группы номер GID 0, группы обычных пользователей носят номера начиная с 1000.
        (id username - просмотреть gid группы uid себя...)



### Специальные биты разрешений SETUID, SETGID и Sticky bit

#### SETUID

**Бит доступа SETUID дает возможность запускать файл на исполнение от имени владельца файла.** 
Например, именно так работает программа sudo. Если мы посмотрим на нее через ls, то увидим что вместо ключа x стоит ключ s. Это и означает, что у данного файла включен или выставлен параметр SETUID**.**
![[Pasted image 20241221143034.png]]
Если обычный пользователь запустит этот файл, то файл будет запущен от имени владельца, то есть root. Важно понимать, что никакого ввода пароля при этом не потребуется. А сам запрос и обработка пароля организованы уже внутри программы
**Для того что бы включить бит SETUID** нужно просто выполнить команду
`sudo chmod u+s «путь к файлу»`
**для снятия соответственно**
`sudo chmod u-s «путь к файлу»`


#### SETGID
**Данный параметр работает аналогично параметру SETUID, но только запускает файл от имени группы владельца.**
Установить данный бит можно командой
`sudo chmod g+s «путь к файлу»`
Снять его соответственно командой
`sudo chmod g-s «путь к файлу»`

#### Sticky Bit
Это самый простой и понятный бит из всех. Работает он очень просто. **Если установить его на каталог, то удалить файлы из этого каталога сможет только владелец каталога.**

Для того что бы установить Sticky Bit нужно ввести команду
`sudo chmod +t «Путь к каталогу»`
Что бы снять соответственно
`sudo chmod -t «Путь к каталогу»`