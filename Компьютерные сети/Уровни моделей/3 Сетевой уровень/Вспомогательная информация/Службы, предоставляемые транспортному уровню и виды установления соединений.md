
Службы для транспортного уровня предоставляются сетевым уровнем посредством интерфейса между ними. Главное — определить, какими должны быть эти службы. 

- Службы сетевого уровня не должны зависеть от технологии маршрутизатора.

- Количество, тип и топология имеющихся маршрутизаторов не должны влиять на транспортный уровень.

- Сетевые адреса, доступные транспортному уровню, должны использовать единую систему нумерации, даже между LAN и WAN

Данная свобода выразилась  в яростную борьбу между двумя непримиримыми сторонами. В центре дискуссии — вопрос о том, **какие службы должен предоставлять сетевой уровень: с установлением соединения или без него.**

**Один лагерь** (представленный **интернет-сообществом**) заявляет, что работа маршрутизаторов сводится к перемещению пакетов. С этой точки зрения (основанной на сорокалетнем опыте работы с реальными компьютерными сетями) **сеть по своей природе ненадежна, независимо от того, как она спроектирована. Хосты должны учитывать это и самостоятельно защищаться от ошибок (то есть заниматься их обнаружением и коррекцией) и управлять потоком. Из этого следует, что сетевой службе не нужно требовать установления соединения, она должна в основном состоять из примитивов SEND PACKET (отправить пакет) и RECEIVE PACKET (получить пакет).** В частности, сюда нельзя включать упорядочивание пакетов и контроль потока — все равно эти действия выполнит хост. Нет смысла выполнять одну и ту же работу дважды. ==Такое рассуждение — пример применения сквозного принципа (end-to-end argument)==, оказавшего значительное влияние на формирование интернета. Кроме того, **каждый пакет должен содержать полный адрес получателя, так как передача производится независимо от предшествующих пакетов.**

**Другой лагерь, представленный телефонными компаниями**, утверждает, что сеть должна предоставлять надежную службу с установлением соединения. Компании считают, что 100 лет успешного управления телефонными системами по всему миру серьезный аргумент в их пользу. **По их мнению, определяющим фактором является QoS,** и без установления соединения в сети очень сложно добиться каких-либо приемлемых результатов, особенно когда **дело касается трафика в реальном времени (например, передачи голоса и видео).**

Протокол IP остается основным стандартом в сетевых технологиях, несмотря на появление соединительных технологий, таких как ATM, которые не смогли его заменить. Хотя **IP используется без предварительной установки соединения, растущие требования к качеству обслуживания (QoS) приводят к разработке новых инструментов, которые предполагают установление соединения,** например, мультипротокольная коммутация по меткам и VLAN, которые сегодня широко применяются.

## Реализация службы без установления соединения
#### Сквозной принцип (end-to-end argument) 
Утверждает, что функции обработки данных должны реализовываться на конечных узлах сети, а не на промежуточных устройствах, таких как маршрутизаторы. Это упрощает архитектуру сети, позволяя маршрутизаторам сосредоточиться на передаче пакетов без дополнительных функций. Каждый пакет должен содержать полный адрес получателя, так как передача производится независимо от предшествующих пакетов.

**пакеты называют дейтаграммами (datagrams)
сети — дейтаграммными (datagram network).**

Сети без установки соединения, такие как те, что работают на основе протокола IP, функционируют по принципу передачи дейтаграмм. В этом процессе важные аспекты работы сети включают:

1. **Передача данных**: Процесс P1 передает длинное сообщение на транспортный уровень, указывая, что оно должно быть доставлено процессу P2 на хосте Н2. Транспортный уровень добавляет заголовок к сообщению и передает его на сетевой уровень.

2. **Фрагментация**: Если сообщение превышает максимальный размер пакета, сетевой уровень разбивает его на несколько частей (фрагментов) и отправляет их поочередно.

3. **Маршрутизация**: Каждый пакет передается через маршрутизаторы, которые используют свои таблицы маршрутизации для определения следующего хопа. Таблицы содержат адреса назначения и соответствующие исходящие линии.

4. **Контрольная сумма**: При поступлении пакетов на маршрутизатор они проверяются на целостность с помощью контрольной суммы.

5. **Обновление маршрутов**: Маршрутизаторы могут изменять маршруты в зависимости от текущей загрузки сети или других факторов, используя алгоритмы маршрутизации.

6. **Протоколы**: Протоколы, такие как PPP (Point-to-Point Protocol), используются для передачи данных между узлами и обеспечивают защиту от потерь.

7. **IP-адресация**: Каждый пакет содержит IP-адрес назначения, что позволяет маршрутизаторам индивидуально обрабатывать и отправлять пакеты, независимо от их порядка.
	![[Pasted image 20241222192032.png]]



## Реализация службы на установление соединения
#### Соединительным (connection-oriented). 
В таком типе связи устанавливается предварительное соединение, которое обеспечивает надежную передачу данных с гарантией качества обслуживания (QoS).

#### Виртуальный канал (VC, Virtual Circuit) 
Это логическое соединение между узлами сети, которое устанавливается для передачи данных. Он создается в сетях, ориентированных на установление соединения, таких как сети с протоколом ATM (Asynchronous Transfer Mode) или Frame Relay. 
При установлении виртуального канала определяется маршрут, по которому будут передаваться данные, и создается таблица маршрутизации, которая используется для управления передачей информации. Виртуальный канал обеспечивает надежность и предсказуемость доставки данных, так как все пакеты следуют по заранее определенному пути, что позволяет гарантировать порядок их доставки и минимизировать задержки. 
**Один и тот же маршрут используется для всего трафика, проходящего через данное соединение.** Именно так работает телефонная система. **Когда соединение разрывается, виртуальный канал прекращает свое существование.** При использовании службы с установлением соединения каждый **пакет включает в себя идентификатор виртуального канала**.

1. **Установление соединения**: Хост Н1 инициирует соединение с хостом Н2, которое запоминается и становится первой записью в таблицах маршрутизации всех задействованных маршрутизаторов. Это означает, что маршрутизатор А знает, что если пакет с идентификатором соединения 1 приходит от Н1, его нужно направить к маршрутизатору С с тем же идентификатором.

2. **Передача пакетов**: Маршрутизатор С также направляет пакеты на хост Е, сохраняя идентификатор соединения 1. Таким образом, все маршрутизаторы в цепочке знают о существующем соединении и могут корректно обрабатывать пакеты.

3. **Конфликт идентификаторов и решение**: Если хост Н3 решает установить соединение с Н2 и выбирает тот же идентификатор соединения 1, возникает конфликт. Хотя маршрутизатор А может различить пакеты от Н1 и Н3, маршрутизатор С не имеет такой возможности. Присвоение нового идентификатора: Чтобы избежать конфликтов, маршрутизатор А присваивает новому исходящему трафику уникальный идентификатор соединения, создавая тем самым второе соединение. Это позволяет различать пакеты от разных хостов, даже если они используют один и тот же идентификатор.
	 ![[Pasted image 20241222202929.png]]


## Сравнение сетей виртуальных каналов и дейтаграммных сетей

| Проблема                                       | Дейтаграммы                                                 | Виртуальные каналы                                                                                |
| ---------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| Установка канала                               | Не требуется                                                | Требуется                                                                                         |
| Адресация                                      | Каждый пакет содержит полный адрес отправителя и получателя | Каждый пакет содержит короткий номер<br>виртуального канала                                       |
| Информация о состоянии                         | Маршрутизаторы не содержат информации о состоянии           | Каждый виртуальный канал требует места<br>в таблице маршрутизатора                                |
| Маршрутизация                                  | Маршрут каждого пакета выбирается независимо                | Маршрут выбирается при установке виртуального канала. Каждый пакет следует по этому маршруту      |
| Эффект от выхода<br>маршрутизатора<br>из строя | Никакого, кроме потерянных пакетов                          | Все виртуальные каналы, проходившие через отказавший маршрутизатор, прекращают существование      |
| QOS                                            | Трудно реализовать                                          | Легко реализуется при наличии достаточного количества ресурсов для каждого<br>виртуального канала |
| Борьба с перегрузкой                           | Трудно реализовать                                          | Легко реализуется при наличии достаточного количества ресурсов для каждого<br>виртуального канала |

1. **Компромисс между временем установки соединения и временем обработки адреса**:

   • Виртуальные каналы требуют времени на установку, но упрощают обработку данных.

   • Дейтаграммные сети не требуют установки, но имеют более сложный процесс поиска адреса.

2. **Длина адресов**:

   • Адреса в дейтаграммных сетях глобальные и длиннее, чем номера каналов в виртуальных каналах, что может снизить пропускную способность из-за увеличенных накладных расходов.

3. **Объем памяти маршрутизатора**:

   • Дейтаграммные сети требуют больше памяти для хранения адресов всех возможных получателей, тогда как виртуальные каналы требуют памяти только для активных каналов.

4. **Преимущества виртуальных каналов**:

   • Обеспечение качества обслуживания (QoS) и предотвращение заторов, так как ресурсы можно зарезервировать заранее.

   • Подходят для длительных операций, таких как обмен данными через VPN.

5. **Недостатки виртуальных каналов**:

   • Уязвимость к сбоям: выход из строя маршрутизатора приводит к прерыванию всех каналов.

   • В случае сбоя в дейтаграммной сети теряются только пакеты, находившиеся на маршрутизаторе в момент сбоя.

6. **Балансировка трафика**:

   • В дейтаграммных сетях маршрутизаторы могут изменять путь передачи данных для балансировки трафика, что не возможно в системах с установленными виртуальными каналами.



