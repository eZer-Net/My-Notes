
## Сетевой уровень отвечает 

**За передачу пакетов от отправителя получателю.** Чтобы достичь пункта назначения, пакет может совершить множество скачков между маршрутизаторами. Это резко контрастирует с деятельностью канального уровня, цель которого намного скромнее — просто перемещать фреймы с одного конца «провода» (виртуального) на другой. Таким образом, **сетевой уровень является самым нижним уровнем, имеющим дело с передачей данных по всему пути от начала до конца**. Так же он следит за длинной пакета, который получает от транспортного уровня.
**Для достижения этих целей** сетевой уровень должен знать топологию сети (то есть весь набор маршрутизаторов и каналов) и рассчитывать подходящие маршруты, даже если она достаточно крупная. **При выборе пути он также должен заботиться о равномерной нагрузке на маршрутизаторы и линии связи**. Наконец, когда источник и адресат находятся в разных независимо управляемых сетях (иногда называемых автономными системами), приходится решать ряд дополнительных вопросов, включая проблему координации потоков трафика в рамках нескольких сетей и управление загруженностью сети. 

****
# Службы, предоставляемые транспортному уровню

Службы для транспортного уровня предоставляются сетевым уровнем посредством интерфейса между ними. Главное — определить, какими должны быть эти службы. 

- Службы сетевого уровня не должны зависеть от технологии маршрутизатора.

- Количество, тип и топология имеющихся маршрутизаторов не должны влиять на транспортный уровень.

- Сетевые адреса, доступные транспортному уровню, должны использовать единую систему нумерации, даже между LAN и WAN

Данная свобода выразилась  в яростную борьбу между двумя непримиримыми сторонами. В центре дискуссии — вопрос о том, **какие службы должен предоставлять сетевой уровень: с установлением соединения или без него.**

## [[Службы, предоставляемые транспортному уровню и виды установления соединений#Реализация службы без установления соединения|Реализация службы без установления соединения]]

Утверждает, что функции обработки данных должны реализовываться на конечных узлах сети, а не на промежуточных устройствах, таких как маршрутизаторы. Это упрощает архитектуру сети, позволяя маршрутизаторам сосредоточиться на передаче пакетов без дополнительных функций. Каждый пакет должен содержать полный адрес получателя, так как передача производится независимо от предшествующих пакетов.

**пакеты называют дейтаграммами (datagrams)
сети — дейтаграммными (datagram network).

## [[Службы, предоставляемые транспортному уровню и виды установления соединений#Реализация службы на установление соединения|Реализация службы на установление соединения]]

**Соединительным (connection-oriented).** 
В таком типе связи устанавливается предварительное соединение, которое обеспечивает надежную передачу данных с гарантией качества обслуживания (QoS).

**Виртуальный канал (VC, Virtual Circuit)** 
Это логическое соединение между узлами сети, которое устанавливается для передачи данных. Он создается в сетях, ориентированных на установление соединения, таких как сети с протоколом ATM (Asynchronous Transfer Mode) или Frame Relay. 

****
# Алгоритмы маршрутизации в рамках одной сети

**Основная функция сетевого уровня заключается в маршрутизации пакетов от начальной до конечной точки.** Как эта задача выполняется в рамках одного административного домена или одной автономной системы. В большинстве сетей **пакетам приходится проходить через несколько маршрутизаторов**. Единственное исключение — широковещательные сети, но даже в них маршрутизация **представляет собой проблему, если отправитель и получатель находятся в разных сегментах сети**. **Алгоритмы, выбирающие путь, и используемые ими структуры данных составляют основу проектирования сетевого уровня.**
#### [[Алгоритмы маршрутизации в рамках одной сети#Алгоритм маршрутизации (routing algorithm)|Алгоритм маршрутизации (routing algorithm)]] 
Это компонент программного обеспечения сетевого уровня, отвечающий за выбор выходной линии для отправки поступившего пакета. 
**Если сеть использует дейтаграммную службу**, выбор маршрута должен производиться заново для каждого пакета, так как оптимальный путь мог измениться. 
**При использовании виртуальных каналов** маршрут определяется только при создании нового канала, и после этого по нему следуют все пакеты данных. Этот подход называют **сеансовой маршрутизацией (session routing)**, так как путь существует на протяжении всего сеанса связи (например, пока вы подключены к VPN).

**Маршрутизатор выполняет два основных процесса:** 
1. Пересылка (forwarding) — обработка приходящих пакетов и выбор исходящей линии на основе таблицы маршрутизации.
2. Маршрутизация — заполнение и обновление таблиц маршрутизации с помощью алгоритмов.
Эти процессы позволяют маршрутизатору эффективно направлять данные в сети.

#### [[Алгоритмы маршрутизации в рамках одной сети#Принцип оптимальности|Принцип оптимальности]]
Принцип оптимальности — это ключевое понятие в теории оптимизации и алгоритмах маршрутизации, сформулированное Ричардом Беллманом в 1957 году. Он утверждает, что оптимальный путь между двумя узлами в сети может быть разбит на две части, где каждая из этих частей также должна быть оптимальной.

#### [[Алгоритмы маршрутизации в рамках одной сети#Алгоритм поиска кратчайшего пути|Алгоритм поиска кратчайшего пути]]
#### [[Алгоритмы маршрутизации в рамках одной сети#Лавинная адресация|Лавинная адресация]]
#### [[Алгоритмы маршрутизации в рамках одной сети#Маршрутизация по вектору расстояний|Маршрутизация по вектору расстояний]]
#### [[Алгоритмы маршрутизации в рамках одной сети#Маршрутизация с учетом состояния линий|Маршрутизация с учетом состояния линий]]
#### [[Алгоритмы маршрутизации в рамках одной сети#Иерархическая маршрутизация внутри сети|Иерархическая маршрутизация внутри сети]]
#### [[Алгоритмы маршрутизации в рамках одной сети#Широковещательная маршрутизация|Широковещательная маршрутизация]]
#### [[Алгоритмы маршрутизации в рамках одной сети#Многоадресная рассылка|Многоадресная рассылка]]

#### [[Алгоритмы маршрутизации в рамках одной сети#Произвольная маршрутизация|Произвольная маршрутизация]]


****
# Управление трафиком на сетевом уровне

Слишком большое количество пакетов в любой части сети может в конечном итоге привести к задержке и потере пакетов, что негативно скажется на производительности. Такая ситуация называется перегрузкой (congestion).
#### [[Управление трафиком на сетевом уровне#Необходимость в управлении трафиком перегрузка|Необходимость в управлении трафиком: перегрузка]]
**За борьбу с перегрузкой отвечают сетевой и транспортный уровни.**
Поскольку она происходит в сети, именно сетевой уровень сталкивается с ней непосредственно и определяет, что делать с лишними пакетами. Самое эффективное решение — уменьшить нагрузку на сеть со стороны транспортного уровня; это значит, что оба уровня должны работать вместе. 
**В определенный момент может возникнуть коллапс сети** из-за перегрузки (congestion collapse), при котором производительность падает, поскольку абонентская нагрузка превышает пропускную способность. **Коллапс сети происходит, когда увеличение нагрузки фактически ведет к уменьшению объема успешно доставленного трафика. При этом пакеты настолько задерживаются, что становятся бесполезными к моменту их доставки.**
#### [[Управление трафиком на сетевом уровне#Методы управления трафиком|Методы управления трафиком]]
Перегрузка означает, что нагрузка на сеть превышает (временно) возможности ресурсов сети (или некоторой ее части). **Существует два возможных решения:**
**увеличить объем ресурсов или снизить нагрузку.** 
Эти решения обычно применяются в разных временных рамках в зависимости
от задачи: предотвратить перегрузку или справиться с ней, если ее не удалось
избежать.
![[Pasted image 20241223133313.png]]


#### [[Управление трафиком на сетевом уровне#Маршрутизация с учетом состояния трафика|Маршрутизация с учетом состояния трафика]]
Методы маршрутизации используют фиксированные весовые коэффициенты связей, которые адаптируются к изменениям топологии, но не к изменениям нагрузки трафика. Однако нагрузку также следует учитывать при вычислении маршрутов, чтобы направлять трафик в обход наиболее подверженных перегрузке участков.

#### [[Управление трафиком на сетевом уровне#Управление допуском|Управление допуском]]
Популярный метод предотвращения перегрузки в сетях виртуальных каналов — управление допуском (admission control). Идея проста: **не создавать новый виртуальный канал до тех пор, пока сеть не сможет обработать дополнительный трафик без перегрузки.**
**Суть этого подхода в том, чтобы определить, когда добавление нового виртуального канала приведет к перегрузке.** 

#### [[Управление трафиком на сетевом уровне#Сброс нагрузки|Сброс нагрузки]]
Когда ни один из описанных методов не помогает в борьбе с перегрузкой, маршрутизаторы могут ввести в бой тяжелую артиллерию — сброс нагрузки (load
shedding). По сути, **это игнорирование маршрутизаторами пакетов, которые**
**они не могут обработать.**
#### [[Управление трафиком на сетевом уровне#Формирование трафика|Формирование трафика]]
**Чтобы гарантировать пользователю определенную производительность, сеть**
**должна знать примерный объем трафика.**

**Шейпинг трафика (traffic shaping)** — способ регулировки средней скорости
и равномерности потока входных данных. Приложения должны иметь возможность передавать тот трафик, который им нужен (включая неравномерный)

**Алгоритм дырявого ведра и алгоритм маркерного ведра связаны с формированием трафика** 

#### [[Управление трафиком на сетевом уровне#Активное управление очередью|Активное управление очередью]]
В интернете и многих других компьютерных сетях отправители передают столько трафика, сколько сеть в состоянии успешно доставить. В таком режиме сеть работает до тех пор, пока она не перегружена. **Если перегрузка неизбежна, она просит отправителей снизить скорость передачи данных. Этот режим работы называется предотвращением перегрузки (congestion avoidance)** в противопоставление ситуации, в которой сеть уже перегружена.

Несколько подходов к замедлению трафика, применяемых в дейтаграммных сетях и сетях виртуальных каналов. 
**Каждый подход должен решать две проблемы.**
- Предотвращение перегрузки до ее возникновения.
- Обеспечение более точного мониторинга состояния трафика для принятия оперативных решений.

##### [[Управление трафиком на сетевом уровне#Алгоритм произвольным ранним обнаружением перегрузки (Random Early Detection, RED).|Алгоритм произвольным ранним обнаружением перегрузки (Random Early Detection, RED)]] 
Чтобы определить, когда следует удалять пакеты, маршрутизаторы постоянно высчитывают скользящее среднее длин своих очередей. Если средняя длина очереди на каком-либо соединении превышает пороговое значение, эта линия объявляется перегруженной и небольшая часть пакетов удаляется случайным образом.
##### [[Управление трафиком на сетевом уровне#Сдерживающие пакеты.|Сдерживающие пакеты]]
Самый простой способ уведомить отправителя о перегрузке — сообщить об
этом прямо. При таком подходе маршрутизатор выбирает перегружающий пакет и отправляет источнику сдерживающий пакет (choke packet). 
##### [[Управление трафиком на сетевом уровне#Явное уведомление о перегрузке|Явное уведомление о перегрузке]]
Вместо создания дополнительных пакетов маршрутизатор может добавить специальную метку (например, 1 или 0 в заголовке) в любой передаваемый пакет, тем самым сообщая о перегрузке. Когда пакет будет доставлен, получатель поймет, что сеть перегружена, и добавит эту информацию в ответный пакет. 

##### [[Управление трафиком на сетевом уровне#Обратное давление на ретрансляционных участках|Обратное давление на ретрансляционных участках]]
При высоких скоростях или больших расстояниях до хостов множество новых пакетов может быть передано даже после отправки уведомлений о перегрузке, поскольку реакция на них занимает некоторое время.
Заключается в том, что сдерживающий пакет влияет на трафик каждого маршрутизатора, за счет использования большего объема буферной памяти промежуточных маршрутизаторов.

****
# QOS И QOE приложений

Методы, представленные в предыдущих разделах, направлены на устранение перегрузок и повышение производительности сети. Однако **некоторым приложениям (и клиентам) нужны более строгие гарантии качества, чем просто обязательство предоставить «лучшее из возможного в данных обстоятельствах» (иногда это называется подходом best effort).** Кроме того, многие приложения требуют определенной минимальной пропускной способности и плохо функционируют, если задержка превышает некоторое пороговое значение.
В последнее время важную роль приобретает **QoE (Quality of Experience — качество пользовательского опыта)**, поскольку в конечном итоге важен лишь полученный пользователем опыт взаимодействия, а у разных приложений пороговые значения и требования к производительности сети могут сильно различаться.

## [[QOS И QOE приложений#Требования приложений к QoS|Требования приложений к QoS]]

Последовательность пакетов, передающихся от источника к получателю, называется потоком (flow). При этом в сетях, ориентированных на установление соединения, его могут составлять все пакеты канала, а в сетях без установления соединения — все пакеты, отправленные от одного процесса к другому. 
**Каждый поток требует определенных условий, которые можно охарактеризовать четырьмя основными параметрами: пропускная способность, задержка, джиттер, потери.** 
Все вместе они формируют необходимый потоку **QoS (Quality of Service — качество обслуживания).**

## Избыточное обеспечение

Существует простой способ предоставления QoS высокого уровня — **создание сети с пропускной способностью, позволяющей передавать любой трафик**. Этот метод называется избыточным обеспечением (overprovisioning).
Пример телефонная сеть является системой с избыточным обеспечением. Ситуация, когда абонент поднимает трубку и не слышит гудка, маловероятна. Дело в том, что в систему заложена настолько большая пропускная способность, что превысить ее тяжело. **Единственная проблема — такой способ обходится очень дорого**. Конечно, ее можно решить путем крупных финансовых вливаний.

## Избыточное обеспечение альтернативный механизм QoS

**С помощью QoS сеть может выполнить свои обязательства даже при резком увеличении объема трафика за счет отклонения некоторых запросов.** Чтобы обеспечить QoS, необходимо ответить на следующие вопросы.

- Что приложениям нужно от сети?

- Как регулировать трафик, поступающий в сеть?

- Как зарезервировать ресурсы на маршрутизаторах, необходимые для обеспечения производительности?

- Может ли сеть принять больший объем трафика?

**Нет единого решения для всех этих вопросов**, поэтому разработаны различные методы на сетевом и транспортном уровнях. В практике часто используется комбинация этих методов. Рассмотрим два варианта QoS для интернета: комплексное и дифференцированное обслуживание.

## [[QOS И QOE приложений#Планирование пакетов|Планирование пакетов]]

Возможность регулировать форму предлагаемого трафика — это хорошее начало. Но чтобы предоставлять клиенту гарантии производительности, необходимо резервировать достаточное количество ресурсов. Будем считать, что все пакеты в потоке следуют по одному и тому же пути. **При случайном распределении пакетов между маршрутизаторами сложно что-либо гарантировать. Следовательно, между источником и получателем должно быть установлено нечто вроде виртуального канала**, и все пакеты данного потока должны следовать по указанному маршруту.

**Механизмы, распределяющие ресурсы маршрутизаторов между пакетами одного потока или между конкурирующими потоками, называются алгоритмами планирования пакетов (packet scheduling algorithm)**. [[QOS И QOE приложений#Для разных потоков могут резервироваться три типа ресурсов|Для разных потоков могут резервироваться три типа ресурсов:]]

#### [[QOS И QOE приложений#Планирование пакетов по принципу FIFO|Планирование пакетов по принципу FIFO]]

Алгоритмы планирования пакетов распределяют пропускную способность
и другие ресурсы маршрутизатора, решая, какой пакет из буфера отправить
по исходящей линии следующим. **Каждый маршрутизатор помещает пакеты в очередь** (отдельную для каждой исходящей линии), где они ждут отправки. 


#### [[QOS И QOE приложений#Справедливое обслуживание|Справедливое обслуживание]]

Планирование по принципу FIFO легко реализовать, но оно не обеспечивает
высокий уровень QoS: если потоков несколько, один из них может влиять на
производительность других. `Если поток ведет себя агрессивно и отправляет большие объемы трафика, его пакеты попадают в очередь.`
**При обработке в порядке поступления этот отправитель захватывает большую часть мощности маршрутизаторов, отбирая ее у других потоков и тем самым уменьшая их уровень QoS.** 
Чтобы обеспечить изоляцию потоков и предотвратить их конфликты, было разработано множество различных алгоритмов планирования пакетов. **Одним из первых был алгоритм [[QOS И QOE приложений#Алгоритм равноправных очередей|равноправных очередей (fair queueing)]] (Нейгл; Nagle, 1987).**
Маршрутизаторы организуют отдельные очереди для каждой исходящей линии, по одной для каждого потока. Однако и у этого метода есть один недостаток. Предоставляемая им пропускная способность напрямую зависит от размера пакетов, отправляемых хостом: чем они крупнее, тем больше ресурса ему выделяется.
В книге Демерса и др. (Demers et al., 1990) предлагается улучшенная версия алгоритма, в которой циклический опрос производится с целью выхватывания байта, а не пакета **[[QOS И QOE приложений#Алгоритм FQ и примеры значений времени окончания отправки пакетов для трех потоков|FQ]]**.

#### [[QOS И QOE приложений#Взвешенные равноправные очереди|Взвешенные равноправные очереди]]

Проблема алгоритма FQ справедливо обслуживание в том, что он дает всем хостам одинаковые приоритеты. Как правило, видеосерверам лучше предоставлять большую пропускную способность, чем обычным файл-серверам, чтобы они могли передавать два или несколько байтов за цикл. Такая **модификация алгоритма называется взвешенными равноправными очередями (Weighted Fair Queueing, WFQ), которая определяет приоритет пакетам**.
#### [[QOS И QOE приложений#Собираем все воедино|Собираем все воедино]]

Гарантии QoS предоставляются через управление допуском.
Когда пользователь передает поток данных в сеть, он ожидает, что определенные требования к качеству обслуживания (QoS) будут соблюдены. Сеть, в свою очередь, должна решить, сможет ли она принять этот поток, учитывая свои возможности и обязательства перед другими клиентами. Если поток принимается, необходимо заранее зарезервировать ресурсы на всех маршрутизаторах вдоль пути передачи, чтобы гарантировать требуемый уровень QoS.
**Приложения различаются по своей толерантности к пропущенным срокам обработки,**
и для них выбираются разные типы гарантий качества обслуживания (QoS) — от строгих до более лояльных. 

В качестве содержимого спецификации потока изображение которое иллюстрирует стандарты **[[QOS И QOE приложений#Стандарты RFC 2210 и RFC 2211 для комплексного обслуживания — технологии QoS.|RFC 2210 и RFC 2211]]** для комплексного обслуживания — технологии QoS.

## [[QOS И QOE приложений#Комплексное обслуживание|Комплексное обслуживание]]

Комплексное обслуживание (integrated services). Эта технология предназначена как для одноадресных, так и для многоадресных приложений. В одноадресных случаях это может быть просмотр потокового видео на новостном сайте одним пользователем; В многоадресных набор станций цифрового телевидения, транслирующих свои программы в виде потоков IP-пакетов. Данной услугой может пользоваться большое число абонентов в разных географических точках.

Метод предварительного резервирования пропускной способности не подходит для многопользовательских приложений с многоадресной маршрутизацией, так как участники могут динамически изменяться, что требует от источников запоминания всех изменений состава аудитории. В системах, передающих сигнал миллионам абонентов, такая стратегия вообще неэффективна.

#### [[QOS И QOE приложений#RSVP — протокол резервирования ресурсов|RSVP — протокол резервирования ресурсов]]
Протокол резервирования ресурсов (Resource reSerVation Protocol, RSVP), он описывается в стандартах RFC 2205–RFC 2210.

Протокол предназначен для резервирования ресурсов; другие протоколы применяются для описания передачи данных. **RSVP позволяет нескольким отправителям отправлять данные нескольким группам абонентов, разрешает отдельным получателям переключать каналы и оптимизирует использование пропускной способности, в то же время устраняя перегрузки.**

- [[QOS И QOE приложений#Пример сети|Пример сети]]
- [[QOS И QOE приложений#Пример резервирования показан|Пример резервирования показан]]


## [[QOS И QOE приложений#Дифференцированное обслуживание|Дифференцированное обслуживание]]

**Потоковые алгоритмы способны обеспечивать хороший уровень QoS одного или нескольких потоков за счет резервирования любых необходимых ресурсов на протяжении всего маршрута.** Однако есть у них и недостаток. **Они требуют предварительной настройки при установке каждого потока, что не подходит для**
**систем с тысячами или миллионами потоков.** 
Кроме того, **потоковые алгоритмы используют внутреннюю информацию о потоках, которая хранится в маршрутизаторах. Это делает их уязвимыми к выходу маршрутизаторов из строя**. Наконец, о**ни требуют значительных программных изменений в маршрутизаторах, связанных со сложными процессами обмена между ними при установке потоков.** В результате с развитием комплексного обслуживания подобные алгоритмы используются крайне редко.

По этим причинам **IETF разработал упрощенный подход к QoS.** Его можно реализовать локально в каждом маршрутизаторе без предварительной настройки и без участия остальных устройств маршрута. 
Известен как основанное на классах (в отличие от основанного на потоках) QoS. **IETF стандартизировал специальную архитектуру под названием дифференцированное обслуживание (differentiated services)** и описал в документах **RFC 2474, RFC 2475** и во многих других.

**Дифференцированное обслуживание может предоставляться набором маршрутизаторов, которые образуют административный домен (например, интернет-провайдер или телефонную компанию)**. Администрация определяет набор классов обслуживания и соответствующие правила маршрутизации. **Пакеты от абонента, пользующегося дифференцированным обслуживанием, получают метку с информацией о классе. Эти сведения записываются в поле Differentiated services пакетов IPv4 и IPv6**

#### [[QOS И QOE приложений#Беспрепятственная пересылка|Беспрепятственная пересылка]]
Идея, на которой основана беспрепятственная пересылка, очень проста. **Существует два класса обслуживания: обычный и ускоренный.** 

#### [[QOS И QOE приложений#Гарантированная пересылка|Гарантированная пересылка]]
**Более совершенная схема управления классами обслуживания — гарантированная пересылка (assured forwarding), описанная в документе RFC 2597.**
Она подразумевает наличие четырех классов приоритетов, каждый из которых обладает своими ресурсами. Кроме того, определены три класса игнорирования пакетов при перегрузке (низкий, средний и высокий). В итоге получается 12 сочетаний, то есть 12 классов обслуживания.

****
# Межсетевое взаимодействие

Существует множество различных сетей, включая PAN, LAN, MAN и WAN. Уже рассмотрели сети Ethernet, кабельном интернете, стационарных и мобильных телефонных сетях, сетях стандарта 802.11 и т. д. На каждом уровне этих сетей широко применяются многочисленные протоколы.

## [[Межсетевое взаимодействие#Интерсети (internet) общие сведения|Интерсети (internet): общие сведения]]

В следующих разделах особое внимание будет уделено вопросам, возникающим
при объединении двух или более сетей, формирующих объединенную сеть
(internetwork), или, проще, интерсеть (internet).

Боб Меткалф выдвинул такой принцип: **ценность сети, состоящей из N узлов, пропорциональна числу соединений между узлами, или N2.**

## [[Межсетевое взаимодействие#Различия сетей и проблемы объединения|Различия сетей и проблемы объединения]]

## [[Межсетевое взаимодействие#Объединение гетерогенных сетей|Объединение гетерогенных сетей]]

**Существует два основных способа объединения различных сетей**. Можно **создать специальные устройства, транслирующие или конвертирующие пакеты** между сетями разного типа. Или, как это часто делают специалисты в области компьютерных наук, можно **добавить уровень косвенной адресации и создать общий уровень над сетями**. В любом случае **на границе между сетями размещаются устройства, которые изначально назывались шлюзами (gateways).**
 
==**В IP используется универсальный формат пакетов, который распознается всеми маршрутизаторами и может быть передан почти по любой сети.**== 

**Шлюзы — высокоуровневые интеркоммуникационные устройства**

- [[Межсетевое взаимодействие#На илл. (а) изображена интерсеть, состоящая из сетей 802.11, MPLS и Ethernet. (б) Выполнение протоколов на сетевом и канальном уровнях|Иллюстрация работы изображена интерсети, состоящая из сетей 802.11, MPLS и Ethernet и выполнения протоколов на сетевом и канальном уровнях.]]

- [[Межсетевое взаимодействие#Протокол IP и передача пакетов|Протокол IP и передача пакетов]]


**Сложно заставить всех использовать один формат, учитывая, что каждая компания видит коммерческую выгоду в том, чтобы иметь собственный протокол. Помимо IP, который на данный момент является практически универсальным сетевым протоколом, существуют IPX, SNA и AppleTalk**. 

**Маршрутизатор, поддерживающий несколько сетевых протоколов, называется [[Межсетевое взаимодействие#Маршрутизатор, поддерживающий несколько сетевых протоколов, называется многопротокольным маршрутизатором (multiprotocol router)|многопротокольным маршрутизатором (multiprotocol router)]]**. 

Другой вариант — [[Межсетевое взаимодействие#Другой вариант — конвертация пакетов между разными сетями.|конвертация пакетов между разными сетями]]. Однако если пакеты не близки по формату и не имеют одинаковых информационных полей, такое преобразование всегда будет неполным и часто обречено на ошибку.*

**Вероятно, IP работает так хорошо только потому, что служит чем-то вроде наименьшего общего знаменателя. Он не многого требует от сетей, однако предоставляет только уровень обслуживания best effort (Негарантированная доставка)**.

## [[Межсетевое взаимодействие#Соединение конечных точек в гетерогенных сетях|Соединение конечных точек в гетерогенных сетях]]

Объединение сетей в общем случае **является исключительно сложной задачей. Однако существует частный случай, реализация которого вполне осуществима** даже для разных сетевых протоколов. Это **ситуация, при которой хост-источник и хост-приемник расположены в одинаковых сетях, но между ними находится сеть другого типа.**

**Путь через сеть IPv4 можно рассматривать как большой туннель, идущий от одного многопротокольного маршрутизатора до другого. IPv6-пакет просто перемещается от одного конца туннеля до другого в удобной «коробке».**
**[[Межсетевое взаимодействие#Она называется оверлейной сетью (overlay).|Оверлейная сеть (overlay)]]**

## [[Межсетевое взаимодействие#Межсетевая маршрутизация|Межсетевая маршрутизация]]

- [[Межсетевое взаимодействие#Проблемы маршрутизации в интерсетях|Проблемы маршрутизации в интерсетях]]

- [[Межсетевое взаимодействие#Требования к алгоритму для решения проблем при маршрутизации|Требования к алгоритму для решения проблем при маршрутизации]]

## [[Межсетевое взаимодействие#Поддержка различных размеров пакета фрагментация пакета|Поддержка различных размеров пакета: фрагментация пакета и MTU]]

 Разработчики не могут выбирать максимальный размер пакета по своему усмотрению. Максимальный размер поля полезной нагрузки составляет 1500 байт для сети Ethernet и 2272 байта для 802.11. Протокол IP более щедр: размер пакета может достигать 65 515 байт.

#### [[Межсетевое взаимодействие#Фрагментация|Фрагментация]]
Позволить шлюзам разбивать пакеты на фрагменты (fragments) и отправлять каждый из них в виде отдельного пакета сетевого уровня.

В сетях с коммутацией пакетов также существует проблема объединения фрагментов. **Для восстановления исходных пакетов применяются две противоположные стратегии прозрачная и не прозрачная.** 

- [[Межсетевое взаимодействие#Сравнение вариантов фрагментации|Изображение сравнения прозрачной и не прозрачной фрагментации]]

- [[Межсетевое взаимодействие#Проблемы прозрачной фрагментации|Проблемы прозрачной фрагментации]]

- [[Межсетевое взаимодействие#Проблемы не прозрачной фрагментации|Проблемы не прозрачной фрагментации]]

- [[Межсетевое взаимодействие#Пример пакета при фрагментации|Пример пакета при фрагментации]]

#### [[Межсетевое взаимодействие#MTU (Path Maximum Transmission Unit — максимальный размер пакета для выбранного пути)|MTU (Path Maximum Transmission Unit — максимальный размер пакета для выбранного пути)]]
**Стратегия, использующаяся в современном интернете, называется**
**поиском путевого значения MTU (Path MTU discovery), заключается в том что отправляют пакет по которому будет определяться размер дальнейших отправок.**

При отправке IP-пакета в его заголовке указывается, что фрагментация запрещена. Если маршрутизатор получает слишком большой пакет, он удаляет его и отправляет источнику сообщение об ошибке. Используя эту информацию, отправитель перераспределяет данные так, чтобы пакеты смогли пройти через маршрутизатор. Если такая проблема возникнет на одном из следующих маршрутизаторов, процесс повторится.

- [[Межсетевое взаимодействие#Пример работы MTU|Пример работы MTU]]

- [[Межсетевое взаимодействие#Преимущества и организация работы|Преимущества и организация работы]] 

- [[Межсетевое взаимодействие#Недостатки и варианты решения их|Недостатки и варианты решения их]]

****
# Программно-конфигурационные сети

Управление трафиком в сетях представляет собой сложный процесс, требующий от операторов настройки параметров конфигурации протоколов маршрутизации. Эти изменения приводят к перераспределению нагрузки по новым маршрутам, однако механизмы управления трафиком действуют косвенно и могут быть непредсказуемыми. Проблемы, возникающие в этом контексте, частично решаются с помощью **программно-конфигурируемых сетей (SDN Software-Defined Networking)**, которые будут рассмотрены далее.

#### Общие сведения
Главной причиной разработки SDN стало понимание, что плоскость управления (control plane) (логика выбора маршрутов и принятия решений о передаче) работает на программном уровне и может выполняться абсолютно независимо от плоскости данных (data plane) (аппаратных технологий, которые непосредственно извлекают информацию из пакетов и решают, что с ними делать).  технология SDN активно развивается в течение многих лет, основной принцип разделения плоскости данных и плоскости управления остается неизменным.


## [[Программно-конфигурационные сети#Плоскость управления в SDN логически централизованное программное управление|Плоскость управления в SDN: логически централизованное программное управление]]

Одна из главных технических идей в основе SDN — наличие плоскости управления, работающей независимо от маршрутизаторов, часто в виде единственной логически централизованной программы.
**Первые исследования в области SDN были направлены на то, чтобы упростить**
**для сетевых операторов задачу по регулированию трафика.**

В результате был создан **протокол OpenFlow** 2008г.

- [[Программно-конфигурационные сети#Протокол OpenFlow|Протокол OpenFlow]]

- [[Программно-конфигурационные сети#Итог протокола OpenFlow|Итог протокола OpenFlow]]


## [[Программно-конфигурационные сети#Плоскость управления в SDN логически централизованное программное управление|Плоскость данных в SDN: программируемое оборудование]]

В силу очевидных ограничений чипсета OpenFlow цель последующей работы с SDN заключалась в повышении степени программируемости самого оборудования. Множество разработок в этой области, касающихся сетевых карт и коммутаторов, обеспечили настройку практически всех параметров, от формата пакета до режима передачи.
**Для этой архитектуры используется общее название — протоколонезависимая архитектура коммутатора (protocol-independent switch architecture). Она предполагает наличие фиксированного набора конвейеров обработки. Каждый из них обладает памятью для таблиц сопоставления действий и определенным объемом регистровой памяти, а также поддерживает ряд простых операций, например добавление.**


## [[Программно-конфигурационные сети#Программируемая сетевая телеметрия|Программируемая сетевая телеметрия]]

Одним из наиболее важных преимуществ технологии SDN является то, что она позволяет обеспечить программируемую оценку параметров сети.

Программируемое коммутационное оборудование, представленное в предыдущем разделе, обеспечивает более гибкий сбор телеметрии. Одна из тенденций, к примеру, заключается в предоставлении операторам сетей возможности запрашивать данные о сетевом трафике на высокоуровневом языке с использованием
таких фреймворков, как MapReduce. 

##### [[Программно-конфигурационные сети#Проблемы программируемое коммутационное оборудование|Проблемы программируемое коммутационное оборудование]]

****
# Сетевой уровень интернета

#### [[Сетевой уровень интернета#Сетевой уровень При Принципы, которые легли в основу при разработке и обеспечили дальнейший успех|Принципы, которые легли в основу при разработке и обеспечили дальнейший успех]]
принципы пронумерованы и включены в документ RFC 1958.  Этот документ использует идеи, изложенные в работах Кларка (Clark, 1988) и Зальцера и др. (Saltzer et al., 1984).

1. Убедитесь в работоспособности. 
2. Упрощайте. 
3. Всегда делайте четкий выбор. 
4. Используйте модульный принцип. 
5. Учитывайте разнородность. 
6. Избегайте статичности свойств и параметров.
7. Лучшее — враг хорошего. 
8. Будьте строги при отправке, но снисходительны при получении. 
9. Продумайте масштабируемость. 
10. Помните о производительности и цене. 

 ==IP с самого начала разрабатывался для межсетевого обмена. Его задача предоставить уровень обслуживания best effort (то есть без гарантий) при передаче пакетов от отправителя к получателю, независимо от того, находятся они в одной сети или нет.==

**Обмен данными в интернете происходит следующим образом.** Транспортный уровень разбивает потоки данных так, чтобы их можно было отправить в виде IP-пакетов. В теории каждый пакет может достигать 64 Кбайт, но на практике он обычно не превышает 1500 байт (укладывается в один фрейм Ethernet).
IP-маршрутизаторы передают пакеты по сети, от одного маршрутизатора к другому, пока они не достигнут места назначения. Там сетевой уровень отдает данные транспортному, а тот помещает их во входной поток принимающего процесса. Когда фрагменты приходят на устройство адресата, сетевой уровень собирает их в исходную дейтаграмму, которая затем передается транспортному уровню.

[Ссылка на разбор 2 версий протокола](https://neerc.ifmo.ru/wiki/index.php?title=IP). 

## [[Сетевой уровень интернета#Протокол IP версии 4|Протокол IP версии 4]]

- [[Сетевой уровень интернета#Формат заголовка.|Формат заголовка]]

## [[Сетевой уровень интернета#IP-адреса|IP-адреса]]

Определяющим признаком IPv4 является его 32-битный адрес. У каждого хоста и маршрутизатора в интернете есть IP-адрес, который может использоваться в полях Source address (адрес отправителя) и Destination address(адрес получателя) IP-пакетов.
**Важно отметить, что IP-адрес на самом деле не имеет отношения к хосту**. Он относится к сетевому интерфейсу, поэтому хост, соединенный с двумя сетями, должен иметь два IP-адреса. Однако на практике большинство хостов подключены к одной сети, следовательно, имеют один адрес. Маршрутизаторы, наоборот, обычно имеют
несколько интерфейсов, а значит, и несколько IP-адресов.

#### [[Сетевой уровень интернета#Префиксы|Префиксы (/20)]]
**IP-протокол использует префиксы для разделения сети на подсети, что необходимо из-за ограничений адресного пространства.** Префиксы помогают организовать адресацию, обеспечивая более эффективное использование IP-адресов и упрощая маршрутизацию. (/20)
- [[Сетевой уровень интернета#Префиксы работают следующим образом|Префиксы работают следующим образом]]:
- [[Сетевой уровень интернета#Преимущества префиксов|Преимущества префиксов]]
- [[Сетевой уровень интернета#Недостатки префиксов|Недостатки префиксов]]

#### [[Сетевой уровень интернета#Подсети|Подсети]]
**Маршрутизация по префиксу требует, чтобы у всех хостов сети был один и тот же сетевой номер.** Это свойство IP-адресации может вызвать проблемы при увеличении сети. **Проблема решается предоставлением сети возможности разделения на несколько частей** с точки зрения внутренней организации. **Это называется разбиением на подсети (subnetting).**

#### [[Сетевой уровень интернета#Классовая и специальная адресация (до появления CIDR)|Классовая и специальная адресация (до появления CIDR)]]
Метод, который применялся ранее. До 1993 года IP-адреса разделялись на 5 категорий. Каждый класс имел свой промежуток айпи адресов и маску подсетей

#### [[Сетевой уровень интернета#CIDR — бесклассовая междоменная маршрутизация|CIDR — бесклассовая междоменная маршрутизация]]
CIDR (Classless Inter-Domain Routing) — это метод маршрутизации, который был введен в 1993 году для улучшения управления адресами в Интернете и оптимизации маршрутизации. Он заменил традиционную классовую систему адресации, которая делила IP-адреса на классы (A, B, C и т.д.) с фиксированной длиной префикса.
##### [[Сетевой уровень интернета#Основные аспекты CIDR|Основные аспекты CIDR]]
1. Префиксная запись: 
2. Агрегация маршрутов:
3. Гибкость адресации:
4. Устранение недостатка классовой системы:

##### [[Сетевой уровень интернета#Проблемы, которые решает CIDR|Проблемы, которые решает CIDR]]
1. Экономия адресного пространства:
2. Снижение размера таблиц маршрутизации:
3. Гибкость в управлении сетью:
4. Поддержка роста Интернета:

##### [[Сетевой уровень интернета#Пример структуры CIDR|Пример структуры CIDR]]

#### [[Сетевой уровень интернета#NAT — трансляция сетевого адреса|NAT — трансляция сетевого адреса]]
NAT (Network Address Translation) — это технология, используемая в сетях для преобразования адресов IP и портов, которая позволяет нескольким устройствам в локальной сети (LAN) использовать один или несколько общих публичных IP-адресов для доступа к Интернету. NAT часто реализуется на маршрутизаторах.
![[Pasted image 20241226150103.png]]

##### [[Сетевой уровень интернета#Как работает NAT|Как работает NAT]]
1. Преобразование адресов:
2. Отслеживание соединений:
3. Обратное преобразование:
##### [[Сетевой уровень интернета#Недостатки NAT|Недостатки NAT]]
1. Проблемы с некоторыми протоколами:
2. Усложнение настройки:
3. Проблемы с производительностью:
4. Безопасность:
5. Ограничения на количество подключений:


## [[Сетевой уровень интернета#Протокол IP версии 6|Протокол IP версии 6]]

#### [[Сетевой уровень интернета#Преимущество версии 6 над 4|Преимущество версии 6 над 4]]
- IPv6 сочетается со всеми остальными протоколами интернета, включая TCP, UDP, ICMP, IGMP, OSPF, BGP и DNS

- поля адресов у протокола IPv6 больше, чем у IPv4. Их длина составляет 128 бит, 

- IPv6 по сравнению с IPv4 состоит в упрощенном заголовке пакета. Он состоит всего из 7 полей (вместо 13 у IPv4)

- В протоколе было уделено больше внимания QoS.
#### [[Сетевой уровень интернета#Основной заголовок IPv6|Основной заголовок IPv6]]

#### [[Сетевой уровень интернета#Заголовки расширений|Заголовки расширений]]
Иногда удаленные поля заголовка могут понадобиться, поэтому в протоколе IPv6 была представлена новая концепция необязательного расширения заголовка (extension header). Можно добавить дополнительную информацию, при этом она эффективно закодирована. Определены шесть типов таких заголовков 
#### [[Сетевой уровень интернета#Полемика споры при разработке|Полемика споры при разработке]]
Все жуткие подробности можно найти в соответствующих RFC.


## [[Сетевой уровень интернета#Управляющие протоколы интернета|Управляющие протоколы интернета]]

Помимо IP, используемого для передачи данных, в интернете есть несколько дополнительных управляющих протоколов сетевого уровня, к которым относятся
ICMP, ARP и DHCP.


#### [[Сетевой уровень интернета#ICMP — протокол управляющих сообщений интернета|ICMP — протокол управляющих сообщений интернета]]
Если во время обработки пакета происходит что-то непредвиденное, маршрутизатор сообщает об этом отправителю с помощью протокола управляющих сообщений интернета (Internet Control Message Protocol, ICMP). 

 [полный список сообщений](https://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml).

#### [[Сетевой уровень интернета#ARP — протокол разрешения адресов|ARP — протокол разрешения адресов]]
Сетевой протокол, используемый для преобразования IP-адресов в физические адреса (MAC-адреса) в локальных сетях.

#### [[Сетевой уровень интернета#DHCP — протокол динамической настройки хостов|DHCP — протокол динамической настройки хостов]]
Сетевой протокол, который позволяет автоматически назначать IP-адреса и другие параметры конфигурации сетевых устройств (хостов) в локальной сети

## [[Сетевой уровень интернета#Коммутация меток и MPLS|Коммутация меток и MPLS]]

Технология, используемая для повышения скорости и управляемости передачи данных в сетях. Она позволяет передавать данные по сети с использованием меток, которые упрощают маршрутизацию и управление трафиком.

#### [[Сетевой уровень интернета#Как работает MPLS|Как работает MPLS]]
1. Создание меток: 
2. Перенаправление по меткам: 
3. Упрощение маршрутизации
4. Удаление меток:

#### Уровень 2.5 в модели OSI
MPLS часто называют протоколом уровня 2.5, так как использует адресацию сетевого уровня (например, IP-адреса) для назначения меток, что делает его зависимым от сетевого уровня. Однако он также выполняет функции, характерные для канального уровня, такие как управление трафиком и маршрутизация на основе меток.

#### [[Сетевой уровень интернета#Проблемы MPLS|Проблемы MPLS]]
1. Добавление заголовка MPLS: 
2. Совместимость с существующими протоколами:
3. Сложность конфигурации и управления: 
4. Безопасность: 


## [[Сетевой уровень интернета#Протокол внутреннего шлюза OSPF|Протокол внутреннего шлюза OSPF]]

Это протокол внутридоменной маршрутизации, который используется для обмена маршрутной информацией между маршрутизаторами в одной автономной системе (АС)ых сетях.

#### [[Сетевой уровень интернета#Причины появления OSPF|Причины появления OSPF]]
1. Недостатки RIP:
2. Необходимость в более эффективных алгоритмах
3. Динамическая адаптация к изменениям
4. Открытость и стандартизация:

#### [[Сетевой уровень интернета#Проблемы, которые решает OSPF|Проблемы, которые решает OSPF]]
1. Скорость сходимости
2. Поддержка больших сетей
3. Учет различных параметров
4. Поддержка мультиплексирования

#### [[Сетевой уровень интернета#Как работает OSPF|Как работает OSPF]]
1. Обнаружение соседей
2. Формирование базы данных состояния канала (LSDB)
3. Алгоритм Дейкстры
4. Обновление информации о маршрутах
5. Разделение на области
#### [[Сетевой уровень интернета#Типы сообщений|Типы сообщений]]
1. Hello  
2. Link State Update (LSU)  
3. Link State Acknowledgment (LSAck)  
4. Database Description (DBD)     
5. Link State Request (LSR)  
  
## [[Сетевой уровень интернета#Протокол внешнего шлюза BGP|Протокол внешнего шлюза BGP]]

Border Gateway Protocol (BGP) — это **протокол динамической маршрутизации, используемый для обмена маршрутной информацией между автономными системами (AS) в Интернете**. BGP является основным протоколом, который обеспечивает маршрутизацию между различными сетями, и его работа критически важна для функционирования глобальной сети.

#### [[Сетевой уровень интернета#Основные задачи BGP|Основные задачи BGP]]
1. Обмен маршрутной информацией:
2. Поддержка политик маршрутизации
3. Обеспечение надежности:

#### [[Сетевой уровень интернета#Стратегии маршрутизации и выбор пути|Стратегии маршрутизации и выбор пути]]
Выбор маршрута в BGP осуществляется на основе нескольких критериев, которые могут включать:
1. Локальный приоритет
2. Длина пути AS
3. Тип подключения
4. Атрибут MED
5. Стоимость пути IGP
#### [[Сетевой уровень интернета#Политика маршрутизации|Политика маршрутизации]]
Политика маршрутизации в BGP может быть очень индивидуальной и часто не разглашается. Она может включать ограничения, такие как:

#### [[Сетевой уровень интернета#Причины использования BGP|Причины использования BGP]]
1. Глобальная маршрутизация
2. Гибкость и масштабируемость
3. Устойчивость к сбоям
4. Контроль трафика


# РЕЗЮМЕ

Сетевой уровень предоставляет службы транспортному. Он может быть основан
либо на виртуальных каналах, либо на дейтаграммах. В обоих случаях его **главная задача состоит в выборе маршрута для пакетов от источника до получателя**.

В компьютерных сетях применяется большое количество алгоритмов маршрутизации. Лавинная адресация — это простой метод передачи пакетов по всем путям. Большинство алгоритмов определяют кратчайший путь и адаптируются
к изменениям топологии сети. **Основные алгоритмы — маршрутизация по векторам расстояний и маршрутизация с учетом состояния линий.** 
В большинстве существующих сетей применяется один из них.

Сети подвержены перегрузкам, приводящим к увеличению задержки и утере пакетов. Для предотвращения перегрузки разработчики проектируют сети с достаточным запасом пропускной способности, а также используют настройку протоколов на преимущественный выбор незагруженных маршрутов, временное прекращение приема трафика, уведомление источника о необходимости снизить скорость и сброс нагрузки.

Решив проблему перегрузки, можно попытаться достичь гарантированного QoS.
Комплексные методы предоставления разных уровней QoS включают формирование трафика, резервирование ресурсов на маршрутизаторах, контроль доступа. 

Сети могут весьма значительно различаться, поэтому при их объединении возникают определенные сложности. Если у них разные ограничения на максимальный размер пакета, можно применить фрагментацию. Различные сети могут использовать разные внутренние протоколы маршрутизации, но внешний протокол должен быть общим. Иногда проблемы можно решить с помощью туннелирования пакетов сквозь сильно отличающуюся сеть, но если отправитель и получатель находятся в сетях разных типов, этот подход применить не получится.

В интернете существует большое разнообразие протоколов, относящихся к сетевому уровню. В их числе протокол дейтаграмм (IP) и соответствующие управляющие протоколы (ICMP, ARP и DHCP). В некоторых сетях IP-пакеты передает требующий соединения протокол MPLS. Один из основных протоколов маршрутизации внутри сети — OSPF. Для межсетевой маршрутизации используется BGP. Свободные IP-адреса быстро заканчиваются, поэтому была разработана новая версия IP — IPv6, но внедрение происходит чрезвычайно медленно.

Некоторые вопросы организации и управления трафиком относятся к сетевой политике. Наиболее часто обсуждается проблема пиринговых споров, когда сети не могут договориться о коммерческих условиях подключения, а также о приоритизации трафика. Обычно она служит для устранения негативных последствий перегрузок, но может повлиять на сетевой нейтралитет, если при ее применении нарушается принцип свободной конкуренции.

