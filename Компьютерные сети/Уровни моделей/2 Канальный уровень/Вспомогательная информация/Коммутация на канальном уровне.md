
У многих организаций есть несколько LAN, которые желательно объединить. Может быть, удобно соединить их в одну большую LAN? Это можно сделать с помощью специальных устройств, называемых мостами (bridges). **Коммутаторы Ethernet — это современное название мостов.**
Они обеспечивают функциональность, которая выходит за рамки классического Ethernet и концентраторов Ethernet, — дают возможность соединить несколько LAN в большую и быструю сеть. **Термины «мост» и «коммутатор» синонимы**.

**Мосты работают на канальном уровне. Они анализируют адреса, содержащиеся во фреймах этого уровня, и в соответствии с ними осуществляют маршрутизацию. Поскольку мосты не проверяют у фрейма поле Payload**, они одинаково хорошо справляются как с пакетами IP, так и с другими типами пакетов 
**В отличие от мостов, маршрутизаторы анализируют адреса в пакетах и действуют, основываясь на этой информации**, поэтому они могут работать только с теми протоколами, для которых предназначены.


#### ПРИМЕНЕНИЕ МОСТОВ

Существует три причины появления нескольких LAN в организации. 
	1. Многие подразделения университетов и корпораций создают свои собственные LAN для соединения устройств, исходя из своих целей. Это приводит к автономности сетей, но в дальнейшем возникает необходимость в коммуникации, и используются мосты для их соединения.
	2. Если организация расположена в нескольких удаленных зданиях, эффективнее создать отдельные LAN и соединить их с помощью мостов и оптоволоконных кабелей, чем прокладывать длинные кабели к одному центральному коммутатору. Длина кабелей ограничена, и если превышать допустимые расстояния, сеть не будет функционировать.
	3. Иногда необходимо логически разделить одну LAN на несколько сетей для снижения нагрузки. В крупных университетах или компаниях с тысячами рабочих станций объединить все устройства в одну сеть невозможно из-за ограничения портов и масштабов сети.

Ёмкость двух отдельных LAN в два раза больше, чем одной сети. **Мосты позволяют объединять сети, сохраняя их пропускную способность. Идея в том, чтобы не передавать трафик на порты, на которых он не требуется, тогда каждая LAN сможет работать на максимальной скорости.**

Создание мостов, которые полностью прозрачны для существующих LAN, стало необходимым для упрощения подключения и обеспечения совместимости сетей без изменений в оборудовании или ПО. Для достижения этой цели используются два алгоритма:
1. Алгоритм обратного обучения — предотвращает отправку трафика в ненужные места.
2. Алгоритм связующего дерева — устраняет циклы, которые могут возникнуть при случайном соединении коммутаторов.


#### ОБУЧАЮЩИЕСЯ МОСТЫ
![[Pasted image 20241212170158.png]]
**Слева** к двум многоточечным LAN (таким, как классический Ethernet) присоединяется специальная станция — мост, он является элементом обеих сетей.
**Справа** — несколько LAN с соединениями «точка-точка» и один подключенный концентратор. Мосты — устройства, к которым присоединены станции и концентратор. Если LAN является сетью Ethernet, мосты называются Ethernet-
коммутаторами.

Мосты работают одинаково в обоих случаях. Все станции, присоединенные к одному порту моста, принадлежат к одной области коллизий, которая отличается от областей коллизий других портов. Если система содержит более одной станции (как в классическом Ethernet) и концентратор или полудуплексный канал, для отправки фреймов используется протокол
CSMA/CD.

Однако LAN с мостовыми соединениями строятся по-разному. Чтобы объединить многоточечные LAN, мост добавляется в качестве новой станции для
каждой из них, как показано на (а). 
В случае двухточечных LAN мост соединяется с концентраторами либо (что более предпочтительно) заменяет их, чтобы увеличить производительность. На илл. (б) мосты заменили все концентраторы, кроме одного.

При первом подключении моста его хеш-таблицы пусты, и он не знает, где находятся адресаты. Поэтому используется **алгоритм лавинной адресации (flooding): любой фрейм с неизвестным адресом пересылается на все порты, кроме того, откуда он пришел.** 
Когда мост получает фрейм, он решает, передавать его или игнорировать, основываясь на адресе получателя. Если адрес известен, фрейм направляется только на нужный порт. **Мосты используют алгоритм обратного обучения (backward learning), чтобы запоминать, какие станции находятся на каких портах.** Например, если мост получает фрейм от станции C на порт 3, он запоминает, что C привязана к этому порту.
Время последнего получения фрейма от станции фиксируется в таблице. Старые записи удаляются через несколько минут, что позволяет адаптироваться к изменениям в сети. **Если станция не отправляет данные длительное время, трафик снова будет рассылаться методом лавинной адресации, пока она не активируется.**
`Алгоритм выглядит следующим образом:`
	`1. Если порт-источник и порт для адреса назначения совпадают, фрейм игнорируется.`
	`2. Если порт-источник и порт для адреса назначения различаются, фрейм переправляется на порт назначения.`
	`4. Если порт назначения неизвестен, используется алгоритм лавинной адресации и фрейм пересылается на все порты, кроме источника.`
	
Поскольку этот алгоритм должен применяться к каждому входящему фрейму, обычно он осуществляется с помощью специальных чипов СБИС. Чип производит поиск и обновляет записи таблицы за несколько микросекунд. Мосты проверяют только MAC-адреса, чтобы решить, как отправить фреймы. Поэтому можно начать отправку, как только появилось поле заголовка назначения — еще до того, как дошла остальная часть фрейма (конечно, если выходная линия доступна). Это сокращает время прохождения через мост, а также количество фреймов, которые мост должен буферизовать. **Такой способ называют коммутацией без буферизации пакетов (cut-through switching) или маршрутизацией способом коммутации каналов (wormhole routing), и обычно он реализуется аппаратными средствами.**
	
![[Pasted image 20241212172336.png]]Пакет приходит с более высокого уровня и спускается на уровень MAC Ethernet. Он получает заголовок Ethernet (а также трейлер, не показанный на рисунке). 
	Далее фрейм передается на физический уровень, проходит по кабелю и принимается мостом. 
	В мосте фрейм передается с физического уровня на уровень MAC Ethernet. 
		Здесь фрейм обрабатывается дольше, чем на аналогичном уровне станции. 
	После передается на ретранслятор, все еще в пределах уровня MAC. 
		Функция ретрансляции в мосте использует только заголовок MAC Ethernet, чтобы определить, как обработать фрейм. В нашем случае фрейм передается порту уровня MAC Ethernet, который связан со станцией D, и продолжает свой путь. **В общем случае ретрансляторы на конкретном уровне могут переписать для него заголовки.**
		
	Мост ни в коем случае не должен проверять содержимое фрейма и выяснять, 
	что в нем находится IP-пакет. Для работы моста это значения не имеет, к 
	тому же это нарушает иерархическое представление протокола.


#### МОСТЫ СВЯЗУЮЩЕГО ДЕРЕВА

Для повышения надежности между мостами устанавливаются резервные соединения. **Конструкция гарантирует, что при разрыве одного соединения сеть не будет разделена на два набора компьютеров, которые не могут взаимодействовать друг с другом.**
![[Pasted image 20241212172927.png]]
Но при использовании моста с резервным копированием могут возникать проблемы из-за циклов в топологии сети.  
`Станция А отправляет фрейм (обозначим его F0) в неизвестный пункт назначения. Мост В1, получив этот фрейм, использует метод лавинной адресации и передает его через все порты, включая соединение с мостом В2. В результате В2 получает две копии фрейма (F1 и F2) и, не зная, что это дубликаты, отправляет их дальше. Это приводит к созданию новых фреймов (F3 и F4), которые снова возвращаются в В1. Таким образом, мост В1 начинает обрабатывать новые фреймы с неизвестным адресом, и цикл продолжается бесконечно.`
Эта проблема решается установлением связи между мостами и наложением на реальную топологию сети связующего дерева (spanning tree), которое охватывает оба моста. В результате некоторые потенциальные соединения между мостами игнорируются. Это позволяет создать фиктивную незацикленную топологию, которая является подмножеством реальной системы.
![[Pasted image 20241213092111.png]]
Чтобы сформировать дерево связи, мосты используют распределенный алгоритм. Каждый мост периодически рассылает конфигурационные сообщения соседям, которые помогают определить корневой мост и кратчайшие пути.
	`1. Выбор корневого моста: Каждый мост включает в сообщение свой MAC-адрес и идентификатор потенциального корня. Мост с наименьшим идентификатором становится корнем.`
	`2. Создание кратчайших путей: Мосты определяют кратчайшие пути от корня до себя, основываясь на полученных сообщениях и расстоянии до корня. Они выбирают путь через мост с наименьшим идентификатором.`
	`3. Отключение лишних портов: Мосты отключают порты, которые не входят в кратчайший путь, чтобы избежать циклов.`
Алгоритм постоянно обновляет дерево при изменениях в топологии сети, обеспечивая эффективное управление связями между мостами.
**Алгоритм связующего дерева описан в стандарте IEEE 802.1D**


#### Повторители, концентраторы, мосты, коммутаторы, маршрутизаторы и шлюзы сравнения
 Как работают упомянутые устройства, надо понять, что они задействованы на разных уровнях, как показано на илл. (а). **Уровень имеет значение, поскольку от него зависит, какую часть информации устройство использует для маршрутизации**. Рассмотрим типичный сценарий. 
 У пользователя появляются данные (User data), которые необходимо отправить на другой компьютер. 
	 Они передаются на **транспортный уровень, который добавляет к ним свой заголовок (например, TCP header)** и передает полученную единицу информации на сетевой уровень. 
	 **Сетевой уровень, в свою очередь, тоже добавляет свой заголовок (Packet header), в результате чего формируется пакет сетевого уровня (например, IP-пакет).** На илл. (б) IP-пакет выделен серым цветом. 
	 Пакет отправляется на **канальный уровень, где дополняется еще одним заголовком (Frame header )  и контрольной суммой ( CRC)**. Наконец, формируется фрейм, который спускается на физический уровень для передачи, например, по LAN.
	![[Pasted image 20241213094346.png]]
	**Повторитель**
		**Сигнал, появившийся в одном кабеле, очищается, усиливается повторителем и выдается на второй. Повторители не знают, что такое пакет, фрейм или заголовок. Они знают символы, кодирующие биты в напряжение.** В классическом Ethernet, например, допускается установка четырех повторителей для усиления сигнала, чтобы увеличить максимальную длину кабеля с 500 до 2500 м.
	**Концентратор 
		Имеет несколько входных линий, объединяемых с помощью электричества. Фреймы, приходящие на какой-либо вход, передаются на все остальные линии. Если одновременно по разным линиям придут два фрейма, они столкнутся, как в коаксиальном кабеле. Все линии, идущие в концентратор, должны работать с одинаковой скоростью.** Концентраторы отличаются от повторителей тем, что, как правило, не усиливают входной сигнал и предназначены для нескольких входных линий. Впрочем, разница между ними незначительна. И те и другие являются устройствами физического уровня; они не анализируют адреса канального уровня и никак не используют их.
	**Мосты и коммутаторы**
		Располагаются  на канальном уровне.  
		Мосты соединяют две или несколько LAN. Как и в концентраторах, в современных мостах имеются несколько портов, рассчитанных обычно на 4–48 входящих линий определенного типа. В отличие от концентратора, **каждый порт изолирован**, чтобы быть своей собственной областью коллизий; **если у порта есть полнодуплексная двухточечная линия, в алгоритме CSMA/CD нет необходимости.** Когда приходит фрейм, **мост извлекает из заголовка адрес назначения и анализирует его, сопоставляя с таблицей и определяя, куда нужно его передать.** Мост только выводит фрейм на нужный порт; он может передавать несколько фреймов одновременно. Мосты предлагают гораздо более высокую производительность, чем концентраторы, а благодаря изолированным портам входные линии могут работать на разных скоростях и даже с различными типами сетей.
		Если фреймы приходят быстрее, чем передаются дальше, мост может исчерпать буферное пространство и начать отказываться от фреймов.
		**Коммутаторы — это другое название современных мостов.** Различия больше связаны с маркетингом, чем с техническими особенностями, но есть несколько важных моментов. Мосты были разработаны, когда использовался классический Ethernet, поэтому они могут соединять относительно небольшое число LAN, а значит, имеют не так много портов. Сегодня чаще употребляется термин «коммутатор». Кроме того, все современные системы используют двухточечные линии, например витую пару. Отдельные компьютеры подключаются непосредственно к коммутатору, поэтому у него, как правило, много портов. Наконец, понятие «коммутатор» также используется в качестве общего термина. Функционал моста понятен. А вот слово «коммутатор» может относиться и к коммутатору Ethernet, и к совершенно другому устройству, принимающему решения о переадресации, например телефонному коммутатору.
	**Маршрутизатор** 
		Когда пакет приходит в маршрутизатор, заголовок и трейлер фрейма удаляются, а сам пакет, расположенный в поле данных, передается программному обеспечению маршрутизатора. Далее анализируется заголовок пакета и в соответствии с ним выбирается его дальнейший путь. Если это IP-пакет, то в его заголовке содержится 32-битный (IPv4) или 128-битный (IPv6), но не 48-битный IEEE 802 адрес. ПО маршрутизатора не видит адреса фреймов и даже не знает, как они пришли, по LAN или по двухточечной линии.
	**Транспортные шлюзы.**
		Они служат для соединения компьютеров, которые применяют различные транспортные протоколы, ориентированные на установление соединения. Например, одно устройство использует TCP/IP, а другое — SCTP. Транспортный шлюз может копировать пакеты между соединениями, одновременно переводя их в нужный формат. Наконец, шлюзы приложений различают форматы и содержимое данных и могут менять формат сообщений. Например, шлюз e-mail может переводить электронные письма в формат SMS-сообщений для мобильных телефонов. Как и «коммутатор», «шлюз» — своего рода общий термин. Он относится к процессу передачи, который выполняется на верхнем уровне.


#### Виртуальные локальные сети
Немного истории
	На заре развития технологий локальных сетей толстые желтые кабели прокладывались во множестве офисов. Можно было подключить к сети каждый компьютер, рядом с которым проходил такой провод. Никто не задумывался над тем, к какой именно LAN подключался конкретный компьютер. Сотрудники соседних офисов пользовались одной сетью, даже если они работали в разных отделах. «География» брала верх над корпоративной структурой. В 1990-х с появлением витой пары и концентраторов все изменилось, и офисные здания были переоборудованы (что обошлось недешево). На смену желтым проводам, напоминающим садовые шланги, пришла витая пара, идущая от каждого кабинета к монтажному шкафу в конце коридора или к центральному машинному залу (илл. 4.38). Если сотрудник, ответственный за переоборудование, был дальновидным человеком, то прокладывалась витая пара категории 5. Если же он был крохобором, то использовались уже существующие телефонные кабели категории 3. Через пару лет, с приходом сетей Fast Ethernet, их все равно заменили.
Причины
	**Первая причина является безопасность.** 
		Одна LAN может объединять веб-серверы и другие компьютеры для публичного доступа. Другая может содержать записи отдела кадров, которые не должны выходить за пределы компании.
	**Второй причиной является нагрузка на сеть.** 
		Некоторые сети могут быть более загруженными, чем другие, в этом случае лучше их разделить.
	**Третья причина гибкость.** 
		Во многих компаниях организационные перестановки происходят постоянно, и сетевой администратор вынужден постоянно производить манипуляции с коннекторами и разъемами. Иногда это невозможно, поскольку витая пара от пользовательского компьютера не дотягивается до нужного коммутатора (который находится в другом здании) или же доступные порты коммутатора относятся к другой LAN. Пользователи нуждались в большей гибкости. В ответ на этот запрос были разработаны виртуальные LAN (Virtual LAN, VLAN).

Разработана виртуальная сеть LAN (Virtual LAN, VLAN). Для её внедрения необходимо было изменить только программное обеспечение. Виртуальные сети были стандартизованы комитетом IEEE 802 

Архитектура фрейма
![[Pasted image 20241213104112.png]]