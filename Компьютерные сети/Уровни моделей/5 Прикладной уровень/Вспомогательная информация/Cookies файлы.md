
Куки-файлы (или просто куки) — это небольшие текстовые файлы, которые веб-сервер отправляет на устройство пользователя и которые браузер сохраняет. Куки используются для хранения информации о пользователе, его предпочтениях и сессиях. Они позволяют веб-приложениям запоминать информацию между запросами.

## Как выглядят куки и как они работают?

Куки выглядят, как пара `ключ=значение`. Для их установки сервер должен в ответе на запрос клиента прислать заголовок `Set-Cookie` со значением.

```
Set-Cookie: token=123abc
```

Как только браузер получит его в ответ на запрос, он сохранит значение куки в Cookie Storage. В каждый последующий запрос браузер будет добавлять сохранённые значения в заголовке `Cookie`.

Обычно кукам устанавливается фиксированное время жизни. Это можно сделать двумя способами: 

- установить дату истечения срока годности — `Expires`, 
	`Set-Cookie: token=123abc; Expires=Tue, 01 Jan 2030 00:00:00 -0000`

- установить количество секунд, по истечении которых кука перестанет быть актуальной — `MAX_AGE`.
	`Set-Cookie: token=123abc; MAX_AGE=120`

Разные браузеры могут использовать разные параметры для установки времени жизни куки. Поэтому зачастую сервер присылает оба варианта, а браузер сам выбирает поддерживаемый параметр.
```
Set-Cookie: token=123abc; Expires=Thu, 05 Aug 2021 18:45:00 -0000; MAX_AGE=120
```

Стандарт **RFC6265**, описывает куки. Он закрепляет правило, что имена параметров — регистронезависимые.

## Основные поля куки

1. **Name**: Имя куки. Это уникальный идентификатор для конкретного куки.

2. **Value**: Значение, связанное с именем. Это может быть любая строка.

3. **Domain**: Указывает домен, к которому куки относятся. Браузер будет отправлять куки только к этому домену.

4. **Path**: Указывает путь на сервере, для которого куки будут действительны. Например, /account означает, что куки будут отправляться только для URL-адресов, начинающихся с /account.

5. **Expires**: Дата и время истечения срока действия куки. Если не указано, куки будут действовать только в течение текущей сессии.

6. **Size**: Размер куки в байтах. Обычно ограничен 4096 байт для одного куки.

7. **HttpOnly**: Флаг, который указывает, что куки не могут быть доступны через JavaScript (например, через document.cookie). Это помогает защитить куки от XSS-атак.

8. **Secure**: Флаг, который указывает, что куки должны передаваться только по защищенному соединению (HTTPS).

9. **SameSite**: Политика, которая ограничивает отправку куки при [[Всемирная паутина#**CORS**|кросс-доменных запросах]]. Может принимать значения:

   - **Strict**: Куки не отправляются при кросс-доменных запросах.

   - **Lax**: Куки отправляются при навигации (например, при переходе по ссылке), но не при [[JavaScript#AJAX-запросы|AJAX-запросах]].

   - **None**: Куки отправляются всегда, но должны быть помечены как Secure.

10. **Partitioned**: Связано с разделением данных между разными контекстами (например, между вкладками), чтобы улучшить конфиденциальность.

11. **Cross Site Priority**: Приоритет куки при кросс-доменных запросах. Это может помочь управлять тем, как браузер обрабатывает куки в контексте разных сайтов.

## ### Защита Cookies

Куки представляют два параметра, которые защищают их от различных атак.

Параметр `secure` говорит о том, что такие куки будут отсылаться только по HTTPS-соединению. Если сайт работает по HTTP, то значение не будет передано. `Secure` не обеспечивает дополнительного шифрования, поэтому не стоит хранить чувствительные данные в куках.

Параметр `httpOnly` создаёт куки, к которым нельзя обратиться из кода JavaScript в браузере. Так можно избежать XSS-атак.

#### Важные имена куки:

- **PHPSESSID**: Используется PHP для идентификации сессии пользователя.

- **SESSIONID**: Хранит идентификатор текущей сессии пользователя.

- **csrf_token**: Используется для защиты от CSRF-атак, хранит токен аутентификации.

- **user_id**: Содержит идентификатор пользователя для отслеживания его активности на сайте.
