**DNS (Domain Name System):** Это система, которая переводит доменные имена в IP-адреса, которые используются для идентификации устройств в сети. Когда вы вводите адрес сайта в браузере, DNS запрашивает соответствующий IP-адрес и направляет ваш запрос к нужному серверу.

#### структура:

- example.com (основной домен)
- www.example.com (поддомен для веб-сайта)
- blog.example.com (поддомен для блога)
- shop.example.com (поддомен для интернет-магазина)

## История и общие сведения

Во времена сети ARPANET имена всех компьютеров сети и их IP-адреса сохранялись в файле hosts.txt. Каждую ночь все хосты получали этот файл с сайта, на котором он хранился. В сети, состоящей из нескольких сотен больших компьютеров, работающих в системе с разделением времени, такой подход оправдывал себя.

**В 1983 году и была разработана DNS.** DNS представляет собой сочетание иерархической схемы именования с распределенной базой данных.

Система DNS является одним из наиболее активно развивающихся протоколов интернета. Она описана в документах RFC 1034, RFC 1035, RFC 2181 и доработана в ряде других RFC.

## Процесс работы DNS

###### 1. **Клиентский запрос:** 

   - Пользователь вводит URL (например, www.example.com) в браузере.

###### 2. **Проверка кэша:**

- В начале проверяется кеш браузера или устройства на то что ранее данный запрос обрабатывался 

###### 3. **Если в кэше на устройстве не было обнаружено запрос передаётся на DNS Resolver сервер** 

- Сервер проверяет у себя в кэше, есть ли информация по данному доменному имени, и если да, то отдает ответ с IP-адресом.

- Сервер находится или у провайдера, или по адресу (8.8.8.8 — Google, 1.1.1.1 — Cloudflare).

###### 4 . **Если Resolver распознающий DNS сервер не нашёл у себя то он обращается к Root серверу (их много)** 

- Root сервер не ищет у себя IP-адрес, он сориентирует по серверу TLD при помощи домена на конце.
	![[Pasted image 20250106220531.png]]
	
- После этого локальный распознаватель получает информацию о соответствующем авторитетном сервере имен для указанного домена.

###### 5. **Итеративный поиск:**

- Локальный распознаватель начинает процесс разрешения имен, отправляя итеративные запросы к серверам имен, начиная с корневого сервера и продвигаясь вниз по иерархии.

- Каждый сервер имен отвечает частично, предоставляя адреса следующих серверов, отвечающих за более конкретные зоны.

###### 5.1 **Сервер TLD (Top-Level Domain) имеет разновидности generic Top Level Domain, gTLD и country code Top Level Doman, ccTLD.**

- Данный сервер в свою очередь перенаправит уже к серверу авторитативных имен.

- Весь интернет разделен на более чем 250 доменов верхнего уровня TLD (top-level domains). Корпорацией по управлению доменными именами и IP-адресами (ICANN)**. 

- Существует несколько типов доменов верхнего уровня:
	- Родовой домен верхнего уровня, ==рДВУ== (generic Top Level Domain, ==gTLD==),
	- Национальный домен верхнего уровня, ==нДВУ== (country code Top Level Doman, ==ccTLD==)
	- и др.
	![[Pasted image 20250106200546.png]]
	![[Pasted image 20250106200826.png]]
	

###### 5.2  **Сервер авторитативных имен**

- Сервер авторитативных имен предоставляет окончательный ответ (например, IP-адрес) или сообщает, что домен не существует.

- Если ответ получен, результат сохраняет его в своем кэше на время, указанное в TTL.




## Структура серверов DNS

##### 1. Серверы имен (DNS-серверы)

a. Авторитетные DNS-серверы

   • Первичный (мастер) сервер: Хранит оригинальные записи DNS для домена. Владелец домена вносит изменения именно на этом сервере.

   • Вторичный (слейв) сервер: Получает копии записей с первичного сервера. Он обеспечивает резервирование и может отвечать на запросы, но не может вносить изменения в записи.

b. Кэшированные DNS-серверы

   • Рекурсивные DNS-серверы: Эти серверы принимают запросы от клиентов (например, от вашего компьютера) и выполняют поиск по всей иерархии DNS, обращаясь к другим серверам, пока не найдут ответ. Они кэшируют результаты для ускорения последующих запросов.

   • Промежуточные DNS-серверы: Это также рекурсивные серверы, которые могут выполнять кэширование, но могут быть настроены для обеспечения определенных функций безопасности или фильтрации.

##### 2. Корневые DNS-серверы

Корневые серверы — это верхний уровень иерархии DNS. Они не содержат информации о конкретных доменах, но направляют запросы к соответствующим TLD-серверам (например, .com, .org).

##### 3. TLD-серверы

Серверы верхнего уровня (TLD-серверы) управляют доменами верхнего уровня, такими как .com, .net, .org и т.д. Они хранят информацию о авторитетных DNS-серверах для всех доменов, находящихся под их управлением.

##### 4. Регистраторы доменных имен

Регистраторы — это организации, которые управляют регистрацией доменных имен. Они предоставляют интерфейсы для владельцев доменов, чтобы вносить изменения в записи DNS и управлять своими доменами. Регистраторы обновляют информацию о доменах в TLD-серверах.

##### 5. Клиентские устройства

На клиентском уровне находятся устройства (например, компьютеры, смартфоны), которые отправляют запросы на разрешение доменных имен. Эти устройства используют локальные настройки DNS или рекурсивные DNS-серверы для получения информации о доменах.

## DNS-запросы и DNS-ответы

Запросы бывают трёх видов:
- Recursive (рекурсивный) нужен для поиска ip адреса сайта 
- Iterative (итеративный) нужен для ip адреса сайта или авторитетных dns серверов
- Inverse (обратный) нужен для обратного (какое доменное имя по такому ip адресу)

#### Запросы

1. **Recursive (рекурсивный) запрос**

   - Что это значит: Рекурсивный запрос отправляется DNS-клиентом (например, вашим компьютером) на DNS-сервер, который должен предоставить окончательный ответ, даже если ему нужно выполнить дополнительные запросы к другим DNS-серверам.

	Формат записи запроса:
	`QUERY: A www.example.com`

	Пример запроса: 
	`dig @8.8.8.8 www.example.com`


	Ответ: Ответ приходит в виде IP-адреса, соответствующего запрашиваемому доменному имени. Если сервер не может найти информацию, он возвращает ошибку.

	Форма ответа: 
	 `ANSWER SECTION:`
	 `www.example.com.  3600 IN A 93.184.216.34`
     
	Что хранит: IP-адреса, время жизни (TTL), тип записи (например, A, AAAA, CNAME и т.д.).
	
	Для чего это: Используется для получения конечного IP-адреса доменного имени, чтобы клиент мог подключиться к нужному серверу.

2. **Iterative (итеративный) запрос**

   - Что это значит: Итеративный запрос отправляется от клиента к DNS-серверу с просьбой предоставить информацию. Если сервер не имеет запрашиваемой информации, он возвращает адрес другого сервера, который может помочь.

	Формат записи запроса:  
	 QUERY: A www.example.com
     
	Пример запроса: 
    dig www.example.com @ns1.example.com
     

   Ответ: Ответ может быть либо окончательным (с IP-адресом), либо указанием на другой DNS-сервер для дальнейшего запроса.

   Форма ответа: 
	 `ANSWER SECTION:`
	 `www.example.com.  3600 IN A 93.184.216.34`
	
	 `OR`
	  
	 `AUTHORITY SECTION:`
	 `example.com.  86400 IN NS ns2.example.com.`
     
   Что хранит: Информацию о запрашиваемом домене, а также ссылки на другие авторитетные DNS-серверы.

   Для чего это: Используется для нахождения информации о доменах через цепочку DNS-серверов.

3. **Inverse (обратный) запрос**

   - Что это значит: Обратный запрос используется для получения доменного имени по известному IP-адресу. Это делается с помощью специальной записи PTR.

	Формат записи запроса:  
    QUERY: PTR 34.216.184.93.in-addr.arpa
     
	Пример запроса: 
    dig -x 93.184.216.34
     

	Ответ: Ответ приходит в виде доменного имени, соответствующего запрашиваемому IP-адресу.

	Форма ответа:  
	`ANSWER SECTION:`
	`34.216.184.93.in-addr.arpa.  3600 IN PTR www.example.com.`
     
   Что хранит: Доменное имя, соответствующее запрашиваемому IP-адресу.

   Для чего это: Используется для проверки принадлежности IP-адреса к определённому доменному имени, что может быть полезно для безопасности и диагностики.

#### Ответы

Ответы на DNS-запросы могут содержать несколько секций:

1. **ANSWER SECTION** — основная информация о запрашиваемом домене (например, IP-адрес).

2. **AUTHORITY SECTION** — информация о том, какие серверы являются авторитетными для данного домена.

3. **ADDITIONAL SECTION** — дополнительная информация, которая может быть полезна для клиента (например, IP-адреса авторитетных серверов).

Каждый ответ содержит:

• **TTL (Time to Live)** — время, в течение которого ответ может кэшироваться.

• **Тип записи** — указывает, какую информацию содержит запись (A, AAAA, CNAME, PTR и т.д.).
![[Pasted image 20250106231548.png]]


• Данные — фактическая информация (например, IP-адрес или доменное имя).


## Конфиденциальность

#### QNAME-минимизация
QNAME-минимизация — это метод, разработанный для повышения конфиденциальности в системе DNS. Основная цель этого подхода заключается в минимизации объема информации, передаваемой локальным распознавателем (DNS-клиентом). Вместо передачи полного доменного имени (FQDN) при каждом запросе, локальный распознаватель отправляет только ту часть имени, которая необходима для получения ответа. Это снижает объем передаваемой информации и затрудняет отслеживание запросов пользователей.

#### Проблемы безопасности DNS
Традиционно DNS использовал UDP в качестве транспортного протокола для передачи запросов и ответов. Однако с выявлением недостатков безопасности этого протокола, таких как:

- Атаки отравления кэша: злоумышленники могут подменять кэшированные записи DNS, перенаправляя пользователей на вредоносные сайты.

- DDoS-атаки: распределенные атаки отказа в обслуживании могут перегружать DNS-серверы, делая их недоступными.

#### Современные безопасные протоколы
Для повышения безопасности DNS были разработаны современные протоколы, такие как:

- DNS поверх TLS (DoT): обеспечивает шифрование DNS-запросов и ответов, предотвращая перехват и модификацию данных.

- DNS поверх HTTPS (DoH): также шифрует DNS-трафик, но использует стандартный HTTP/2 для передачи данных через защищенные соединения.

#### Доверенные рекурсивные распознаватели (TRR)

Доверенные рекурсивные распознаватели (Trusted Recursive Resolvers, TRR) — это специальные серверы, которые обеспечивают безопасность и конфиденциальность DNS-запросов. Они работают по принципу доверия, обрабатывая запросы пользователей без записи их IP-адресов или других идентифицирующих данных.

#### Забывчивый DNS и забывчивый DoH
Недавно были предложены улучшенные версии DNS и DoH:

- Забывчивый DNS (Oblivious DNS, ODNS): этот подход позволяет оконечному распознавателю шифровать исходный запрос перед его передачей локальному распознавателю. Локальный распознаватель затем передает зашифрованный запрос авторитетному серверу имен. При этом сервер может выполнить дешифрование и разрешить запрос, но не знает идентификатора или IP-адреса оконечного распознавателя.

- Забывчивый DoH (Oblivious DoH, ODoH): аналогичный подход применяется к DoH, обеспечивая дополнительный уровень конфиденциальности за счет скрытия информации о пользователе от локального распознавателя.
![[Pasted image 20250106220754.png]]
