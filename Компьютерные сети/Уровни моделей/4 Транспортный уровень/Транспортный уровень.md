
**Транспортный уровень основан на сетевом и отвечает за передачу данных от процесса на устройстве-источнике до процесса на устройстве-адресате, предоставляя необходимый уровень надежности вне зависимости от физических характеристик используемых сетей.** Он создает абстракции, с помощью которых приложения могут работать в сети. Без транспортного уровня вся концепция многоуровневых протоколов потеряет смысл.

----
# Транспортные службы

## [[Транспортные службы#Службы, предоставляемые верхним уровням|Службы, предоставляемые верхним уровням]]

**Цель транспортного уровня — предоставить эффективную, надежную и экономичную службу передачи данных** своим пользователям (обычно это процессы прикладного уровня). **Для этого транспортный уровень применяет службы, предоставленные сетевым уровнем**.

На транспортном уровне, как и на сетевом, могут быть службы, ориентированные на установление соединения, и службы без установления соединения. 

[[Транспортные службы#Если транспортные и сетевые службы так похожи, то зачем нужны два разных уровня?|Если транспортные и сетевые службы так похожи, то зачем нужны два разных уровня?]]

Нижние уровни можно рассматривать как поставщика транспортных служб (transport service provider), а верхние уровни — как пользователя транспортных служб (transport service user).

## [[Транспортные службы#Примитивы транспортных служб|Примитивы транспортных служб]]

Примитивы транспортных служб — это базовые операции или функции, предоставляемые транспортным уровнем или в рамках сетевых протоколов. Эти примитивы обеспечивают основные возможности для передачи данных между узлами сети и играют ключевую роль в управлении процессами передачи, контролем ошибок и обеспечением надежности.

 - [[Транспортные службы#Пример простых примитив транспортной службы|Пример простых примитив транспортной службы]]

- [[Транспортные службы#Сегмент|Сегмент]]

- [[Транспортные службы#Пример работы примитив|Пример работы примитив]]


На транспортном уровне даже простая однонаправленная пересылка данных сложнее, чем на сетевом. Каждый отправленный пакет будет в конце концов подтвержден.

## [[Транспортные службы#Сокеты Беркли|Сокеты Беркли]]

==Сокеты Беркли (Berkeley Sockets) — это интерфейс программирования, который предоставляет стандартные функции для сетевого взаимодействия==

- [[Транспортные службы#Примитивы сокетов для TCP|Примитивы сокетов для TCP]]

- [[Транспортные службы#Структура сокетов|Структура сокетов]]

- [[Транспортные службы#Пример кода на C работы сокетов|Пример кода на C работы сокетов]]

- [[Транспортные службы#Недочёты сокетов и их альтернативы|Недочёты сокетов и их альтернативы]]

----
# Элементы транспортных протоколов

Транспортные службы реализуются транспортным протоколом и они напоминают протоколы канального уровня. И те и другие протоколы, помимо прочего, **занимаются обработкой ошибок, управлением очередями и потоками.**
Однако у этих протоколов также имеется множество существенных различий, из-за разных условий, в которых они работают.  На канальном уровне два маршрутизатора общаются напрямую по физическому каналу, а транспортном уровне физический канал заменен целой сетью.

- На транспортном уровне требуется явно указывать адрес получателя.
- На транспортном уровне начальная установка соединения происходит достаточно сложно.
- Еще одно весьма досадное различие между канальным и транспортным уровнями состоит в том, что **сеть потенциально обладает возможностями хранения информации. Последствия способности сети задерживать и копировать пакеты порой катастрофичны и требуют применения специальных протоколов**, обеспечивающих правильную передачу данных.


## [[Элементы транспортных протоколов#Адресация|Адресация]]

Когда прикладной процесс устанавливает соединение с другим процессом, он указывает транспортные адреса, куда отправляются запросы на соединения. В интернете конечные точки на транспортном уровне называются ==портами==, обозначаемыми как точки доступа к службам транспортного уровня (==TSAP==). На сетевом уровне аналогичные конечные точки называются точками доступа к сетевым службам (==NSAP==), примерами которых являются IP-адреса. На хосте 2 могут располагаться и другие серверы, соединенные со своими TSAP и ожидающие входящих запросов на соединение, приходящих с той же NSAP.

- [[Элементы транспортных протоколов#Методы по соединению нужных TSAP|Методы по соединению нужных TSAP]]


## [[Элементы транспортных протоколов#Установление соединения|Установление соединения]]

Установление соединения трудный процесс. Имеющий такие проблемы, как задержка, дублирование данных. Решением таких проблем решают CDN (Content Delivery Network), для сокращения расстояния до конечного пользователя. Методы жизни пакетов.

- [[Элементы транспортных протоколов#Проблема задержка и дублирование пакетов|Проблема: задержка и дублирование пакетов]]

-  [[Элементы транспортных протоколов#Решение «тройное рукопожатие»|Решение: «тройное рукопожатие»]]

## [[Элементы транспортных протоколов#Разрыв соединения|Разрыв соединения]]

Разорвать соединение проще, чем установить. Но здесь также имеются некоторые проблемы. Существует два стиля разрыва соединения: асимметричный и симметричный.


## [[Элементы транспортных протоколов#Контроль ошибок и управление потоком данных|Контроль ошибок и управление потоком данных]]
 
**Ключевыми проблемами являются контроль ошибок и управление потоком данных.** Контроль ошибок отвечает за передачу данных с необходимой степенью надежности: как правило, это означает, что данные должны доставляться без ошибок. Управление потоком состоит в согласовании скорости источника и получателя. **Оба этих вопроса и решений их  уже были на канальном уровне. На транспортном уровне используются те же механизмы.**

- [[Элементы транспортных протоколов#Сквозной принцип (end-to-end argument)|Сквозной принцип (end-to-end argument)]]

- [[Элементы транспортных протоколов#Управление буферизацией|Управление буферизацией]]

- [[Элементы транспортных протоколов#Подвод итогов|Подвод итогов]]


## [[Элементы транспортных протоколов#Мультиплексирование|Мультиплексирование]]

==Мультиплексирование (multiplexing), или объединение нескольких сеансов связи в одном соединении, виртуальном канале и одной физической линии.==


## [[Элементы транспортных протоколов#Восстановление после сбоев|Восстановление после сбоев]]

Транспортные подсистемы постоянно ожидают потери сегментов и знают, как с этим бороться: для этого выполняются повторные передачи. Более серьезную проблему представляет восстановление после сбоя хоста.

- [[Элементы транспортных протоколов#Варианты решение после сбоев|Варианты решение после сбоев]]

----
# Контроль перегрузки

Если транспортные подсистемы нескольких компьютеров будут слишком быстро отправлять чересчур много пакетов, сеть будет перегружена и ее производительность резко снизится, что приведет к задержке и потере пакетов. **Контроль перегрузки, направленный на борьбу с такими ситуациями, требует совместной работы сетевого и транспортного уровней.** Так как перегрузки происходят на маршрутизаторах, их обнаружением занимается сетевой уровень. Но **изначальной причиной этой проблемы является трафик, переданный транспортным уровнем в сеть**. Поэтому единственный эффективный способ контроля перегрузки состоит в более медленной передаче пакетов транспортными протоколами.
Контроль перегрузки в интернете во многом опирается на транспортный уровень; для этого в TCP и другие протоколы встроены специальные алгоритмы.

## Выделение требуемой пропускной способности

Перед тем как перейти к методам регулирования трафика, необходимо
понять, чего надо от алгоритма контроля перегрузки.

- Определить, какое состояние сети он должен поддерживать.

- Предотвращение перегрузок.

- Правильно распределять пропускную способность между транспортными подсистемами, работающими в сети.

- Быстро отслеживать изменения в запросах на выделение ресурсов.

#### [[Контроль перегрузки#Эффективность и мощность|Эффективность и мощность]]

#### [[Контроль перегрузки#Равнодоступность по максимальному критерию|Равнодоступность по максимальному критерию]]

#### [[Контроль перегрузки#Конвергенция|Конвергенция]]


## [[Контроль перегрузки#Регулирование скорости отправки|Регулирование скорости отправки]]

## [[Контроль перегрузки#Проблемы беспроводного соединения|Проблемы беспроводного соединения]]


----
# Транспортные протоколы интернета: UDP 

Протокол без установления соединения, UDP, просто передает пакеты между приложениями, позволяя им надстраивать свои собственные протоколы.

## Основы UDP

**Протокол передачи пользовательских дейтаграмм (User Datagram Protocol, UDP)**
Это транспортный протокол без установления соединения, описанный в RFC 768.


- [[Транспортные протоколы интернета UDP#Заголовок протокола udp|Заголовок протокола udp]]

- [[Транспортные протоколы интернета UDP#Чего UDP не делает|Чего UDP не делает]]

- [[Транспортные протоколы интернета UDP#Что делает UDP|Что делает UDP]]

- [[Транспортные протоколы интернета UDP#Для каких целей используется UDP|Для каких целей используется UDP]]


## Вызов удаленной процедуры

**Удалённый вызов процедур (Remote Procedure Call, RPC)** — это метод, который позволяет программам вызывать функции (или процедуры), находящиеся на удалённых компьютерах, так же, как если бы они вызывались локально. Это делает разработку сетевых приложений более интуитивной и удобной.

- [[Транспортные протоколы интернета UDP#Как это работает?|Как это работает?]]

- [[Транспортные протоколы интернета UDP#Проблемы и ограничения RPC|Проблемы и ограничения RPC]]

## Транспортные протоколы реального времени

**Клиент-серверный удаленный вызов процедур — это та область, в которой UDP применяется очень широко.** Еще одной такой сферой являются мультимедийные приложения реального времени. 

С распространением интернет-радио, интернет-телефонии, видеоконференций, музыки и видео по запросу, а также других мультимедийных приложений стало понятно, что все они воссоздают примерно один и тот же транспортный протокол реального времени. Вскоре родилась идея о том, что было бы удобно иметь для них один общий транспортный протокол. Так возник ==транспортный протокол реального времени (Real-Time Transport Protocol, RTP)==. Он описан в RFC 3550 и сегодня широко используется в мультимедиа. 

RTP обычно работает поверх UDP (в операционной системе).

- [[Транспортные протоколы интернета UDP#Два компонента транспортировки данных в реальном времени|Два компонента транспортировки данных в реальном времени]]

- [[Транспортные протоколы интернета UDP#Работа RTP поверх UDP|Работа RTP поверх UDP]]

-  [[Транспортные протоколы интернета UDP#Дилемма к какому уровню отнести RTP|Дилемма к какому уровню отнести RTP]]

- [[Транспортные протоколы интернета UDP#RTP — транспортный протокол реального масштаба времени|RTP — транспортный протокол реального масштаба времени]]

- [[Транспортные протоколы интернета UDP#Заголовок RTP|Заголовок RTP]]

- [[Транспортные протоколы интернета UDP#RTCP — управляющий транспортный протокол реального времени|RTCP — управляющий транспортный протокол реального времени]]

- [[Транспортные протоколы интернета UDP#Буферизация и контроль джиттера при воспроизведении|Буферизация и контроль джиттера при воспроизведении]]


----

# Транспортные протоколы интернета: TCP

TCP — протокол, ориентированный на установление соединения. В его задачи входит практически все. Он устанавливает соединения и обеспечивает надежность сети, выполняя повторную передачу данных, а также осуществляет управление потоком данных и контроль перегрузки — и все это в интересах приложений, которые его используют. Большинству интернет-приложений требуется надежная, последовательная передача, и TCP это рабочая лошадка интернета)

## [[Транспортные протоколы интернета TCP#Основы TCP|Основы TCP]]

## [[Транспортные протоколы интернета TCP#Модель службы TCP|Модель службы TCP]]
- В основе службы TCP лежат [[Транспортный уровень#Транспортные службы Сокеты Беркли Сокеты Беркли|сокеты (sockets)]], создаваемые как отправителем, так и получателем. 
- Все TCP-соединения являются полнодуплексными и двухточечными. «Полнодуплексное» означает, что трафик может следовать одновременно в обе стороны, а «двухточечное» — что у него есть две конечные точки. Широковещание и многоадресная рассылка протоколом TCP не поддерживаются.
- TCP-соединение представляет собой байтовый поток, а не поток сообщений. Границы между сообщениями не сохраняются
- Получив данные от приложения, протокол TCP может отправить их сразу или поместить в буфер

## [[Транспортные протоколы интернета TCP#Протокол TCP|Протокол TCP]]
- Ключевым свойством TCP, определяющим всю структуру протокола, является то, что в TCP-соединении у каждого байта есть свой 32-разрядный порядковый номер.
- Современные реализации TCP выполняют обнаружение MTU маршрута (path MTU discovery). При этом используется метод из [[Межсетевое взаимодействие#MTU (Path Maximum Transmission Unit — максимальный размер пакета для выбранного пути)|RFC 1191]]. 
- Основной протокол, используемый TCP-подсистемами, — это протокол раздвижного окна с динамическим размером окна. 

## [[Транспортные протоколы интернета TCP#Заголовок TCP-сегмента|Заголовок TCP-сегмента]]
- Поля Source port и Destination port 
	 Указывают локальные конечные точки соединения. TCP-порт вместе с IP-адресом хоста образуют уникальный 48-битный идентификатор конечной точки.
- Поля Sequence number и Acknowledgement number (Номер подтверждения)
	Выполняют функцию по которой они и названы.
- Поле TCP header length (Длина TCP-заголовка)
	Сообщает, сколько 32-разрядных слов содержится в TCP-заголовке.
-  Идет неиспользуемое 4-битное поле. 
-  Восемь 1-битных флагов.
	- CWR и ECE
	- Бит URG
	- Бит ACK
	- Бит PSH
	- Бит RST
	- Бит SYN
	- Бит FIN
- Поле Window size (Размер окна)
	Сообщает, сколько байтов может быть отправлено после подтвержденного байта.
- Поле Checksum
	Служит для повышения надежности.
-  Поле Urgent pointer (Указатель срочности)
	Даёт сигнал что данный пакет надо в первую очередь обработать
- Поле Options
	Предоставляет дополнительные возможности, не покрываемые стандартным заголовком. Существует множество параметров, и некоторые из них широко используются.
	- Maximum Segment Size (MSS):
	- Window Scale
	- Selective Acknowledgment (SACK)
	- Timestamp
	- Padding

## [[Транспортные протоколы интернета TCP#Установка TCP-соединения|Установка TCP-соединения]]
В TCP соединения устанавливаются с помощью [[Элементы транспортных протоколов#Решение «тройное рукопожатие»|«тройного рукопожатия»]]

## [[Транспортные протоколы интернета TCP#Разрыв TCP-соединения|Разрыв TCP-соединения]]

## [[Транспортные протоколы интернета TCP#Модель управления TCP-соединением|Модель управления TCP-соединением]]

## [[Транспортные протоколы интернета TCP#Раздвижное окно TCP|Раздвижное окно TCP]]

## [[Транспортные протоколы интернета TCP#Управление таймерами в TCP|Управление таймерами в TCP]]

В TCP используется множество таймеров. Наиболее важным из них является таймер повторной передачи (Retransmission TimeOut, RTO), который запускается при отправке сегмента. Главный вопрос насколько долгим должен быть интервал времени ожидания. Решение состоит в использовании динамического алгоритма, который постоянно меняет период ожидания, основываясь на измерениях производительности сети.

- В протоколе TCP используется не только таймер повторной передачи, но и таймер настойчивости (persistence timer). 

- В некоторых реализациях протокола используется третий таймер, называемый таймером проверки активности (keepalive timer). 

в каждом TCP-соединении используется таймер, запускаемый в состоянии TIME WAIT при закрытии соединения. Он отсчитывает двойное время жизни пакета, чтобы гарантировать, что после закрытия соединения созданные им пакеты исчезли.

## [[Транспортные протоколы интернета TCP#Контроль перегрузки в TCP|Контроль перегрузки в TCP]]
- Окно перегрузки (Congestion Window)
- Метод AIMD (Additive Increase Multiplicative Decrease)
- Тайм-ауты и отслеживание потерь
- Медленный старт (Slow Start
- Скорость прихода подтверждений (Ack Clock
- TCP Tahoe
- TCP Reno

## [[Транспортные протоколы интернета TCP#CUBIC TCP|CUBIC TCP]]
Чтобы справиться с растущим значением произведения пропускной способности на задержку, была разработана версия протокола TCP под названием CUBIC TCP.

Суть CUBIC TCP сводится к тому, что окно перегрузки растет в зависимости от времени с момента прибытия последнего дубликата подтверждения (а не просто на основании поступления подтверждений).

----

# Транспортные протоколы и контроль перезагрузки

По мере роста пропускной способности сети некоторые стандартные режимы TCP перестают обеспечивать оптимальную производительность. Ряд новшеств в области транспортных протоколов, призванных решить эти проблемы.

## [[Транспортные протоколы и контроль перезагрузки#QUIC|QUIC]]

Протокол QUIC (Quick UDP Internet Connections — быстрые интернет-соединения UDP) был изначально предложен в качестве транспортного протокола, призванного улучшить ряд характеристик TCP относительно пропускной способности и величины задержки. **QUIC стремится мультиплексировать множества параллельных соединений в единый UDP-поток**, гарантируя при этом, что откладывание пересылки одного веб-объекта не заблокирует передачу остальных.

## [[Транспортные протоколы и контроль перезагрузки#BBR контроль перегрузки на основе пропускной способности узких мест|BBR: контроль перегрузки на основе пропускной способности узких мест]]

BBR (Bottleneck Bandwidth and RTT) — это **алгоритм контроля перегрузки**, разработанный компанией Google, который нацелен на оптимизацию передачи данных в сетях с учетом пропускной способности узких мест и времени в пути (RTT). **Основная идея BBR заключается в том, чтобы минимизировать задержки и избежать излишней буферизации (bufferbloat),** которая возникает, когда сетевые буферы слишком велики и приводят к увеличению задержек при передаче данных.

## [[Транспортные протоколы и контроль перезагрузки#Будущее протокола TCP|Будущее протокола TCP]]


----
# Вопросы производительности

Вопросы, связанные с производительностью сетей, круг существующих проблем и методы их решения. Производительность, доступная приложениям, зависит от общей производительности транспортного, сетевого и канального уровней. Понимание производительности сетей — это скорее искусство, чем наука. 

Основные вопросы производительности сети:
1. Проблемы производительности. 
	Производительность сети может быть ограничена множеством факторов, включая задержки, потери пакетов и перегрузку. Эти проблемы могут возникать на любом уровне модели OSI, от физического до прикладного.

2. Оценка производительности сети.
	 Оценка производительности включает в себя измерение таких параметров, как задержка, пропускная способность и потеря пакетов. Эти метрики позволяют определить, насколько эффективно сеть справляется с передачей данных.

3. Оценка пропускной способности сетей доступа.
	Пропускная способность сетей доступа зависит от типа подключения (например, оптоволокно, DSL) и архитектуры сети. Важно учитывать не только теоретические значения, но и реальные условия эксплуатации.

4. Оценка QoE (качества пользовательского опыта). 
	QoE важен для понимания того, как пользователи воспринимают качество услуг. Это не просто скорость передачи данных, а также стабильность соединения (отсутствие джиттеров) и время отклика приложений.

5. Проектирование хостов для быстрых сетей.
	Хосты должны быть спроектированы с учетом высокой производительности сетей. Это включает в себя использование современных процессоров, оптимизацию программного обеспечения и настройку сетевых интерфейсов.

6. Быстрая обработка сегментов.
	Эффективная обработка сетевых сегментов критична для минимизации задержек. Это может включать в себя использование аппаратного ускорения и оптимизацию программных стеков.

7. Сжатие заголовка.
	Сжатие заголовков в протоколах (например, HTTP/2) помогает уменьшить объем передаваемых данных и улучшить общую производительность сети, особенно для мобильных устройств с ограниченной пропускной способностью.

8. Протоколы для протяженных сетей с высокой пропускной способностью.
	 Для сетей с большой длиной и высокой пропускной способностью (например, WAN) необходимы специальные протоколы (такие как TCP с улучшениями), которые могут компенсировать задержки и потери пакетов.

----
# Резюме






