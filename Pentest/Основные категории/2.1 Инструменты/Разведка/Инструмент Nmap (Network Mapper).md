

[Nmap](https://nmap.org/man/ru/index.html)  **Это мощный [[Pentest/Термины#Стелс-сканер|стелс]] инструмент для сканирования сетей .** Он позволяет обнаруживать устройства в сети, определять открытые порты, выявлять службы, работающие на этих портах, а также определять операционные системы и версии программного обеспечения, установленные на целевых устройствах. При помощи разных форматов пакетов таких как:
- [[Транспортные протоколы интернета TCP#Заголовок TCP-сегмента|TCP SYN-пакеты]]
- [[Транспортные протоколы интернета TCP#Заголовок TCP-сегмента|TCP ACK-пакеты]]
- [[Транспортные протоколы интернета UDP#Заголовок протокола udp|UDP-пакеты]]
- [[Сетевой уровень интернета#ICMP — протокол управляющих сообщений интернета|ICMP-пакеты]]
- [[Сетевой уровень интернета#ARP — протокол разрешения адресов|ARP-пакеты]]
- ...

#### Nmap считает что [[Элементы транспортных протоколов#Адресация|порты]] могут быть в [6 состояниях](https://nmap.org/man/ru/man-port-scanning-basics.html).

1. **Открыт** - это означает порт принимает пакеты или запросы на соединение 
2. **Закрыт** - это означает что порт отвечает на запросы но не используется ни каким сервисом
3. **Фильтруется** - запросы не доходят до этого порта
4. **Не фильтруется** - порт доступен но nmap не может определить открыт он или закрыт, как правило помогает другой вид сканирования
5. **Открыт|Фильтруется** - не получается определить открыт порт или фильтруется, бывает когда порт не отвечает и помогает использование другого вида сканирование 
6. **Закрыт|Фильтруется** - для уточнения можно попробовать другой вид сканирования
## Синтаксис

`nmap [Scan Type(s)] [Options] {target specification}`
``nmap [ _`<Тип сканирования>`_ ...] [ _`<Опции>`_ ] { _`<цель сканирования>`_ }``

[TARGET SPECIFICATION](https://nmap.org/man/ru/man-target-specification.html) - варианты указания цели

- ``-iL _`<имя_файла>`_`` - ввод данных из файлы
- ...

[HOST DISCOVERY](https://nmap.org/man/ru/man-host-discovery.html) - обнаружение хостов/устройств

- `-sL` - Сканирование с целью составления списка
- `-sP` - пинг сканирование (определение хостов), а затем вывести список доступных хостов, т.е. тех, которые ответили на запросы
- ``-PS _`<список_портов>`_`` - TCP SYN пингование
- ``-PA _<список_портов>`_`` - TCP ACK пингование
- ``-PU _`<список_портов>`_`` - UDP пингование
- `-PE`; `-PP`; `-PM` - Типы пинг пакетов ICMP
	Зачастую блокируются [[Брандмауэры и системы обнаружения вторжения|брандмауэром]] или хостом
- ``-PO _`<список_протоколов>`_`` - Пингование с использованием IP протокола
- `-PR` - ARP пингование
- `--traceroute` - Отслеживать путь к хосту
- `--reason` - Показать причины состояний портов и хостов
-  ...

[SCAN TECHNIQUES](https://nmap.org/man/ru/man-port-scanning-techniques.htmll) - методы сканирования портов.

- `-sS` - TCP [[Транспортные протоколы интернета TCP#Заголовок TCP-сегмента|SYN]] сканирование
- `-sT` - TCP сканирование с использованием системного вызова connect
	Сканирования, когда недоступно SYN сканирование. Это происходит в случае, когда у пользователя нет привилегий для использования сырых пакетов или при сканировании IPv6 сетей.
- `-sU` - Различные типы UDP сканирования
- `-sN`; `-sF`; `-sX` - TCP NULL, FIN и Xmas сканирования
- `-sA` - TCP [[Транспортные протоколы интернета TCP#Заголовок TCP-сегмента|ACK]] сканирование
- `-sW` - TCP Window сканирование
- `-sM` - TCP сканирование Мэймона (Maimon)
- `--scanflags` - Заказное TCP сканирование
- ``-sI _`<зомби_хост>`_[:_`<порт>`_]`` - "ленивое" idle сканирование
	позволяет осуществить действительно незаметное TCP сканирование портов цели (имеется ввиду, что никакие пакеты не отсылаются на целевую машину с вашего реального IP адерса).
- `-sO` - Сканирование IP протокола
- ``-b _`<FTP хост>`_`` FTP bounce сканирование

[PORT SPECIFICATION AND SCAN ORDER](https://nmap.org/man/ru/man-port-specification.html) - указать какие порты нужно сканировать и в каком порядке

- ``-p _`<диапазон портов>`_`` - Сканирование только определенных портов
	`T:` - Указывает что использовать TCP пакеты
	`U:`- Указывает что использовать UDP пакеты
	при этом нужно указывать метод сканирование
- `-F` - Скан портов из списка nmap.services
- `-r` - Не использовать случайный порядок портов
- ...

[SERVICE/VERSION DETECTION](https://nmap.org/man/ru/man-version-detection.html) - определять службы, работающие на открытых портах, и их версии.

- `-sV` - Определение версии
- `--allports` - Не исключать порты из проверки определения версии
	По умолчанию, функция определения версии пропускает TCP порт 9100, потому что некоторые принтеры просто распечатывают все, что приходить на этот порт
- ``--version-intensity _`<интенсивность>`_`` - Устанавливает интенсивность работы функции
	Чем выше значение запроса, тем больше вероятность корректного определения службы. Автоматически стоит 7
- `-sR` - RPC сканирование
- ...

[OS DETECTION](https://nmap.org/man/ru/man-os-detection.html) - опция для определения операционной системы, установленной на целевом хосте.

- `-O` - Включить определение ОС
- `--osscan-guess`; `--fuzzy` - угадать приблизительно результаты определения ОС
- `--max-os-tries` - Устанавливает максимальное количество попыток определения ОС

[SCRIPT SCAN](https://nmap.org/man/ru/man-nse.html) - использование скриптов для выполнения различных задач во время сканирования.


[TIMING AND PERFORMANCE](https://nmap.org/man/ru/man-performance.html) - раздел отвечает за управление временем выполнения сканирования и его производительностью.

- ``--min-hostgroup _`<количество_хостов>`_``; ``--max-hostgroup _`<количество_хостов>`_`` - Регулирует размер групп для параллельного сканирования
- ``--max-retries _`<количество_попыток>`_`` - Задает максимальное количество повторных передач запроса
- ``--min-rate _`<число>`_`` - Задает минимальную интенсивность сканирования
- ``--max-rate _`<число>`_`` - Задает максимальную интенсивность сканирования
- ...

[FIREWALL/IDS EVASION AND SPOOFING](https://nmap.org/man/ru/man-bypass-firewalls-ids.html) - опции для обхода межсетевых экранов и систем обнаружения вторжений (IDS)

- `-f` - [[Компьютерные сети/Термины#Межсетевое взаимодействие Фрагментация Фрагментация|фрагментировать]] пакеты; `--mtu` - используя заданное значение [[Компьютерные сети/Термины#Межсетевое взаимодействие Поддержка различных размеров пакета фрагментация пакета и MTU MTU (Maximum Transmission Unit)|MTU]]
	Размер должен быть кратным 8.
- ``-D _`<фиктивный_хост1>`_[,_`<фиктивный_хост2>`_][,ME][,...]`` - Маскировка сканирования с помощью фиктивных хостов
- ``-S _`<IP_адрес>`_`` - Изменить исходный адрес
- ``--data-length _`<число>`_`` - Добавить произвольные данные к посылаемым пакетам
- ``--ttl _`<значение>`_`` - Установить IP поле  [[Сетевой уровень интернета#Формат заголовка.|time-to-live (время жизни)]]
- ``--spoof-mac _`<MAC адрес, префикс или название производителя>`_`` - Задать собственный MAC адрес``--spoof-mac _`<MAC адрес, префикс или название производителя>`_`` - Задать собственный MAC адрес
	0 - рандомно создаст
- `-badsum` - Посылать пакеты с фиктивными TCP/UDP контрольными суммами
- ...

[OUTPUT](https://nmap.org/man/ru/man-output.html) - указать формат вывода результатов сканирования

- ``-oN _`<имя_файла>`_`` - Нормальный вывод как в консоли
- ``-oX _`<имя_файла>`_`` - XML вывод
- `--open` - Показывать только открытые (или возможно открытые) порты
- ...

[MISC](https://nmap.org/man/ru/man-misc-options.html) -  дополнительные опции и функции, которые не попадают в другие категории.

- `-6` - Включает IPv6 сканирование
- `-A` - Опции агрессивного сканирования
- `-V`; `--version` - Вывести номер версии
- `-h`; `--help` - Вывести страницу помощи
- ...

[EXAMPLES](https://nmap.org/man/ru/man-examples.html) - примеры использования Nmap с различными комбинациями опций.

