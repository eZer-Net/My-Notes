
# Варианты нахождения API

В разделе документации; В разделе разработчиков; В API-меню; В настройках аккаунта; На страницах интеграций; В формах обратной связи; В примерах кода; В блогах и статьях; В разделе FAQ; В разделе загрузок и ресурсов

----

# 1. Поиск документации
Документация API часто находится в открытом доступе, особенно если API предназначено для использования внешними разработчиками. Если это так, всегда начинаnm разведку с просмотра документации.

Даже если она не в открытом доступе её можно найти по запросам которые ссылаются на неё
- в структуре URL, например `/api/`
- файлы JavaScript (расширение [[Инструмент Burp Suite#Поиск конечных точек в JS|JS Link Finder]])

Или использовать список общих путей для поиска документации

----
# 2. Определение конечных точек API

Определить, как взаимодействовать. Следует узнать информацию о следующем:
- **Входные данные**, которые обрабатывает API, включая обязательные и необязательные параметры.
- **Типы запросов**, которые принимает API, включая [[Всемирная паутина#Методы|поддерживаемые методы HTTP]] и [[Типы файлов в Content-Type|поддерживаемых типов контента]] (расширение в burp [[Инструмент Burp Suite#Определение поддерживаемых форматов|Content type converter]]).
- Ограничения скорости и механизмы аутентификации.

Изучить сообщения об ошибках и другие ответы. Иногда они включают информацию, которую можно использовать для построения допустимого HTTP-запроса.

----
# 3. Поиск  и эксплуатация скрытых конечных точек

При разведке API, можем обнаружить недокументированные параметры, которые поддерживает API.

Уязвимость массового назначения, создаёт скрытые параметры

#### Выявление скрытых параметров
- Изменять методы запроса GET POST ...
- Анализ ошибок (могут содержать информацию о поддерживаемых параметрах)
- Brute Force перебор параметров
- Анализ документации и исходного кода
- Использование инструментов для анализа API
	- Burp Suite (с модулем API Scanner).
	- Postman (с коллекциями и тестами).    
	- OWASP ZAP (с активным сканированием).

----
# 4. Загрязнение параметров на стороне сервера

Загрязнение параметров на стороне сервера происходит, когда веб-сайт встраивает пользовательский ввод в запрос на стороне сервера к внутреннему API без адекватного кодирования.


#### Тестирование на загрязнение параметров на стороне сервера в строке запроса
Поместить символы синтаксиса запроса, например `#`, `&`, и `=` в своем вводе запроса и наблюдать, как реагирует приложение. Так же их можно закодировать [[URL-кодировки|url]]
- `#` - комментирует всё то что после 
- `&` - оператор и, объединяет запрос
- `=` - оператор присваивания 
- `?` - указывает на начало параметра(ов)

Обратить внимание на то какие ответы мы получаем при использование `#`, `&`, и `=` 

`#` или %23 
	Отвечает за усечение строк запроса
	Всё что после него не обрабатывается. 
	Проверить по ответам от сервера

`&` или %26
	Отвечает за добавление параметра
	В зависимости от типа сканера обрабатывается по разному
		PHP анализирует только последний параметр.
		ASP.NET объединяет оба параметра
		Node.js / express анализирует только первый параметр

Если мы можем переопределить исходный параметр, то можно провести эксплойт. 

#### Тестирование на предмет загрязнения параметров на стороне сервера в путях REST

- Использование относительных путей:
	`GET /api/users/../admin HTTP/1.1`

- Добавление параметров в путь:
	`GET /api/users/123?role=admin HTTP/1.1`

- Использование специальных символов:
	Отправить запрос с #, &, = в пути:
	`GET /api/users/123%26role=admin HTTP/1.1`

- Переопределение параметров:
	Проверить, какой параметр обрабатывается (первый, последний или оба).
	`GET /api/users?id=123&id=456 HTTP/1.1`


#### Тестирование на предмет загрязнения параметров на стороне сервера в структурированных форматах данных

- Добавление дополнительных параметров:
	`{"name": "peter", "access_level": "user", "role": "admin"}

- Экранирование символов: 
	`{"name": "peter\",\"access_level\":\"administrator\""}

-  Глубокое вложение данных:
	`{"user": {"name": "peter", "settings": {"role": "admin"}}}`
`
`

- 

