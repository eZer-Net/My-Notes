
**Анализ конечных точек API**. Например, **если у приложения есть три домена** (x.domain, y.domain и z.domain), **то нужно отдавать отчет, что каждый из них может иметь собственные уникальные конечные точки API**.


# API-разведка

Для начала нам следует определить конечные точки API. Это места, где API получает запросы на определенный ресурс на своем сервере. Например, рассмотрим следующее `GET` запрос:
```
GET /api/books HTTP/1.1
Host: example.com
```
Конечная точка API для этого запроса: `/api/books`. В результате происходит взаимодействие с API для получения списка книг из библиотеки. Другая конечная точка API может быть, например, `/api/books/mystery`, который получит список детективных книг.

При определении структуры **API большинство современных корпоративных приложений следует определенной схеме. Обычно это форматы REST** или протокол [[Pentest/Термины#Структура современных веб-приложений Разница SOAP протокола от REST API SOAP (Simple Object Access Protocol)|SOAP]] который всегда использует XML. Сейчас все большую популярность набирает формат [[Структура современных веб-приложений#REST API|REST]], который считается идеальной структурой для API современных веб-приложений.

Для анализа сетевых запросов можно использовать встроенные в браузер [[Встроенный инструмент браузера|инструменты разработчика]]. Если мы увидим несколько вот таких [[Всемирная паутина#Методы|HTTP-запросов]]:


После того как мы определили конечные точки, необходимо определить, как с ними взаимодействовать. Следует узнать информацию о следующем:
- **Входные данные**, которые обрабатывает API, включая обязательные и необязательные параметры.
- **Типы запросов**, которые принимает API, включая поддерживаемые методы HTTP и форматы мультимедиа.
- Ограничения скорости и механизмы аутентификации.


## Документация по API

API обычно документируются, чтобы разработчики знали, как их использовать и интегрировать с ними.

Документация API часто общедоступна, особенно если API предназначен для использования внешними разработчиками. В этом случае всегда начинайте проверку с просмотра документации.

Пример конечных точек, которые могут ссылаться на документацию API:
- `/api`
- `/swagger/index.html`
- `/openapi.json`

также можете использовать список общих путей для поиска документации с помощью [[Инструмент Burp Suite#Инструмент Burp Suite Intruder Intruder|Intruder]].


## Определение конечных точек API

Также можно собрать много информации, просматривая приложения, использующие API. Зачастую это стоит сделать, даже если у нас есть доступ к документации API, поскольку иногда документация может быть неточной или устаревшей.

Просматривая приложение, ищем в структуре URL-адреса шаблоны, указывающие на конечные точки API, например `/api/`. Также обратить внимание на файлы JavaScript. Они могут содержать ссылки на конечные точки API, которые мы могли не активировать напрямую через веб-браузер. 

Burp Scanner автоматически извлекает некоторые конечные точки во время сканирования, но для более сложного извлечения использовать [BApp JS Link Finder](https://portswigger.net/bappstore/0e61c786db0c4ac787a08c4516d52ccf) . Вы также можете вручную просмотреть файлы JavaScript в Burp.

#### Взаимодействие с конечными точками API

После того как вы определили конечные точки API, взаимодействуйте с ними с помощью Burp Repeater и Burp Intruder. Это позволяет вам наблюдать за поведением API и обнаруживать дополнительную поверхность атаки. Например, вы можете изучить, как API реагирует на изменение метода HTTP и типа носителя.
	**Тип носителя (Content-Type)** указывает формат данных, передаваемых в запросе или ответе. Наиболее распространенные типы:
		• application/json: используется для передачи данных в формате JSON.
		• application/x-www-form-urlencoded: используется для передачи данных в виде пар "ключ-значение", обычно в формах.
		• multipart/form-data: используется для передачи файлов и данных формы.
		• text/plain: используется для передачи простого текста.


При взаимодействии с конечными точками API внимательно просматривайте сообщения об ошибках и другие ответы. Иногда они включают информацию, которую можно использовать для создания действительного HTTP-запроса.

##### Определение поддерживаемых методов HTTP

Метод HTTP определяет действие, которое необходимо выполнить над ресурсом. Например:

- `GET` - Извлекает данные из ресурса.
- `PATCH` - Применяет частичные изменения к ресурсу.
- `OPTIONS` — Получает информацию о типах методов запроса, которые можно использовать на ресурсе.

| Метод   | Описание                                                          |
| ------- | ----------------------------------------------------------------- |
| GET     | Получает данные с сервера без изменения его состояния.            |
| POST    | Отправляет данные на сервер для создания нового ресурса.          |
| PUT     | Обновляет существующий ресурс, заменяя его полностью.             |
| PATCH   | Частично обновляет существующий ресурс, изменяя указанные поля.   |
| DELETE  | Удаляет существующий ресурс на сервере.                           |
| HEAD    | Получает заголовки ответа без тела, проверяя доступность ресурса. |
| OPTIONS | Узнает, какие методы поддерживает сервер для конкретного ресурса. |
| TRACE   | Возвращает содержимое запроса для диагностики и отладки.          |

Конечная точка API может поддерживать различные методы HTTP. Поэтому важно тестировать все потенциальные методы при исследовании конечных точек API. Это может позволить вам определить дополнительные функции конечной точки, открывая больше возможностей для атак.

Например, конечная точка `/api/tasks` может поддерживать следующие методы:

- `GET /api/tasks` - Получает список задач.
- `POST /api/tasks` - Создает новую задачу.
- `DELETE /api/tasks/1` - Удаляет задачу.


##### Определение поддерживаемых типов контента

Конечные точки API часто ожидают данные в определенном формате. Поэтому они могут вести себя по-разному в зависимости от типа содержимого данных, предоставленных в запросе. Изменение типа контента может позволить вам:

- Вызывают ошибки, которые раскрывают полезную информацию.
- Обход слабой защиты.
- Воспользуйтесь преимуществами различий в логике обработки. Например, API может быть безопасным при обработке данных JSON, но подвержен атакам путем внедрения при работе с XML.

Чтобы изменить тип контента, измените `Content-Type` заголовок, а затем соответствующим образом переформатируйте тело запроса. Вы можете использовать [конвертер типов контента](https://portswigger.net/bappstore/db57ecbe2cb7446292a94aa6181c9278) BApp для автоматического преобразования данных, отправленных в запросах, между XML и JSON.

##### Использование Intruder для [[Поиск скрытых параметров API|поиск скрытых параметров]]

После того, как вы определили некоторые исходные конечные точки API, вы можете использовать Intruder для обнаружения скрытых конечных точек. Например, рассмотрим сценарий, в котором вы определили следующую конечную точку API для обновления информации о пользователе:
`PUT /api/user/update`

Чтобы определить скрытые конечные точки, вы можете использовать Burp Intruder для поиска других ресурсов с такой же структурой. Например, вы можете добавить полезную нагрузку в `/update` положение пути со списком других общих функций, таких как `delete` и `add`.

При поиске скрытых конечных точек используйте списки слов, основанные на общепринятых соглашениях об именах API и отраслевых терминах. Убедитесь, что вы также включили термины, которые имеют отношение к приложению, исходя из ваших первоначальных данных.

----
## [[Загрязнение параметров на стороне сервера|Загрязнение параметров на стороне сервера]]

----
# Дополнительная информация

[[Методика работы по API]]
