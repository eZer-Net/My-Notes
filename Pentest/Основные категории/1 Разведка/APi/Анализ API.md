
**Анализ конечных точек API**. Например, **если у приложения есть три домена** (x.domain, y.domain и z.domain), **то нужно отдавать отчет, что каждый из них может иметь собственные уникальные конечные точки API**.


# API-разведка

Чтобы начать тестирование API, сначала необходимо узнать как можно больше информации об API, чтобы выявить его поверхность атаки.

Для начала следует определить конечные точки API. Это места, где API получает запросы о конкретном ресурсе на своем сервере. Например`GET`запрос:
`GET /api/books HTTP/1.1 Host: example.com`

Конечная точка API для этого запроса — `/api/books`. Это приводит к взаимодействию с API для получения списка книг из библиотеки. Другой конечной точкой API может быть, например, `/api/books/mystery`, которая будет получать список детективных книг.

После того, как мы определим конечные точки, нужно определить, как с ними взаимодействовать. Это позволяет создавать допустимые HTTP-запросы для тестирования API. **Следует узнать информацию о следующем:**
- Входные данные, которые обрабатывает API, включают как обязательные, так и необязательные параметры.
- Типы запросов, которые принимает API, включая поддерживаемые методы HTTP и форматы медиа.
- Ограничения скорости и механизмы аутентификации.

## Документация по API

API-интерфейсы обычно документируются, чтобы разработчики знали, как их использовать и интегрировать с ними.

Документация может быть как в человекочитаемой, так и в машиночитаемой форме. Человекочитаемая документация предназначена для разработчиков, чтобы понять, как использовать API. Она может включать подробные объяснения, примеры и сценарии использования. Машиночитаемая документация предназначена для обработки программным обеспечением для автоматизации задач, таких как интеграция и проверка API. Она написана в структурированных форматах, таких как JSON или XML.

Документация API часто находится в открытом доступе, особенно если API предназначено для использования внешними разработчиками. Если это так, всегда начинайте разведку с просмотра документации.

#### Изучение документации API
Даже если документация по API не находится в открытом доступе, мы все равно можете получить к ней доступ, просматривая приложения, использующие API.

Можем встречаться:
- в структуре URL, например `/api/`
- файлы JavaScript (расширение [[Инструмент Burp Suite#Поиск конечных точек в JS|JS Link Finder]])

Также можно использовать список общих путей для поиска документации с помощью Intruder.

#### Использование машиночитаемой документации
Можно использовать ряд автоматизированных инструментов для анализа любой найденной вами машиночитаемой документации API.

Burp Scanner для сканирования и аудита документации OpenAPI или любой другой документации в формате JSON или YAML. Также можно анализировать документацию OpenAPI с помощью OpenAPI Parser BApp.

==Специализированный инструмент для тестирования документированных конечных точек, например Postman или SoapU==I.

----
# Определение и взаимодействие с конечными точками

Также можно собрать много информации, просматривая приложения, использующие API. Зачастую это стоит сделать, даже если у нас есть доступ к документации API, поскольку иногда документация может быть неточной или устаревшей.

Просматривая приложение, ищем в структуре URL-адреса шаблоны, указывающие на конечные точки API, например `/api/`. Также обратить внимание на файлы JavaScript. Они могут содержать ссылки на конечные точки API, которые мы могли не активировать напрямую через веб-браузер. 

Burp Scanner автоматически извлекает некоторые конечные точки во время сканирования, но для более сложного извлечения использовать [JS Link Finder](https://portswigger.net/bappstore/0e61c786db0c4ac787a08c4516d52ccf) .

## Взаимодействие с конечными точками API

После того, как определили конечные точки API, взаимодействовать с ними с помощью Burp Repeater и Burp Intruder. Это позволяет наблюдать за поведением API и обнаруживать дополнительные поверхности атак. Например, мы можем исследовать, как API реагирует на изменение метода HTTP и Content-Type.

При взаимодействии с конечными точками API внимательно изучите сообщения об ошибках и другие ответы. Иногда они включают информацию, которую можно использовать для построения допустимого HTTP-запроса.


##### Определение поддерживаемых методов HTTP
Метод HTTP определяет действие, которое необходимо выполнить над ресурсом. Например:

- `GET` - Извлекает данные из ресурса.
- `PATCH` - Применяет частичные изменения к ресурсу.
- `OPTIONS` — Получает информацию о типах методов запроса, которые можно использовать на ресурсе.

| Метод   | Описание                                                          |
| ------- | ----------------------------------------------------------------- |
| GET     | Получает данные с сервера без изменения его состояния.            |
| POST    | Отправляет данные на сервер для создания нового ресурса.          |
| PUT     | Обновляет существующий ресурс, заменяя его полностью.             |
| PATCH   | Частично обновляет существующий ресурс, изменяя указанные поля.   |
| DELETE  | Удаляет существующий ресурс на сервере.                           |
| HEAD    | Получает заголовки ответа без тела, проверяя доступность ресурса. |
| OPTIONS | Узнает, какие методы поддерживает сервер для конкретного ресурса. |
| TRACE   | Возвращает содержимое запроса для диагностики и отладки.          |

Конечная точка API может поддерживать различные методы HTTP. Поэтому ==важно тестировать все потенциальные методы при исследовании конечных точек API==. Это может позволить вам определить дополнительные функции конечной точки, открывая больше возможностей для атак.

Например, конечная точка `/api/tasks` может поддерживать следующие методы:
- `GET /api/tasks` - Получает список задач.
- `POST /api/tasks` - Создает новую задачу.
- `DELETE /api/tasks/1` - Удаляет задачу.


##### Определение поддерживаемых типов контента
Конечные точки API часто ожидают данные в определенном формате. Поэтому они могут вести себя по-разному в зависимости от типа содержимого данных, предоставленных в запросе. Изменение типа контента может позволить вам:

- Вызывают ошибки, которые раскрывают полезную информацию.
- Обход слабой защиты.
- Воспользуйтесь преимуществами различий в логике обработки. Например, API может быть безопасным при обработке данных JSON, но подвержен атакам путем внедрения при работе с XML.

Чтобы изменить тип контента, измените [[Типы файлов в Content-Type|`Content-Type` заголовок]], а затем соответствующим образом переформатируйте тело запроса. Можно использовать [конвертер типов контента](https://portswigger.net/bappstore/db57ecbe2cb7446292a94aa6181c9278)  для автоматического преобразования данных, отправленных в запросах, между XML и JSON.

##### Лаба
[[Лаборатория поиск и использование неиспользованной конечной точки API]]

##### Использование Intruder для поиск скрытых параметров
После того, как мы определили некоторые исходные конечные точки API, можем использовать Intruder для обнаружения скрытых конечных точек. Например, рассмотрим сценарий, в котором вы определили следующую конечную точку API для обновления информации о пользователе:
`PUT /api/user/update`

Чтобы определить скрытые конечные точки, вы можете использовать Burp Intruder для поиска других ресурсов с такой же структурой. Например, вы можете добавить полезную нагрузку в `/update` положение пути со списком других общих функций, таких как `delete` и `add`.

При поиске скрытых конечных точек используйте списки слов, основанные на общепринятых соглашениях об именах API и отраслевых терминах. Убедитесь, что вы также включили термины, которые имеют отношение к приложению, исходя из ваших первоначальных данных.

---
# [[Поиск скрытых параметров API|Поиск скрытых параметров]]

При выполнении API-разведки мы можем обнаружить недокументированные параметры, которые поддерживает API. Можно попытаться использовать их для изменения поведения приложения. Burp включает в себя многочисленные инструменты, которые могут помочь вам определить скрытые параметры:

- Burp Intruder позволяет автоматически обнаруживать скрытые параметры, используя список слов общих имен параметров для замены существующих параметров или добавления новых параметров.

- Param miner BApp позволяет автоматически угадывать до 65 536 имен параметров на запрос. Param miner автоматически угадывает имена, которые имеют отношение к приложению, на основе информации, взятой из области действия.

- Инструмент обнаружения контента позволяет вам находить контент, на который нет ссылок, среди видимого контента, который вы можете просматривать, включая параметры.

## [[Поиск скрытых параметров API#Уязвимости массового назначения|Уязвимости массового назначения]]

Массовое назначение (также известное как автоматическое связывание) может непреднамеренно создавать скрытые параметры. Это происходит, когда программные фреймворки автоматически связывают параметры запроса с полями внутреннего объекта. Таким образом, массовое назначение может привести к тому, что приложение будет поддерживать параметры, которые никогда не предназначались для обработки разработчиком.

----
## [[Загрязнение параметров на стороне сервера|Загрязнение параметров на стороне сервера]]

Некоторые системы содержат внутренние API, которые не доступны напрямую из Интернета. Загрязнение параметров на стороне сервера происходит, когда веб-сайт встраивает пользовательский ввод в запрос на стороне сервера к внутреннему API без адекватного кодирования. Это означает, что злоумышленник может иметь возможность манипулировать или внедрять параметры, что может позволить ему, например:

- Переопределить существующие параметры.
- Измените поведение приложения.
- Доступ к несанкционированным данным.

Вы можете проверить любой пользовательский ввод на предмет любого загрязнения параметров. Например, параметры запроса, поля формы, заголовки и параметры пути URL могут быть уязвимы.

----
# Дополнительная информация

[[Методика работы по API]]
