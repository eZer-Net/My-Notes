
# Что такое обход пути?

Обход пути также известен как обход каталога. Эти уязвимости позволяют злоумышленнику читать произвольные файлы на сервере, на котором запущено приложение. Это может включать в себя:

- Код и данные приложения.
- Учетные данные для серверных систем.
- Чувствительные файлы операционной системы.

В некоторых случаях злоумышленник может иметь возможность записывать произвольные файлы на сервере, позволяя им изменять данные или поведение приложения и в конечном итоге получить полный контроль над сервером.

## Чтение произвольных файлов через обход пути

Представьте себе приложение для покупок, которое отображает изображения продаваемых товаров. Это может загрузить изображение, используя следующий HTML:
`<img src="/loadImage?filename=218.png">`

`loadImage` URL занимает `filename` параметр и возвращает содержимое указанного файла. Файлы изображений хранятся на диске в папке `/var/www/images/`. Чтобы вернуть изображение, приложение добавляет запрошенное имя файла в этот базовый каталог и использует API файловой системы для чтения содержимого файла. Другими словами, приложение читает файл по следующему пути:
`/var/www/images/218.png`

Это приложение не реализует никакой защиты от атак с обходом пути. В результате злоумышленник может запросить следующий URL-адрес, чтобы получить `/etc/passwd` файл из файловой системы сервера:
`https://insecure-website.com/loadImage?filename=../../../etc/passwd`

Это заставляет приложение читать файл по следующему пути:
`/var/www/images/../../../etc/passwd`

../ - для linux систем обозначает на директорию назад
..\ или ../ - для windows машин

## Распространенные препятствия для использования уязвимостей обхода пути

Многие приложения, которые помещают пользовательский ввод в пути к файлам, реализуют защиту от атак с обходом пути. Их часто можно обойти.

Если приложение удаляет или блокирует последовательности обхода каталога из имени файла, предоставленного пользователем, можно обойти защиту, используя различные методы.

Возможно, вы сможете использовать абсолютный путь от корня файловой системы, например: `filename=/etc/passwd`, чтобы напрямую ссылаться на файл без использования каких-либо последовательностей обхода.

Возможно, вы сможете использовать вложенные последовательности обхода, например `....//` или `....\/`. Они возвращаются к простым последовательностям обхода, когда внутренняя последовательность удаляется.
- В некоторых системах ....// может интерпретироваться как ../../

#### Кодировки

В некоторых контекстах, например в URL-пути или `filename` параметр a `multipart/form-data` По запросу веб-серверы могут удалить любые последовательности обхода каталога перед передачей ваших входных данных приложению. Иногда вы можете обойти этот вид очистки путем кодирования URL-адреса или даже двойного кодирования URL-адреса. `../`. Это приводит к `%2e%2e%2f` и `%252e%252e%252f` соответственно. Различные нестандартные кодировки, такие как `..%c0%af` или `..%ef%bc%8f`, тоже может сработать.

Для пользователей Burp Suite Professional Burp [[Intruder|Intruder]] предоставляет предопределённый список полезной нагрузки **Fuzzing - path traversal**. Он содержит некоторые закодированные последовательности обхода пути

#### Контроль ввода

Приложению может потребоваться, чтобы имя файла, указанное пользователем, начиналось с ожидаемой базовой папки, например `/var/www/images`. В этом случае можно было бы включить требуемую базовую папку с последующими подходящими последовательностями обхода. Например: `filename=/var/www/images/../../../etc/passwd`.

#### Контроль конечного ввода

Приложению может потребоваться, чтобы имя файла, указанное пользователем, заканчивалось ожидаемым расширением файла, например `.png`. В этом случае можно использовать нулевой байт, чтобы эффективно завершить путь к файлу перед требуемым расширением. Например: `filename=../../../etc/passwd%00.png`.
- Нулевой байт %00 это специальный символ, представляющий собой значение 0 в кодировке ASCII. Который останавливает выполнение программы тем что программа ==интерпретирует нулевой байт как конец строки==, тем самым игнорируя все, что идет после него.


# [[Предотвратить атаку с обходом пути|Предотвратить атаку с обходом пути]]