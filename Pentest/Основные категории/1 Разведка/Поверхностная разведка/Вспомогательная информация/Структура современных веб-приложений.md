
## Сравнение современных и более ранних версий приложений

Десять лет назад большинство веб-приложений создавались с помощью серверных фреймворков, отправлявших клиенту страницу HTML/[[JavaScript|JS]]/CSS. Для обновления клиент запрашивал с сервера другую страницу, которая генерировалась и передавалась по [[Всемирная паутина#HTTP и HTTPS|HTTP]].

Теперь веб-приложения используют технологию [[JavaScript#AJAX-запросы|Ajax]] (асинхронный JavaScript и XML), позволяющую выполнять сетевые запросы из сеанса страницы.

## Разбор структуры современных веб-приложений

Часто современные веб-приложения состоят из нескольких, связанных через
так называемый REST API.

#### REST API

Аббревиатура REST расшифровывается Representational State Transfer — «передача состояния представления». Она обозначает нестандартный способ проектирования API, удовлетворяющий следующим критериям:

- **Разделение функций клиента и сервера**
	Архитектура REST предназначена для создания хорошо масштабируемых и вместе с тем простых веб-приложений. Благодаря разделению функций клиента и сервера клиентское приложение может запрашивать ресурсы с сервера, не вникая в логику взаимодействия с базами данных и вообще в детали реализации различных операций.
- **Отсутствие фиксации состояния**
	В архитектуре REST каждый запрос считается независимой транзакцией, то есть общение клиента с сервером состоит из независимых пар «запрос–ответ». При этом на сервере не сохраняется никакой информации о состоянии клиента. Это не означает, что REST API не может выполнять аутентификацию и авторизацию. Просто вместе с каждым запросом отправляется информация, идентифицирующая пользователя, например, в виде токена.
- **Легкость кэширования**
	Чтобы предотвратить отправку клиенту в ответ на его запрос устаревших или неверных данных, каждый ответ сервера должен отмечаться как кэшируемый или не кэшируемый. Это достаточно легко реализуется, поскольку в архитектуре REST четко определено, какая конечная точка обслуживает те или иные данные. В идеале кэши должны управляться программой, чтобы случайно не передать информацию ограниченного доступа пользователю, у которого к ней доступа нет.
- **Каждая конечная точка определяет конкретный объект или метод**
	Обычно конечные точки определяются иерархически: например, /moderators/ joe/logs/12_21_2018 . При этом REST API могут использовать HTTP-методы GET, POST, PUT и DELETE. В результате получается запрос, содержащий в себе всю необходимую информацию для его обработки.

**Среднестатистическое веб-приложение сегодня, скорее всего, использует несколько технологий из следующего списка:**

- REST API;

- [[Pentest/Термины#JSON (JavaScript Object Notation)|JSON]] или XML;

- [[JavaScript|JavaScript]];

- фреймворки для построения одностраничных приложений (React, Vue, EmberJS, AngularJS);

- систему аутентификации и авторизации;

- один или несколько [[Веб-сервера|веб-серверов]] (обычно на Linux-сервере);

- один или несколько пакетов ПО для серверов (ExpressJS, [[Веб-сервера#APACHE|Apache]], [[Веб-сервера#NGINX|NginX]]);

- одну или несколько [[Сервер баз данных|баз данных]] (MySQL, MongoDB и т. п.);

- хранилище данных на стороне клиента (файлы cookie, веб-хранилище, IndexDB).

## Разница SOAP протокола от REST API

Раньше большинство веб-приложений разрабатывались с использованием протокола SOAP (Simple Object Access Protocol, «простой протокол доступа к объектам»). По сравнению с ним архитектура REST имеет несколько преимуществ:
- запрашиваются не функции, а целевые данные;
- простое кэширование запросов;
- высокая масштабируемость.

пример информации, записанной в формате [[XML external entity (XXE) injection|XML]]
```
<user>
	<username>joe</username>
	<password>correcthorsebatterystaple</password>
	<email>joe@website.com</email>
	<joined>12/21/2005</joined>
	<client-data>
		<timezone>UTF</timezone>
		<operating-system>Windows 10</operating-system>
		<licenses>
			<videoEditor>abc123-2005</videoEditor>
			<imageEditor>123-456-789</imageEditor>
		</licenses>
	</client-data>
</user>
```
Эта же информация в формате JSON:
```
{
	"username": "joe",
	"password": "correcthorsebatterystaple",
	"email": "joe@website.com",
	"joined": "12/21/2005",
	"client_data": {
		"timezone": "UTF",
		"operating_system": "Windows 10",
		"licenses": {
			"videoEditor": "abc123-2005",
			"imageEditor": "123-456-789"
		}
	}
}
```

## JavaScript

[[JavaScript|JavaScript]] (JS) — это единственный динамический язык для клиентских сценариев в браузерах, который был изначально разработан только для этих целей.

##### [[JavaScript|Базовая информация про JS]]

## Программный интерфейс DOM браузера

Как и любой хороший язык, JavaScript опирается на мощную стандартную библиотеку. Эта библиотека известна как [[JavaScript#Программный интерфейс DOM браузера|DOM]]. Модель DOM предоставляет стандартные хорошо протестированные и эффективные функциональные возможности, реализованные во всех основных браузерах. Это обеспечивает идентичное или почти идентичное выполнение кода в любом браузере.

Глубокое понимание программного интерфейса DOM и его роли в веб-приложениях помогает при поиске уязвимостей на уровне представления. Интерфейс DOM можно рассматривать как фреймворк, из которого написанные на JavaScript приложения развертываются для конечных пользователей.  Иногда дыры в безопасности могут быть результатом неправильной реализации DOM в браузере.

## Фреймворки для SPA

Раньше веб-сайты, как правило, строились как комбинация ad hoc сценария для управления DOM и большого количества шаблонов HTML-кода. Такая модель не была масштабируемой.

Для устранения разрыва в функциональности сайтов и офисных приложений были разработаны фреймворки одностраничных приложений ([[Pentest/Термины#SPA (Single-page application)|single-page application, SPA]])
Они позволяют разрабатывать сложные приложения, хранящие данные о своем внутреннем состоянии и составленные из компонентов пользовательского интерфейса, каждый из которых имеет автономный жизненный цикл, от рендеринга до выполнения логических операций.

Крупнейшие современные SPA-фреймворки с открытым исходным кодом — это ReactJS, EmberJS, VueJS (рис. 3.4) и AngularJS. ==Все они построены на базе JavaScript и DOM, что несет дополнительные сложности для безопасности и функциональности==.

## Системы аутентификации и авторизации

Термин «**аутентификация**» применяется для описания потока данных, позволяющего системе идентифицировать пользователя. 
	Другими словами, системы аутентификации дают понять, что «joe123» на самом деле «joe123», а не «susan1988».

Термин «**авторизация**» используется для описания процесса внутри системы, позволяющего пользователю подтвердить право на доступ к определенным ресурсам. 
	Например, у «joe123» должен быть доступ только к тем личным фото, которые он сам загрузил, а для «susan1988» эти фотографии должны быть недоступны.

### Аутентификация

Ранние системы аутентификации были простыми. Например, базовая аутентификация [[Всемирная паутина#HTTP и HTTPS|HTTP]] осуществлялась путем прикрепления к каждому запросу заголовка с данными авторизации. Заголовок состоял из строки Basic: [[Кодировки#BASE64|base64]]-encoded username:password.
В результате вместе с запросом сервер получал комбинацию «имя пользователя — пароль» и сверял ее с базой данных.
Но такая схема имела множество недочётов таких как утечки учетных данных, причем разными способами — от утечки данных из незашифрованного HTTP в общем сегменте [[Беспроводные локальные сети#Безопасность и конфиденциальность|Wi-Fi]] до простых атак [[Инъекции#Cross-Site Scripting (XSS)|XSS]].

К более поздним разработкам относится дайджест-аутентификация, при которой вместо кодировки [[Кодировки#BASE64|base64]] используются криптографические хеши. Позже появилось множество новых методов и архитектур для аутентификации, в том числе методы, которые не используют пароли и не требуют внешних устройств.

Сегодня выбор архитектуры аутентификации для веб-приложения зависит от характера бизнеса. Например, сайтам, которым требуется интеграция с более крупными сайтами, отлично подходит ==протокол OAuth==. Этот протокол позволяет крупному сайту (например, Facebook или Google) предоставлять сайту партнеру токен, подтверждающий личность пользователя. Пользователю этот механизм также удобен, потому что обновлять данные в этом случае требуется только на одном сайте. **Но за удобство приходится платить уменьшением безопасности, ведь один взломанный сайт дает доступ сразу ко множеству профилей.**

### Авторизация

Следующий после аутентификации шаг — авторизация. Системы авторизации сложнее классифицировать, поскольку эта процедура во многом зависит от кода, реализующего функциональность приложения.

**В коде хорошо спроектированных приложений есть класс authorization**, отвечающий за проверку доступа к ресурсам или функциональности.

В плохо написанном [[Pentest/Термины#API (Application programming interface)|API]] процедура авторизации каждый раз воспроизводится вручную. Если приложение раз за разом реализует проверку авторизации в каждом API, скорее всего, окажется, что в некоторых из них эта проверка выполняется недостаточно тщательно.

На ресурсах общего доступа с проверкой полномочий, как правило, есть обновления настроек/профиля, сброс пароля, чтение/написание личных сообщений, различные платные функции, а иногда и расширение пользовательских функций (например, добавление возможности модерации).

## Веб-серверы

Существует несколько основных вариантов программного обеспечения для веб-серверов. Почти половину всех сайтов в мире обслуживает [[Веб-сервера#APACHE|Apache]], поэтому логично предположить, что он применяется и для большинства веб-приложений. Это программное обеспечение имеет открытый исходный код, существует около 25 лет и поддерживает почти все дистрибутивы Linux, а также некоторые сервера Windows.
Его самый большой конкурент — [[Веб-сервера#NGINX|Nginx]] (произносится «энжин икс»). Его использует около 30% веб-серверов, и это количество быстро растет.

## Базы данных на стороне сервера

Выбор базы зависит от кода, реализующего функциональность приложения, и от сценариев использования. Но самые популярные до сих пор остаются базы данных [[SQL]].

Многообразие современных веб-приложений логично привело к появлению узкоспециализированных баз данных. Такими базами, требующими регулярной синхронизации с основной базой данных, пользуются поисковые системы, например популярный в своей категории поисковый движок Elasticsearch.

С каждым типом базы данных связаны уникальные проблемы и риски. [[Инъекции#SQL Injection (SQLi)|Внедрение SQL-кода]] — хорошо известный тип атаки, эффективный в случаях некорректной обработки входных данных. И атаки этого типа возможны против любых баз данных, достаточно изучить модель построения запросов


Зачастую современные веб-приложения могут использовать несколько баз данных одновременно. **И даже отсутствие уязвимостей при генерации SQL-запросов не означает, что запросы и определение полномочий на доступ к базам MongoDB или Elasticsearch осуществляются безопасным образом.**

## Хранение данных на стороне клиента

Традиционно на стороне клиента хранился минимум данных из-за технических ограничений и проблем с межбраузерной совместимостью. Но ситуация быстро меняется. **Многие приложения начали сохранять важные данные о своем состоянии на стороне клиента**. Зачастую это **конфигурационные данные или большие сценарии**, которые могут вызвать перегрузку сети, если их придется скачивать при каждом посещении.

В большинстве случаев для хранения и доступа к данным в виде пары «[[NoSQL#Базы данных "Ключ-Значение" (Key-Value)|ключ– значение]]» используется управляемый **браузером контейнер local storage — локальное хранилище**. Оно подчиняется правилу ограничения домена (SOP), которое запрещает доменам (веб-сайтам) доступ к сохраненным данным друг друга. Веб-приложения сохраняют состояние даже после закрытия браузера или вкладки.
![[Pasted image 20250104012458.png]]

**Подмножество локального хранилища, сессионное хранилище (session storage)**, отличается тем, что данные хранятся только до закрытия вкладки. ==Этот тип хранилища можно и нужно использовать при работе с важными данными, которые должны удаляться после смены пользователя.==

Для более сложных приложений во всех основных веб-браузерах имеется поддержка IndexedDB. Это объектно-ориентированная БД на языке JavaScript, позволяющая выполнять асинхронные запросы в фоновом режиме.