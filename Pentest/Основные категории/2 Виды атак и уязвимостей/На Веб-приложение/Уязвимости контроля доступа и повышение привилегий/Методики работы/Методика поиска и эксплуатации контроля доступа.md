
# Анализ

В контексте веб-приложений контроль доступа зависит от аутентификации и управления сеансами

- **Аутентификация** подтверждает, что пользователь является тем, за кого себя выдает.
- **Управление сеансами** определяет, какие последующие HTTP-запросы выполняются тем же пользователем.
- **Контроль доступа** определяет, разрешено ли пользователю выполнять действие, которое он пытается выполнить.

# Вертикальное повышение привилегий

### 1. Незащищенная функциональность

**Описание:**  
Административные URL или функциональность могут быть доступны без должной проверки прав доступа. Например, URL может быть раскрыт в файле `robots.txt` или передан в JavaScript-коде.

**Пример:**
- URL административной панели: `https://example.com/admin`
- В файле `robots.txt` обнаружена строка: `Disallow: /admin`


### 2. Методы контроля доступа на основе параметров

**Описание:**  
Приложение может сохранять информацию о правах доступа в контролируемых пользователем местах, таких как скрытые поля, cookies или параметры строки запроса.

**Пример:**
- Скрытое поле в Json:
    `{"user": "john", "role": "user"}`
- Cookie:
    `Set-Cookie: role=admin; Path=/`
- Параметр строки запроса:
	`https://example.com/dashboard?role=admin`

### 3. Нарушение контроля доступа из-за неправильной настройки платформы

**Описание:**  
Неправильная настройка правил контроля доступа может привести к уязвимостям. Например, использование нестандартных заголовков HTTP для переопределения URL.

**Пример:**
- Запрос с использованием заголовка `X-Original-URL`:
```
POST / HTTP/1.1
X-Original-URL: /admin/deleteUser
```
Используйте заголовки, такие как `X-Forwarded-For`, `X-Original-URL`, или `X-Rewrite-URL`, чтобы изменить URL или IP-адрес:

- Изменение метода запроса:
```
GET /admin/deleteUser HTTP/1.1
```

### 4. Нарушенный контроль доступа из-за несоответствий в URL-адресах

**Описание:**  
Механизм контроля доступа может некорректно обрабатывать URL-адреса с разным регистром, слешами или расширениями.

**Пример:**
- Разные регистры:
    `/admin/deleteUser vs /ADMIN/DELETEUSER`
- Разные слеши:
    `/admin/deleteUser` vs `/admin/deleteUser/`
- Расширения файлов:
    `/admin/deleteUser` vs `/admin/deleteUser.anything`

# Горизонтальное повышение

- Атаки горизонтального повышения привилегий могут использовать те же типы методов эксплойта, что и вертикальное повышение привилегий.
### 1. Уязвимости IDOR (Insecure Direct Object References)

**Описание:**  
Уязвимости IDOR возникают, когда приложение позволяет пользователю напрямую обращаться к объектам (например, записям в базе данных или файлам) без проверки прав доступа.

**Пример:**
- Прямая ссылка на объект базы данных:
    `https://example.com/customer_account?customer_number=132355`
- Прямая ссылка на статический файл:
    `https://example.com/static/12144.txt`

### 2. Уязвимости контроля доступа в многоэтапных процессах

**Описание:**  
В многоэтапных процессах (например, смена пароля или админ панель) контроль доступа может быть нарушен, если пользователь пропускает этапы проверки.

**Пример:**
- Пропуск этапов в процессе смены пароля:
    `Этап 1: Вход в админ панель`
    `Этап 2: Изменение привилегий пользователя`
    `Этап 3: Подтверждение изменений`
    
    Если пользователь может перейти сразу к этапу 3, это может привести к уязвимости.

### 3. Контроль доступа на основе реферера

**Описание:**  
Некоторые приложения основывают контроль доступа на заголовке `Referer`, что может быть обойдено злоумышленником.

**Пример:**
- Запрос с поддельным заголовком `Referer`:
```
    GET /admin/deleteUser HTTP/1.1
    Referer: https://example.com/admin
```

### 4. Тестирование на обход ограничений через массовые операции

- **Описание:** Проверка, можно ли выполнить массовые операции (например, удаление или изменение) для данных других пользователей.
    
- **Пример:**
    - Если приложение позволяет удалять несколько записей одновременно, попробовать передать идентификаторы записей других пользователей:
        `POST /deleteRecords`
        `...`
        `ids=[123,124,125]`

### 5. Тестирование на обход ограничений через манипуляцию JWT (JSON Web Tokens)

- **Описание:** Если приложение использует JWT для аутентификации, попробовать изменить claims (например, роль пользователя).
    
- **Пример:**
    - Исходный JWT:`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiSm9obiIsInJvbGUiOiJ1c2VyIn0.abc123`
    - Модифицированный JWT:`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiSm9obiIsInJvbGUiOiJhZG1pbiJ9.xyz456`