Один из наиболее очевидных способов запретить пользователям загружать вредоносные скрипты — внести в черный список потенциально опасные расширения файлов, такие как `.php`. Практика внесения в черный список по своей сути ошибочна, поскольку сложно явно заблокировать все возможные расширения файлов, которые могут использоваться для выполнения кода. Такие черные списки иногда можно обойти, используя менее известные альтернативные расширения файлов, которые все еще могут быть исполняемыми, например `.php5`, `.shtml`, и так далее.

## Переопределение конфигурации сервера

Как было описано в предыдущем разделе, серверы обычно не будут выполнять файлы, если они не настроены для этого. Например, прежде чем сервер Apache выполнит файлы PHP, запрошенные клиентом, разработчикам, возможно, придется добавить следующие директивы в свой файл: `/etc/apache2/apache2.conf` файл:
```
LoadModule php_module /usr/lib/apache2/modules/libphp.so 
AddType application/x-httpd-php .php
```

Многие серверы также позволяют разработчикам создавать специальные файлы конфигурации в отдельных каталогах, чтобы переопределить или добавить одну или несколько глобальных настроек. Например, **серверы Apache загружают конфигурацию для конкретного каталога из файла с именем `.htaccess`** если таковой присутствует.

Аналогичным образом разработчики могут выполнить **настройку для конкретного каталога на серверах IIS, используя `web.config` файл.** Это может включать в себя такие директивы, которые в данном случае позволяют предоставлять пользователям файлы JSON:

```
<staticContent>
	<mimeMap fileExtension=".json" mimeType="application/json" /> </staticContent>
```

Веб-серверы используют такие файлы конфигурации, если они есть, но обычно вам не разрешается получать к ним доступ с помощью HTTP-запросов. Однако иногда вы можете встретить серверы, которые не могут помешать вам загрузить собственный вредоносный файл конфигурации. В этом случае, даже если нужное вам расширение файла занесено в черный список, вы можете обманом заставить сервер сопоставить произвольное расширение файла с исполняемым [[Компьютерные сети/Термины#Электронная почта MIME — многоцелевые расширения интернет-почты MIME|типом MIME]].

#### Лаба
[[Лабораторная работа Загрузка веб-оболочки через обход черного списка расширений]]


## Запутывающие расширения файлов

Даже самые исчерпывающие черные списки потенциально могут быть обойдены с использованием классических методов запутывания. Допустим, код проверки чувствителен к регисту и не может распознать, что `exploit.pHp` на самом деле `.php` файл. Если код, который впоследствии отображает расширение файла с типом MIME, не чувствителен к регистру, это расхождение позволяет пройти злонамеренные файлы PHP после проверки, которая в конечном итоге может быть выполнена сервером.

Также можно достичь аналогичных результатов, используя следующие методы:

- **Обеспечить несколько расширений.** В зависимости от алгоритма, используемого для анализа имени файла, следующий файл можно интерпретировать как файл PHP или изображение JPG: `exploit.php.jpg`

- **Добавить конечные символы**. Некоторые компоненты удаляют или игнорируют конечные пробелы, точки и т.п.: `exploit.php.`

- **Попробовать использовать кодировку URL-адреса (или двойную кодировку URL-адреса) для точек, прямой и обратной косой черты.** Если значение не декодируется при проверке расширения файла, но позже декодируется на стороне сервера, это также может позволить вам загружать вредоносные файлы, которые в противном случае были бы заблокированы: `exploit%2Ephp`

- **Добавьте точки с запятой или нулевые байтовые символы в URL-кодировке перед расширением файла.** Если проверка написана на языке высокого уровня, таком как PHP или Java, но сервер обрабатывает файл, используя, например, функции более низкого уровня на C/C++, это может привести к несоответствию в том, что считается концом имени файла: `exploit.asp;.jpg` или `exploit.asp%00.jpg`

- **Использовать многобайтовые символы Юникода, которые могут быть преобразованы в нулевые байты и точки после преобразования или нормализации Юникода.** Последовательности типа `xC0 x2E`, `xC4 xAE` или `xC0 xAE` может быть переведен на `x2E` Если имя файла проанализировано как строка UTF-8, но затем преобразовано в символы ASCII, прежде чем использовать в пути.

#### Лаба
[[Лабораторная работа Загрузка веб-оболочки через запутанное расширение файла]]