вторая линия защиты — не дать серверу выполнять любые сценарии, которые все же проскальзывают через сеть.

В качестве меры предосторожности серверы обычно запускают только сценарии, MIME-тип которых был явно настроен для выполнения. В противном случае они могут просто вернуть какое-то сообщение об ошибке или, в некоторых случаях, вместо этого предоставить содержимое файла в виде обычного текста:

```
GET /static/exploit.php?command=id HTTP/1.1 
Host: normal-website.com 

HTTP/1.1 200 OK 
Content-Type: text/plain 
Content-Length: 39

<?php echo system($_GET['command']); ?>
```

Такое поведение потенциально интересно само по себе, поскольку оно может привести к утечке исходного кода, но сводит на нет любую попытку создать веб-оболочку.

Этот вид конфигурации часто различается в разных каталогах. ==Каталог, в который загружаются файлы, предоставленные пользователем, вероятно, будет иметь гораздо более строгий контроль, чем другие места в файловой системе, которые считаются недоступными для конечных пользователей.== Если вы сможете найти способ загрузить сценарий в другой каталог, который не должен содержать файлы, предоставленные пользователем, сервер все-таки может выполнить ваш сценарий.

Веб-серверы часто используют `filename` поле в `multipart/form-data` запросы на определение имени и места, где следует сохранить файл.

Также следует отметить, что ==даже если вы можете отправлять все свои запросы на одно и то же доменное имя, это часто указывает на какой-либо обратный прокси-сервер, например балансировщик нагрузки.== Ваши запросы часто будут обрабатываться дополнительными серверами, которые также могут быть настроены по-разному.


#### Лаба
[[Лабораторная работа Загрузка веб-оболочки через обход пути]]