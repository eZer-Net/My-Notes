
==Одной из наиболее распространенных причин логических уязвимостей являются ошибочные предположения о поведении пользователей.==

### Доверенные пользователи не всегда будут заслуживать доверия

Приложения могут казаться безопасными, поскольку они реализуют, казалось бы, надежные меры по обеспечению соблюдения бизнес-правил. К сожалению, некоторые приложения совершают ошибку, предполагая, что, пройдя эти строгие меры контроля изначально, пользователю и его данным можно доверять бесконечно. Это может привести к относительно слабому обеспечению соблюдения тех же мер контроля с этого момента.

- **Методы тестирования:**
    
    - Проверить, как приложение обрабатывает действия доверенных пользователей после их аутентификации. Например, попробовать изменить параметры запросов (например, ID пользователя, роли или другие данные) после успешного входа в систему.
    
    - Проверить, как приложение реагирует на попытки доступа к данным других пользователей (например, подмена идентификаторов в запросах).
    
    - Убедится, что приложение не ослабляет контроль доступа после первоначальной аутентификации. Например, проверить, требуется ли повторная проверка прав доступа при выполнении критических операций.


### Пользователи не всегда предоставляют обязательные данные

Одно из заблуждений заключается в том, что пользователи всегда будут вводить значения для обязательных полей ввода. Браузеры могут не позволять обычным пользователям отправлять формы без обязательных данных, но, как мы знаем, **злоумышленники могут изменять параметры в процессе передачи. Это даже распространяется на полное удаление параметров.**

Это особая проблема в случаях, когда несколько функций реализованы в одном и том же скрипте на стороне сервера. В этом случае наличие или отсутствие определенного параметра может определить, какой код будет выполнен. Удаление значений параметров может позволить злоумышленнику получить доступ к путям кода, которые должны быть вне досягаемости.

Это касается как URL, так и `POST` параметров, но не забываем также проверить файлы cookie. Этот простой процесс может выявить некоторые странные действия приложения, которые могут быть использованы.

- **Методы тестирования:**
    
    - Удалять обязательные параметры из запросов (как в URL, так и в теле POST-запросов) и наблюдать за реакцией приложения.
    
    - Попробовать отправить пустые значения для обязательных полей или замените их на неожиданные данные (например, специальные символы, длинные строки).
    
    - Проверить, как приложение обрабатывает отсутствие параметров или их некорректные значения. Например, попробовать удалить имя параметра или его значение.
    
    - Протестировать многоэтапные процессы, изменяя параметры на разных этапах. Например, удалить параметр на одном этапе и проверить, как это повлияет на последующие шаги.
    
    - Проверить файлы cookie на предмет их влияния на бизнес-логику. Попробовать изменить или удалить cookie и посмотреть, как приложение реагирует.

#### Лаба
[[Лабораторная работа Слабая изоляция конечной точки двойного назначения]]

### Пользователи не всегда будут следовать предполагаемой последовательности

Многие транзакции основаны на предопределенных рабочих процессах, состоящих из последовательности шагов. Веб-интерфейс обычно проводит пользователей через этот процесс, переводя их на следующий шаг рабочего процесса каждый раз, когда они завершают текущий. Однако злоумышленники не обязательно будут придерживаться этой предполагаемой последовательности. Неспособность учесть эту возможность может привести к опасным недостаткам, которые могут быть относительно просто эксплуатировать.

Например, многие веб-сайты, реализующие двухфакторную аутентификацию (2FA), требуют, чтобы пользователи входили на одной странице, прежде чем вводить код подтверждения на другой странице. Предположение, что пользователи всегда будут следовать этому процессу до конца, и, как следствие, не подтверждать это, может позволить злоумышленникам полностью обойти шаг 2FA.

Предположения о последовательности событий могут привести к широкому спектру проблем даже в рамках одного рабочего процесса или функциональности. Используя такие инструменты, как Burp Proxy и Repeater, как только злоумышленник увидел запрос, он может воспроизвести его по своему желанию и использовать принудительный просмотр для выполнения любых взаимодействий с сервером в любом желаемом порядке. Это позволяет им выполнять различные действия, пока приложение находится в неожиданном состоянии.

Чтобы выявить такие недостатки, следует использовать принудительный просмотр для отправки запросов в непреднамеренной последовательности. Например, мы можем пропустить определенные шаги, получить доступ к одному шагу более одного раза, вернуться к более ранним шагам и т. д. Обратите внимание на то, как осуществляется доступ к различным шагам. Хотя мы часто просто отправляете запрос `GET`или `POST`на определенный URL-адрес, иногда мы можем получить доступ к шагам, отправив различные наборы параметров на тот же URL-адрес. Как и в случае со всеми логическими недостатками, попытайтесь определить, какие предположения сделали разработчики и где находится поверхность атаки. Затем мы можем поискать способы нарушения этих предположений.

Обратим внимание, что этот тип тестирования часто вызывает исключения, поскольку ожидаемые переменные имеют нулевые или неинициализированные значения. Прибытие в местоположение в частично определенном или несогласованном состоянии также может вызвать жалобу приложения. В этом случае **обязательно уделите пристальное внимание любым сообщениям об ошибках или отладочной информации, с которыми мы столкнёмся.** Они могут быть ценным источником раскрытия информации, что может помочь нам точно настроить атаку и понять ключевые детали поведения бэкэнда.


**Методы тестирования:**

- Попробовать пропустить шаги, повторить шаги или вернуться к предыдущим шагам.

- Проверить, как приложение обрабатывает запросы, отправленные в неправильной последовательности. Например, попробовать выполнить шаг 2 до шага 1.

- Убедится, что приложение проверяет состояние пользователя на каждом этапе. Например, если пользователь должен пройти двухфакторную аутентификацию, проверьте, можно ли обойти этот шаг.

- Обратить внимание на сообщения об ошибках и отладочную информацию, которые могут раскрыть детали внутренней логики приложения.

#### Лабы
- [[Лабораторная работа Недостаточная проверка рабочего процесса]]
- [[Лабораторная работа Обход аутентификации с помощью неисправного конечного автомата]]

