
## Что такое межсайтовый скриптинг (XSS)?

Межсайтовый скриптинг (также известный как XSS) — это уязвимость веб-безопасности, которая позволяет злоумышленнику скомпрометировать взаимодействие пользователей с уязвимым приложением. Она позволяет злоумышленнику обойти политику одного и того же источника, которая предназначена для разделения различных веб-сайтов друг от друга. Уязвимости межсайтового скриптинга обычно позволяют злоумышленнику маскироваться под пользователя-жертву, выполнять любые действия, которые может выполнять пользователь, и получать доступ к любым данным пользователя. Если пользователь-жертва имеет привилегированный доступ в приложении, то злоумышленник может получить полный контроль над всеми функциями и данными приложения.

## Как работает XSS?

Межсайтовый скриптинг работает путем манипулирования уязвимым веб-сайтом, чтобы он возвращал вредоносный JavaScript пользователям. Когда вредоносный код выполняется внутри браузера жертвы, злоумышленник может полностью скомпрометировать ее взаимодействие с приложением.

## XSS-доказательство концепции

Подтвердить большинство видов уязвимости XSS, внедрив полезную нагрузку, которая заставляет наш собственный браузер выполнять произвольный JavaScript. Использование `alert()`функции для этой цели давно стало обычной практикой, поскольку она короткая, безвредная и ее довольно сложно не заметить, когда она успешно вызывается. Но в различных браузерах она может не работать, [ознакомится с записью в блоге об этом](https://portswigger.net/research/alert-is-dead-long-live-print) 


# Основные три вида XSS-атаки:

- #### [[XSS (Cross-Site Scripting)#Отраженный XSS|Отраженные]] код исполняется серверными сценариями и не хранится в базе данных;

- #### [[XSS (Cross-Site Scripting)#Хранимый XSS|Сохранённые]] код хранится в базе данных;

- #### [[XSS (Cross-Site Scripting)#XSS-атака на базе DOM|Через DOM]] код сохраняется и выполняется в браузере.

Существуют и другие вариации, но именно эти три вида XSS-атак необходимо регулярно отслеживать большинству современных веб-приложений, потому что такие сообщества, как Open Web Application Security Project (OWASP), считают их наиболее распространенными векторами.

----
# [[Отраженный XSS]]

Отраженная XSS-атака происходит, когда отправляем специальный код (обычно JavaScript) через URL или форму, и этот код немедленно возвращается пользователю в ответе от сервера. Это значит, что код не сохраняется на сервере, а просто "отражается" обратно.

---
# [[Сохранённые XSS]]

Хранимый XSS (также известный как постоянный или XSS второго порядка) возникает, когда приложение получает данные из ненадежного источника и включает эти данные в свои последующие HTTP-ответы небезопасным способом.

Данные, о которых идет речь, могут быть отправлены в приложение через HTTP-запросы; например, комментарии к записи в блоге, псевдонимы пользователей в чате или контактные данные в заказе клиента. В других случаях данные могут поступать из других ненадежных источников; например, приложение веб-почты, отображающее сообщения, полученные по SMTP, маркетинговое приложение, отображающее посты в социальных сетях, или приложение сетевого мониторинга, отображающее пакетные данные из сетевого трафика.

### [[Сохранённые XSS#XSS-полиглоты|XSS-полиглоты]]
### [[Сохранённые XSS#От сигнатурного анализа XSS|От сигнатурного анализа XSS]]

----
# [[XSS-атака на базе DOM]]

XSS на основе DOM (также известный как DOM XSS) возникает, когда приложение содержит некоторый клиентский JavaScript, который обрабатывает данные из ненадежного источника небезопасным способом, обычно путем записи данных обратно в DOM.

Это может быть вариант как хранимой, так и отраженной XSS-атаки, но для выполнения требуются источник и приемник в [[DOM]] браузера. Из-за различий в реализациях DOM некоторые браузеры оказываются уязвимыми, некоторые — нет. Такую XSS-уязвимость гораздо труднее найти и использовать, поскольку для этого требуются глубокие знания DOM и JavaScript.

### [[DOM|Что такое DOM]]

### [[XSS-атака на базе DOM#Как проверить наличие межсайтового скриптинга на основе DOM|Как найти XSS DOM]]


## [[Источники и приемники в сторонних зависимостях]]

Современные веб-приложения обычно создаются с использованием ряда сторонних библиотек и фреймворков, которые часто предоставляют дополнительные функции и возможности для разработчиков. Важно помнить, что некоторые из них также являются потенциальными источниками и стоками для DOM XSS.

## [[DOM XSS в сочетании с отраженными и сохраненными данными]]

Чисто DOM-уязвимости содержатся в пределах одной страницы. Если скрипт считывает данные из URL и записывает их в опасное место, то уязвимость полностью находится на стороне клиента.

#### [[DOM XSS в сочетании с отраженными и сохраненными данными#Какие стоки могут привести к уязвимостям DOM-XSS?|Какие стоки могут привести к уязвимостям DOM-XSS?]]


----

# Для чего можно использовать XSS?

Злоумышленник, использующий уязвимость межсайтового скриптинга, обычно может:

- Выдавайте себя за пользователя-жертву или маскируйтесь под него.
- Выполнять любые действия, которые может выполнить пользователь.
- Чтение любых данных, к которым пользователь имеет доступ.
- Захватите учетные данные пользователя.
- Выполнить виртуальную порчу веб-сайта.
- Внедрить троянскую функциональность на веб-сайт.


----

# Влияние уязвимостей XSS

Фактическое воздействие атаки XSS обычно зависит от характера приложения, его функциональности и данных, а также статуса скомпрометированного пользователя. Например:

- В приложении для создания брошюр, где все пользователи анонимны, а вся информация общедоступна, влияние часто будет минимальным.
- В приложениях, содержащих конфиденциальные данные, такие как банковские транзакции, электронные письма или медицинские записи, последствия обычно будут серьезными.
- Если скомпрометированный пользователь имеет повышенные привилегии в приложении, то последствия, как правило, будут критическими, что позволит злоумышленнику получить полный контроль над уязвимым приложением и скомпрометировать всех пользователей и их данные.

- [Эксплуатация уязвимостей межсайтового скриптинга](https://portswigger.net/web-security/cross-site-scripting/exploiting)

----

# Как найти и протестировать уязвимости XSS

Подавляющее большинство уязвимостей XSS можно быстро и надежно обнаружить с помощью веб-сканеров уязвимостей.

Ручное тестирование отраженных и сохраненных XSS обычно включает отправку простых уникальных входных данных (например, короткой буквенно-цифровой строки) в каждую точку входа в приложении, идентификацию каждого местоположения, где отправленные входные данные возвращаются в ответах HTTP, и индивидуальное тестирование каждого местоположения, чтобы определить, можно ли использовать соответствующим образом созданные входные данные для выполнения произвольного JavaScript. Таким образом, можно определить [[Контексты межсайтового скриптинга|контекст]], в котором происходит XSS, и выбрать подходящую полезную нагрузку для ее эксплуатации.

Ручное тестирование на основе DOM XSS, возникающее из параметров URL, включает в себя аналогичный процесс: размещение некоторого простого уникального ввода в параметре, использование инструментов разработчика браузера для поиска этого ввода в DOM и тестирование каждого местоположения, чтобы определить, является ли оно эксплуатируемым. Однако другие типы DOM XSS сложнее обнаружить. Чтобы найти уязвимости на основе DOM в не основанном на URL вводе (например, `document.cookie`) или не основанных на HTML стоках (например, `setTimeout`), нет замены проверке кода JavaScript, которая может быть чрезвычайно трудоемкой. Веб-сканер уязвимостей Burp Suite объединяет статический и динамический анализ JavaScript для надежной автоматизации обнаружения уязвимостей на основе DOM.

----
# Политика безопасности контента

Политика безопасности контента (CSP) — это механизм браузера, который направлен на смягчение последствий межсайтового скриптинга и некоторых других уязвимостей. Если приложение, использующее CSP, содержит поведение, подобное XSS, то CSP может помешать или предотвратить эксплуатацию уязвимости. Часто CSP можно обойти, чтобы обеспечить эксплуатацию базовой уязвимости.

- [Политика безопасности контента](https://portswigger.net/web-security/cross-site-scripting/content-security-policy)

----
# Висячая инъекция разметки

Dangling markup injection — это метод, который можно использовать для захвата данных между доменами в ситуациях, когда полный эксплойт межсайтового скриптинга невозможен из-за входных фильтров или других защит. Его часто можно использовать для захвата конфиденциальной информации, которая видна другим пользователям, включая токены CSRF, которые можно использовать для выполнения несанкционированных действий от имени пользователя.

- [Висячая инъекция разметки](https://portswigger.net/web-security/cross-site-scripting/dangling-markup)

----

# Как предотвратить XSS-атаки

В некоторых случаях предотвратить межсайтовый скриптинг несложно, но это может быть гораздо сложнее в зависимости от сложности приложения и способов обработки контролируемых пользователем данных.

#### [[Защита от XSS атак|Варианты защиты от XSS сохранённой и отражённой]]
#### [[Защита от уязвимости на основе DOM-потока]]

#### [Как предотвратить XSS описание от PortSwigger](https://portswigger.net/web-security/cross-site-scripting/preventing)

----

# Дополнительная информация

## [[Методика поиска и развития уязвимости XSS]]

## [Шпаргалка от PortSwigger](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

## [Простенькая статья на hackware.ru](https://hackware.ru/?p=1174)

## [Документация по XSS атак на GitHub Wiki **Domxss**](https://github.com/wisec/domxsswiki/wiki)

## [[XSS с мутациями]]

На сегодняшний день такие атаки возможны во всех основных браузерах. mXSS, или XSS с мутациями представляет собой тип уязвимости межсайтового скриптинга, который использует мутации DOM для обхода фильтров и механизмов защиты от XSS. Эти атаки могут быть особенно сложными для обнаружения и предотвращения, поскольку они exploit'ят особенности обработки HTML и JavaScript браузерами, а не полагаются на традиционные методы инъекций.

- [[XSS с мутациями#Как это работает?|Как это работает]]
- [[XSS с мутациями#Пример обнаружения|Пример обнаружения]]


----
# Инструменты
[[Инструмент Burp Suite]] 
[[Инструмент XSSer]]
[[Инструмент XSStrike]]