То что защита имеется, не означает, что она надежна. Иногда мы все еще можем использовать недостатки этих механизмов, чтобы получить [[Уязвимости загрузки файлов#Веб-оболочка|веб-оболочку]] для удаленного выполнения кода.

## Неверная проверка типа файла

При отправке HTML-форм браузер обычно отправляет предоставленные данные в виде `POST` запрос с типом контента `application/x-www-form-url-encoded`. Это подходит для отправки простого текста, например вашего имени или адреса. Однако он не подходит для отправки больших объемов двоичных данных, таких как весь файл изображения или документ PDF. В этом случае тип контента `multipart/form-data` является предпочтительным.

Форма, содержащая поля для загрузки изображения, его описания и ввода вашего имени пользователя. Отправка такой формы может привести к запросу, который выглядит примерно так:

```
POST /images HTTP/1.1 
Host: normal-website.com Content-Length: 12345 
Content-Type: multipart/form-data; boundary=---------------------------012345678901234567890123456 

---------------------------012345678901234567890123456 
Content-Disposition: form-data; name="image"; filename="example.jpg" 
Content-Type: image/jpeg 

[...binary content of example.jpg...] 

---------------------------012345678901234567890123456 
Content-Disposition: form-data; name="description" 

This is an interesting description of my image.

---------------------------012345678901234567890123456 
Content-Disposition: form-data; name="username" 

wiener 
---------------------------012345678901234567890123456--
```

Как видим, тело сообщения разделено на отдельные части для каждого ввода формы. Каждая часть содержит `Content-Disposition` заголовок, который предоставляет некоторую базовую информацию о поле ввода, к которому он относится. Эти отдельные части могут также содержать свои собственные `Content-Type` заголовок, который сообщает серверу MIME-тип данных, отправленных с использованием этого ввода.

**Один из способов, с помощью которого веб-сайты могут попытаться проверить загрузку файлов, — это проверить, что этот специфичный для ввода файл `Content-Type` заголовок соответствует ожидаемому типу MIME.** Например, если сервер ожидает только файлы изображений, он может разрешать только такие типы, как `image/jpeg` и `image/png`. Проблемы могут возникнуть, если сервер неявно доверяет значению этого заголовка. Если дальнейшая проверка не выполняется, чтобы проверить, действительно ли содержимое файла соответствует предполагаемому типу MIME, эту защиту можно легко обойти с помощью таких инструментов, как Burp Repeater.


