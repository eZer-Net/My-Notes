

# Анализ

В контексте веб-приложений контроль доступа зависит от аутентификации и управления сеансами

- **Аутентификация** подтверждает, что пользователь является тем, за кого себя выдает.
- **Управление сеансами** определяет, какие последующие HTTP-запросы выполняются тем же пользователем.
- **Контроль доступа** определяет, разрешено ли пользователю выполнять действие, которое он пытается выполнить.

# Вертикальное повышение привилегий

## 0. Незащищенная функциональность

- Параметр административный url общедоступный может быть раскрыт в различных местах к примеру `robots.txt`
- «Безопасности через неизвестность» - это может быть не угадываемым параметром напрямую. Однако приложение все равно может передать URL пользователям в JS, который создает пользовательский интерфейс на основе роли пользователя

## 1. Методы контроля доступа на основе параметров 

- Проверить на то что приложение определяет права доступа или роль пользователя при входе в систему, а затем сохраняют эту информацию в контролируемом пользователем месте. Это может быть:
	- Скрытое поле (в ответах можем увидеть).
	- Cookie.
	- Предварительно заданный параметр строки запроса.

	Скрытые параметры в запросах и ответах могут быть в:  аутентификации, смены данных учётки, различные ресурсы приложения

## 2. Нарушение контроля доступа из-за неправильной настройки платформы

***Пояснение*** 
Приложение может настроить правило следующим образом:
```
DENY: POST, /admin/deleteUser, managers
```
Это правило запрещает доступ к `POST`методу URL `/admin/deleteUser`для пользователей в группе менеджеров.


- Проверить поддерживает ли различные нестандартные заголовки HTTP, которые можно использовать для переопределения URL в исходном запросе, например 
  `X-Original-URL`и `X-Rewrite-URL`.  (Не забыть поменять исходный запрос путь на `/`)
```
POST / HTTP/1.1 
X-Original-URL: /invalid_error
...
```
Если получили ошибку то данный заголовок работает и можем экспериментировать

- Проверить различные методы запроса, *Change request method* GET/POST

## 3. Нарушенный контроль доступа из-за несоответствий в URL-адресах

- Проверить механизм контроля доступа на "толерантность", он может рассматривать `/admin/deleteUser` и  `/ADMIN/DELETEUSER` как две разные конечные точки и в результате не обеспечивать соблюдение правильных ограничений.

- Так же могут расхождениями быть в том что `/admin/deleteUser`и `/admin/deleteUser/`рассматриваются как отдельные конечные точки.

- Аналогичные расхождения могут возникнуть, если разработчики, использующие фреймворк Spring, включили эту `useSuffixPatternMatch`опцию. Это позволяет сопоставлять пути с произвольным расширением файла с эквивалентной конечной точкой без расширения файла. Другими словами, запрос к `/admin/deleteUser.anything`все равно будет соответствовать `/admin/deleteUser`шаблону. До Spring 5.3 эта опция была включена по умолчанию.

# Горизонтальное повышение

- Атаки горизонтального повышения привилегий могут использовать те же типы методов эксплойта, что и вертикальное повышение привилегий.
## 0. IDOR значения параметров пользователь-контроллер используются для прямого доступа к ресурсам или функциям.

- Уязвимость IDOR с прямой ссылкой на объекты базы данных. Изменение значений в параметрах
```
https://insecure-website.com/customer_account?customer_number=132355
```

- Уязвимость IDOR с прямой ссылкой на статические файлы
```
https://insecure-website.com/static/12144.txt
```

- Проверить функционал сайта на раскрытие конф информации о пользователях.
	Может быть рассекречен в url в элементе кода ... в ответах от сервера

## 1. Уязвимости контроля доступа в многоэтапных процессах

- При реализации важных функций в несколько этапов протестировать пропустить несколько пунктов тем самым "перескочить" этапы где есть проверка.

## 2. Контроль доступа на основе реферера

- Некоторые веб-сайты основывают контроль доступа на `Referer`заголовке. 
	приложение надежно применяет контроль доступа к главной административной странице в `/admin`, но для подстраниц, таких как `/admin/deleteUser`проверяет только `Referer`заголовок. Если `Referer`заголовок содержит основной `/admin`URL, то запрос разрешен.

