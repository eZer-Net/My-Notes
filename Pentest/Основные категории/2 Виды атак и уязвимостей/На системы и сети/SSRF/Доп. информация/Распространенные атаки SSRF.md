==Атаки SSRF часто используют доверительные отношения для эскалации атаки со стороны уязвимого приложения== и выполнения несанкционированных действий. Эти доверительные отношения могут существовать по отношению к серверу или по отношению к другим серверным системам в той же организации.

## SSRF-атаки на сервер

При SSRF-атаке на сервер злоумышленник заставляет приложение отправить HTTP-запрос обратно на сервер, на котором размещено приложение, через сетевой интерфейс обратной связи. Обычно это включает в себя предоставление URL-адреса с именем хоста, например `127.0.0.1` (зарезервированный IP-адрес, указывающий на адаптер обратной связи) или `localhost` (обычно используемое название для одного и того же адаптера).

Например, представьте себе приложение для покупок, которое позволяет пользователю видеть, есть ли товар на складе в определенном магазине. Чтобы предоставить биржевую информацию, приложение должно запрашивать различные серверные API REST. Это делается путем передачи URL-адреса соответствующей конечной точке внутреннего API через внешний HTTP-запрос. Когда пользователь просматривает статус товара на складе, его браузер отправляет следующий запрос:

```
POST /product/stock HTTP/1.0 
Content-Type: application/x-www-form-urlencoded 
Content-Length: 118 stockApi=http://stock.weliketoshop.net:8080/product/stock/check%3FproductId%3D6%26storeId%3D1
```

Это заставляет сервер делать запрос по указанному URL-адресу, получать статус запасов и возвращать его пользователю.

В этом примере злоумышленник может изменить запрос, указав URL-адрес, локальный для сервера:
```
POST /product/stock HTTP/1.0 
Content-Type: application/x-www-form-urlencoded 
Content-Length: 118 stockApi=http://localhost/admin
```
Сервер извлекает содержимое `/admin` URL и возвращает его пользователю.

Злоумышленник может посетить `/admin` URL, но административные функции обычно доступны только аутентифицированным пользователям. Это означает, что злоумышленник не увидит ничего интересного. Однако если запрос к `/admin` URL поступает с локального компьютера, обычный контроль доступа обходит. Приложение предоставляет полный доступ к административным функциям, поскольку запрос исходит из надежного места.

Почему приложения ведут себя таким образом и неявно доверяют запросам, поступающим с локальной машины? ==Это может возникнуть по разным причинам:==

- Проверка контроля доступа может быть реализована в другом компоненте, который находится перед сервером приложений. При обратном соединении с сервером проверка пропускается.

- В целях аварийного восстановления приложение может разрешить административный доступ без входа в систему любому пользователю, пришедшему с локального компьютера. Это дает администратору возможность восстановить систему, если он потеряет свои учетные данные. Это предполагает, что только полностью доверенный пользователь будет приходить непосредственно с сервера.

- Административный интерфейс может прослушивать другой номер порта основного приложения и может быть недоступен для пользователей напрямую.

Подобные доверительные отношения, при которых запросы, исходящие от локального компьютера, обрабатываются иначе, чем обычные запросы, часто превращают SSRF в критическую уязвимость.

## SSRF-атаки на другие серверные системы

В некоторых случаях сервер приложений может взаимодействовать с серверными системами, к которым пользователи не имеют прямого доступа. Эти системы часто имеют немаршрутизируемые частные IP-адреса. Серверные системы обычно защищены топологией сети, поэтому они часто имеют более слабый уровень безопасности. Во многих случаях внутренние серверные системы содержат конфиденциальные функции, доступ к которым может получить без аутентификации любой, кто может взаимодействовать с системами.

В предыдущем примере представьте, что на внутреннем URL-адресе есть административный интерфейс. `https://192.168.0.68/admin`. Злоумышленник может отправить следующий запрос, чтобы воспользоваться уязвимостью SSRF и получить доступ к административному интерфейсу:
```
POST /product/stock HTTP/1.0 
Content-Type: application/x-www-form-urlencoded 
Content-Length: 118 

stockApi=http://192.168.0.68/admin
```

