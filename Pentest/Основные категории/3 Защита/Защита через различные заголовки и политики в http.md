
# Заголовок X-Frame-Options

X-Frame-Options - от атак Clickjacking

1. **`X-Frame-Options: deny`**  
    Полный запрет на отображение страницы во фрейме в любом контексте.
2. **`X-Frame-Options: sameorigin`**  
    Разрешает отображение только на страницах того же домена.
3. **`X-Frame-Options: allow-from https://normal-website.com`**  
    Разрешает отображение только с указанного домена (устаревший вариант, не поддерживается в современных браузерах).

# Политика безопасности контента (CSP)

От атак Clickjacking, Межсайтовый скриптинг (XSS), Инъекции данных

1. **`Content-Security-Policy: frame-ancestors 'none';`**  
    Эквивалент `X-Frame-Options: deny` - полный запрет встраивания.
2. **`Content-Security-Policy: frame-ancestors 'self';`**  
    Эквивалент `X-Frame-Options: sameorigin` - разрешено только для своего домена.
3. **`Content-Security-Policy: frame-ancestors example.com trusted-site.com;`**  
    Разрешает встраивание только с указанных доменов.
4. **`Content-Security-Policy: frame-ancestors https:;`**  
    Разрешает встраивание только по HTTPS.

#### Основные директивы CSP:
1. **default-src** - политика по умолчанию для всех типов ресурсов
2. **script-src** - контролирует загрузку JavaScript
3. **style-src** - контролирует загрузку CSS
4. **img-src** - контролирует загрузку изображений
5. **font-src** - контролирует загрузку шрифтов
6. **connect-src** - ограничивает источники для XHR, WebSocket, EventSource
7. **frame-src** - контролирует встраивание фреймов
8. **frame-ancestors** - защита от кликджекинга (заменяет X-Frame-Options)
9. **media-src** - контролирует загрузку видео и аудио
10. **object-src** - контролирует плагины (например, Flash)
11. **report-uri** (устарело) / **report-to** - куда отправлять отчеты о нарушениях
#### Специальные ключевые слова
В CSP есть специальные значения:
- `'none'` - полный запрет
- `'self'` - только текущий домен
- `'unsafe-inline'` - разрешение inline-скриптов/стилей (не рекомендуется)
- `'unsafe-eval'` - разрешение eval() (не рекомендуется)
- `'strict-dynamic'` - для современных приложений с динамической загрузкой скриптов

#### Основной синтаксис директив
Каждая директива CSP имеет формат:
	`директива-источника список-разрешённых-источников;`

#### Конкретные примеры с разграничением по доменам

###### 1. Разрешение JS только с одного домена
```
Content-Security-Policy: 
  script-src 'self' https://trusted-cdn.example;
```
Здесь:
- `'self'` - разрешает скрипты с текущего домена (того же origin)
- `https://trusted-cdn.example` - разрешает скрипты только с этого конкретного домена
- Все другие источники скриптов будут блокироваться

##### 2. Разные домены для разных типов ресурсов
```
Content-Security-Policy: 
  default-src 'self';
  script-src 'self' https://ajax.googleapis.com;
  style-src 'self' https://maxcdn.bootstrapcdn.com;
  img-src 'self' https://images.example.com data:;
  font-src 'self' https://fonts.googleapis.com;
```

В этом примере:
- По умолчанию разрешены только свои ресурсы (`default-src 'self'`)
- Скрипты можно загружать со своего домена и Google CDN
- Стили - со своего домена и Bootstrap CDN
- Изображения - со своего домена, указанного внешнего домена и data-URI
- Шрифты - со своего домена и Google Fonts

##### 3. Разрешение iframe только с определённых доменов
```
Content-Security-Policy: 
  frame-src https://youtube.com https://vimeo.com;
```
Это разрешает встраивание iframe только с YouTube и Vimeo, блокируя все другие источники.

##### 4. Строгая политика с отчётами
```
Content-Security-Policy: 
  default-src 'none';
  script-src 'self' https://cdn.jsdelivr.net;
  style-src 'self' 'unsafe-inline';
  img-src 'self' data:;
  connect-src 'self' https://api.example.com;
  report-uri https://example.com/csp-report;
```
Здесь:
- По умолчанию всё запрещено (`none`)
- Скрипты только со своего домена и jsDelivr CDN
- Стили только свои + разрешены inline-стили
- Изображения свои и data-URI
- AJAX-запросы только к своему API
- Отправка отчётов о нарушениях на указанный URL


# CORS

CORS - это механизм, который позволяет веб-страницам получать ресурсы с другого домена (origin), отличного от того, с которого была загружена сама страница.

#### Заголовок `Origin`
Формат `Origin: https://example.com`
- Указывает откуда был сделан запрос

##### Ключевые CORS-заголовки:

| Заголовок                          | Пример                                   | Описание                                                          |
| ---------------------------------- | ---------------------------------------- | ----------------------------------------------------------------- |
| `Access-Control-Allow-Origin`      | `*` или `https://frontend.com`           | Указывает, какие домены могут получать доступ к ресурсам сервера. |
| `Access-Control-Allow-Methods`     | `GET, POST, OPTIONS`                     | Разрешенные HTTP-методы.                                          |
| `Access-Control-Allow-Headers`     | `Content-Type, Authorization`            | Разрешенные заголовки запроса.                                    |
| `Access-Control-Allow-Credentials` | `Access-Control-Allow-Credentials: true` | Разрешает отправку cookies                                        |

# Referer

HTTP-заголовок, который указывает URL предыдущей страницы, с которой пришел пользователь.

**Формат**:
	`Referer: https://previous-site.com/page.html
# SameSite

Контролируют, когда куки могут отправляться с cross-site запросами.

**a) `SameSite=Strict`**:
- Куки отправляются только при запросах в рамках того же сайта
- Полная защита от CSRF, но может нарушить UX при переходах с других сайтов

**b) `SameSite=Lax`** (рекомендуемый вариант):
- Куки отправляются:
    - При навигации по сайту (ссылки)
    - При GET-запросах извне

- Не отправляются:
    - В кросс-доменных POST-формах
    - В iframe-запросах

- Хороший баланс безопасности и удобства

**c) `SameSite=None`**:
- Куки отправляются при любых кросс-доменных запросах
- Требует установки `Secure` (только HTTPS)
- Нужен для функциональности, работающей в iframe/кросс-доменно.
