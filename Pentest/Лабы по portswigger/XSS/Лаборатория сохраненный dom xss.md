Эта лаборатория демонстрирует сохраненную уязвимость DOM в функциональности комментария в блоге. Чтобы решить эту лабораторию, используйте эту уязвимость, чтобы вызвать `alert()` функция

## Дано

сохраненную уязвимость DOM
в функциональности комментария в блоге

## Задача

вызвать `alert()` функция


# Решение

- `<script>loadComments('/post/comment')</script>`
```
function loadComments(postCommentPath) {
    let xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            let comments = JSON.parse(this.responseText);
            displayComments(comments);
        }
    };
    xhr.open("GET", postCommentPath + window.location.search);
    xhr.send();

//экранирует символы <> в html
function escapeHTML(html) {
	return html.replace('<', '&lt;').replace('>', '&gt;');
}
```

- метод `replace` работает по замене только 1 совпадения из всего контекста в ином случае надо использовать флаг
![[Pasted image 20250130145304.png]]


- `<><img src="0" onerror="alert(1)">` - 1 заголовок экранируется а последующие нет 

## Итог

Не совсем верно иметь такую защиту так как данные должны очищаться до момента
![[Pasted image 20250130150227.png]]
Из за ответа видим что возвращается Json c символами html и после уже полагаются на код функцию `replace` чтоб отобразить его в dom